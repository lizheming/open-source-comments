{
  "sha": "5270cd97ef12153f26846f753136d947a4ad411b",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo1MjcwY2Q5N2VmMTIxNTNmMjY4NDZmNzUzMTM2ZDk0N2E0YWQ0MTFi",
  "commit": {
    "author": {
      "name": "Guo Xiang Tan",
      "email": "gxtan1990@gmail.com",
      "date": "2020-08-31T04:55:42Z"
    },
    "committer": {
      "name": "Guo Xiang Tan",
      "email": "gxtan1990@gmail.com",
      "date": "2020-08-31T04:55:42Z"
    },
    "message": "DEV: Leaking state in `PostActionNotifier` in tests take 2.\n\nFollow-up to a3b48826",
    "tree": {
      "sha": "e92c03d8ff9087f192cdfe58c972f66c240d43b7",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/e92c03d8ff9087f192cdfe58c972f66c240d43b7"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/5270cd97ef12153f26846f753136d947a4ad411b",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEMOJGkc46I9vMVlDg+9EQF5qsHyAFAl9MgtoACgkQ+9EQF5qs\nHyDs9g//Wihg34ZHeQY3kllHURYy6S5fqn3s56PS/X+AgyXVxF/rdvopGBsjra2/\nuBCUU/NiUbhtgPzlXCWsRzQgnGebItWeFn3B+ICd5ONhfkZhOKnkdHe0PIfxjv+o\n5c1a0Q60gyWDx9UqQi/hVLAAK8Fq5msIITGg8wHfkGJN4R3vEswAj3GCQscO3F3+\nlb91r/a18Ab8/UyGq+HujrVUzoJ16ul4kWJ5S83qhYe4qXTTHd2sg4vKc8v4Hotm\npT04HiKYgoXWFf9WpX9/w11gkoABduugdT5Xx324T6nWxr6HCeZxGaRVx5VdnCnl\nNU56OeIEj6uio9UCADDpYejb2bhygTHFFhJ6cE1Iih/wUt3JRF/k1m16NLI19qQk\nOrxEPlwIiFm8/L5biSpZ/wRCdgv7Pe5OYGr3kp71fKb5uxr4YGsZ3m1beQNIu7QT\n4NAJTsqHaYRW5dzT5YHh/zaequrT5XUs5B46gw8CFIw7X+/H46xrfw9K8erxQBRd\nKajF+KcSOUZlC3dRH1b7f8wqwJ1+x4YYlKl6CKojkbQFSWiTEhqxqJsTr+Eue31L\naejtysQrnYNB5UUbL20WydcG0RwyMhVG+9TWv8LKGskTDWaXKBg01nLE3Ye/h6/c\n3v+2YHtOC1YEhE2UjVTf0H0pWIk65NWec+mCHejPkPJqcVgZfVU=\n=AteI\n-----END PGP SIGNATURE-----",
      "payload": "tree e92c03d8ff9087f192cdfe58c972f66c240d43b7\nparent a3b4882665890b176a64e7a12106fb2e0c833080\nauthor Guo Xiang Tan <gxtan1990@gmail.com> 1598849742 +0800\ncommitter Guo Xiang Tan <gxtan1990@gmail.com> 1598849742 +0800\n\nDEV: Leaking state in `PostActionNotifier` in tests take 2.\n\nFollow-up to a3b48826\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/5270cd97ef12153f26846f753136d947a4ad411b",
  "html_url": "https://github.com/discourse/discourse/commit/5270cd97ef12153f26846f753136d947a4ad411b",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/5270cd97ef12153f26846f753136d947a4ad411b/comments",
  "author": {
    "login": "tgxworld",
    "id": 4335742,
    "node_id": "MDQ6VXNlcjQzMzU3NDI=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/4335742?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tgxworld",
    "html_url": "https://github.com/tgxworld",
    "followers_url": "https://api.github.com/users/tgxworld/followers",
    "following_url": "https://api.github.com/users/tgxworld/following{/other_user}",
    "gists_url": "https://api.github.com/users/tgxworld/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tgxworld/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tgxworld/subscriptions",
    "organizations_url": "https://api.github.com/users/tgxworld/orgs",
    "repos_url": "https://api.github.com/users/tgxworld/repos",
    "events_url": "https://api.github.com/users/tgxworld/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tgxworld/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tgxworld",
    "id": 4335742,
    "node_id": "MDQ6VXNlcjQzMzU3NDI=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/4335742?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tgxworld",
    "html_url": "https://github.com/tgxworld",
    "followers_url": "https://api.github.com/users/tgxworld/followers",
    "following_url": "https://api.github.com/users/tgxworld/following{/other_user}",
    "gists_url": "https://api.github.com/users/tgxworld/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tgxworld/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tgxworld/subscriptions",
    "organizations_url": "https://api.github.com/users/tgxworld/orgs",
    "repos_url": "https://api.github.com/users/tgxworld/repos",
    "events_url": "https://api.github.com/users/tgxworld/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tgxworld/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a3b4882665890b176a64e7a12106fb2e0c833080",
      "url": "https://api.github.com/repos/discourse/discourse/commits/a3b4882665890b176a64e7a12106fb2e0c833080",
      "html_url": "https://github.com/discourse/discourse/commit/a3b4882665890b176a64e7a12106fb2e0c833080"
    }
  ],
  "stats": {
    "total": 10,
    "additions": 9,
    "deletions": 1
  },
  "files": [
    {
      "sha": "3f562e327fed56e5a6731c54f2c4cc171ba0ac8a",
      "filename": "app/services/post_action_notifier.rb",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/5270cd97ef12153f26846f753136d947a4ad411b/app/services/post_action_notifier.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/5270cd97ef12153f26846f753136d947a4ad411b/app/services/post_action_notifier.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/services/post_action_notifier.rb?ref=5270cd97ef12153f26846f753136d947a4ad411b",
      "patch": "@@ -4,13 +4,17 @@ class PostActionNotifier\n \n   def self.disable\n     @disabled = true\n-    @custom_post_revision_notifier_recipients = nil\n   end\n \n   def self.enable\n     @disabled = false\n   end\n \n+  # For testing purposes\n+  def self.reset!\n+    @custom_post_revision_notifier_recipients = nil\n+  end\n+\n   def self.alerter\n     @alerter ||= PostAlerter.new\n   end"
    },
    {
      "sha": "00d326ea22aba5e0214b4322326f08726d937cdd",
      "filename": "spec/services/post_action_notifier_spec.rb",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/5270cd97ef12153f26846f753136d947a4ad411b/spec/services/post_action_notifier_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/5270cd97ef12153f26846f753136d947a4ad411b/spec/services/post_action_notifier_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/services/post_action_notifier_spec.rb?ref=5270cd97ef12153f26846f753136d947a4ad411b",
      "patch": "@@ -108,6 +108,10 @@\n         end\n       end\n \n+      after do\n+        PostActionNotifier.reset!\n+      end\n+\n       it 'notifies the specified user of the revision' do\n         expect {\n           post.revise(evil_trout, raw: \"world is the new body of the message\")"
    }
  ]
}
