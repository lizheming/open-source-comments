{
  "sha": "f2bf026740da1f0bc0de35455551eee82987c57c",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6ZjJiZjAyNjc0MGRhMWYwYmMwZGUzNTQ1NTU1MWVlZTgyOTg3YzU3Yw==",
  "commit": {
    "author": {
      "name": "Vinh",
      "email": "vinh@vinh.tech",
      "date": "2020-06-22T23:39:07Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-06-22T23:39:07Z"
    },
    "message": "[CORL-1129] Form initialization and reset bug (#2991)\n\n* fix: form initialization and reset bug\r\n\r\n* fix: test\r\n\r\nCo-authored-by: Wyatt Johnson <wyattjoh@gmail.com>",
    "tree": {
      "sha": "3a26e098ccca0d1a74c949d4cbc4dd441f8d2b81",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/3a26e098ccca0d1a74c949d4cbc4dd441f8d2b81"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/f2bf026740da1f0bc0de35455551eee82987c57c",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe8UEbCRBK7hj4Ov3rIwAAdHIIABiRA0hgk8B/vSQM50Rc6xlg\nP4Ma85j9yk9WxNbNg0fUo93rHn2pFn/s16gK1BeAZ5CmJUgmxfNQMhho1NHDScO6\nK62qgvHiZyRjeIgehg4hsUGQmnXVygnF/E46tb2/aHEsCcDe9WmECImkRJRNrtcb\nwL8/gFjqiGan9mn/9b9vA7MvdJPVf8S+720QNHkhNrEbFHI6fbvjaVqrMd1GWgkm\n6uAbkpD5bMxQzpnphwjBCVcOEJK5Mt1dca1C7r8HL5GntKD3U0BT2nKs7fvTIJ4N\nhDB2ppAZW2++CLS79vvCjh5sqHGOrsGp05YeB4OHRChdbJGfhN1K9c24GsFuAeM=\n=44OL\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 3a26e098ccca0d1a74c949d4cbc4dd441f8d2b81\nparent 625c38a75805c67518127d4c3ca57dcd3ed65550\nauthor Vinh <vinh@vinh.tech> 1592869147 +0200\ncommitter GitHub <noreply@github.com> 1592869147 +0000\n\n[CORL-1129] Form initialization and reset bug (#2991)\n\n* fix: form initialization and reset bug\r\n\r\n* fix: test\r\n\r\nCo-authored-by: Wyatt Johnson <wyattjoh@gmail.com>"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/f2bf026740da1f0bc0de35455551eee82987c57c",
  "html_url": "https://github.com/coralproject/talk/commit/f2bf026740da1f0bc0de35455551eee82987c57c",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/f2bf026740da1f0bc0de35455551eee82987c57c/comments",
  "author": {
    "login": "cvle",
    "id": 14221600,
    "node_id": "MDQ6VXNlcjE0MjIxNjAw",
    "avatar_url": "https://avatars2.githubusercontent.com/u/14221600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cvle",
    "html_url": "https://github.com/cvle",
    "followers_url": "https://api.github.com/users/cvle/followers",
    "following_url": "https://api.github.com/users/cvle/following{/other_user}",
    "gists_url": "https://api.github.com/users/cvle/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cvle/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cvle/subscriptions",
    "organizations_url": "https://api.github.com/users/cvle/orgs",
    "repos_url": "https://api.github.com/users/cvle/repos",
    "events_url": "https://api.github.com/users/cvle/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cvle/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "625c38a75805c67518127d4c3ca57dcd3ed65550",
      "url": "https://api.github.com/repos/coralproject/talk/commits/625c38a75805c67518127d4c3ca57dcd3ed65550",
      "html_url": "https://github.com/coralproject/talk/commit/625c38a75805c67518127d4c3ca57dcd3ed65550"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 11,
    "deletions": 13
  },
  "files": [
    {
      "sha": "d64c9326f4472ddfc3c4f4d8167710757dda4ad7",
      "filename": "package-lock.json",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/f2bf026740da1f0bc0de35455551eee82987c57c/package-lock.json",
      "raw_url": "https://github.com/coralproject/talk/raw/f2bf026740da1f0bc0de35455551eee82987c57c/package-lock.json",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/package-lock.json?ref=f2bf026740da1f0bc0de35455551eee82987c57c",
      "patch": "@@ -34310,7 +34310,7 @@\n         },\n         \"chalk\": {\n           \"version\": \"1.1.3\",\n-          \"resolved\": \"https://registry.npmjs.org/chalk/-/chalk-1.1.3.tgz\",\n+          \"resolved\": \"http://registry.npmjs.org/chalk/-/chalk-1.1.3.tgz\",\n           \"integrity\": \"sha1-qBFcVeSnAv5NFQq9OHKCKn4J/Jg=\",\n           \"dev\": true,\n           \"requires\": {"
    },
    {
      "sha": "44033b5c3da7606eec02ce6a0c1c03aeac485c35",
      "filename": "src/core/client/stream/tabs/Comments/Comment/ReplyCommentForm/ReplyCommentFormContainer.tsx",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/coralproject/talk/blob/f2bf026740da1f0bc0de35455551eee82987c57c/src/core/client/stream/tabs/Comments/Comment/ReplyCommentForm/ReplyCommentFormContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/f2bf026740da1f0bc0de35455551eee82987c57c/src/core/client/stream/tabs/Comments/Comment/ReplyCommentForm/ReplyCommentFormContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/Comment/ReplyCommentForm/ReplyCommentFormContainer.tsx?ref=f2bf026740da1f0bc0de35455551eee82987c57c",
      "patch": "@@ -26,6 +26,7 @@ import {\n   SubmitStatus,\n } from \"../../helpers\";\n import RefreshSettingsFetch from \"../../RefreshSettingsFetch\";\n+import { RTE_RESET_VALUE } from \"../../RTE/RTE\";\n import ReplyEditSubmitStatus from \"../ReplyEditSubmitStatus\";\n import {\n   CreateCommentReplyMutation,\n@@ -155,7 +156,7 @@ export class ReplyCommentFormContainer extends Component<Props, State> {\n     }\n     // Reset errors whenever user clears the form.\n     if (state.touched && state.touched.body && !state.values.body) {\n-      form.reset({});\n+      form.reset({ body: RTE_RESET_VALUE });\n     }\n   };\n "
    },
    {
      "sha": "14a6b11b9f5b3776ad4bc51298e286accf325420",
      "filename": "src/core/client/stream/tabs/Comments/RTE/RTE.tsx",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/f2bf026740da1f0bc0de35455551eee82987c57c/src/core/client/stream/tabs/Comments/RTE/RTE.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/f2bf026740da1f0bc0de35455551eee82987c57c/src/core/client/stream/tabs/Comments/RTE/RTE.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/RTE/RTE.tsx?ref=f2bf026740da1f0bc0de35455551eee82987c57c",
      "patch": "@@ -24,6 +24,8 @@ import { PropTypesOf } from \"coral-ui/types\";\n \n import styles from \"./RTE.css\";\n \n+export const RTE_RESET_VALUE = \"<div><br></div>\";\n+\n interface RTEFeatures {\n   bold?: boolean;\n   italic?: boolean;"
    },
    {
      "sha": "42e43cf6e2333888727e691492bc446c9b24d7c3",
      "filename": "src/core/client/stream/tabs/Comments/Stream/PostCommentForm/PostCommentFormContainer.spec.tsx",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/coralproject/talk/blob/f2bf026740da1f0bc0de35455551eee82987c57c/src/core/client/stream/tabs/Comments/Stream/PostCommentForm/PostCommentFormContainer.spec.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/f2bf026740da1f0bc0de35455551eee82987c57c/src/core/client/stream/tabs/Comments/Stream/PostCommentForm/PostCommentFormContainer.spec.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/Stream/PostCommentForm/PostCommentFormContainer.spec.tsx?ref=f2bf026740da1f0bc0de35455551eee82987c57c",
      "patch": "@@ -8,6 +8,7 @@ import { createPromisifiedStorage } from \"coral-framework/lib/storage\";\n import { act, removeFragmentRefs, wait } from \"coral-framework/testHelpers\";\n import { DeepPartial, PropTypesOf } from \"coral-framework/types\";\n \n+import { RTE_RESET_VALUE } from \"../../RTE/RTE\";\n import { PostCommentFormContainer } from \"./PostCommentFormContainer\";\n \n const contextKey = \"postCommentFormBody\";\n@@ -126,7 +127,7 @@ it(\"creates a comment\", async () => {\n   const createCommentStub = sinon.stub().returns({ edge: { node: {} } });\n   const form = { initialize: noop };\n   const formMock = sinon.mock(form);\n-  formMock.expects(\"initialize\").withArgs({}).once();\n+  formMock.expects(\"initialize\").withArgs({ body: RTE_RESET_VALUE }).once();\n \n   const props = createDefaultProps({\n     createComment: createCommentStub,"
    },
    {
      "sha": "550fcebe2195626ccdb40c7122ac1a68459828ff",
      "filename": "src/core/client/stream/tabs/Comments/Stream/PostCommentForm/PostCommentFormContainer.tsx",
      "status": "modified",
      "additions": 4,
      "deletions": 10,
      "changes": 14,
      "blob_url": "https://github.com/coralproject/talk/blob/f2bf026740da1f0bc0de35455551eee82987c57c/src/core/client/stream/tabs/Comments/Stream/PostCommentForm/PostCommentFormContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/f2bf026740da1f0bc0de35455551eee82987c57c/src/core/client/stream/tabs/Comments/Stream/PostCommentForm/PostCommentFormContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Comments/Stream/PostCommentForm/PostCommentFormContainer.tsx?ref=f2bf026740da1f0bc0de35455551eee82987c57c",
      "patch": "@@ -34,6 +34,7 @@ import {\n   SubmitStatus,\n } from \"../../helpers\";\n import RefreshSettingsFetch from \"../../RefreshSettingsFetch\";\n+import { RTE_RESET_VALUE } from \"../../RTE/RTE\";\n import {\n   CreateCommentMutation,\n   withCreateCommentMutation,\n@@ -134,7 +135,7 @@ export class PostCommentFormContainer extends Component<Props, State> {\n         })\n       );\n       if (submitStatus !== \"RETRY\") {\n-        form.initialize({});\n+        form.initialize({ body: RTE_RESET_VALUE });\n       }\n       this.setState({ submitStatus, nudge: true });\n     } catch (error) {\n@@ -163,14 +164,7 @@ export class PostCommentFormContainer extends Component<Props, State> {\n     state,\n     form\n   ) => {\n-    if (\n-      this.state.submitStatus &&\n-      state.dirty &&\n-      // This is required because the body is somehow being \"dirtied\" once the\n-      // form has been reinitialized.\n-      // FIXME: (wyattjoh) discover why when a comment is submitted, it eventually sets this as the body afterwards\n-      state.values.body !== \"<div><br></div>\"\n-    ) {\n+    if (this.state.submitStatus && state.dirty) {\n       this.setState({ submitStatus: null });\n     }\n     if (state.values.body) {\n@@ -181,7 +175,7 @@ export class PostCommentFormContainer extends Component<Props, State> {\n \n     // Reset errors whenever user clears the form.\n     if (state.touched && state.touched.body && !state.values.body) {\n-      form.reset({});\n+      form.reset({ body: RTE_RESET_VALUE });\n     }\n   };\n "
    }
  ]
}
