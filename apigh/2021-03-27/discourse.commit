{
  "sha": "db7be947df29bb2ab27dd3abd80e3b470dcb74e5",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpkYjdiZTk0N2RmMjliYjJhYjI3ZGQzYWJkODBlM2I0NzBkY2I3NGU1",
  "commit": {
    "author": {
      "name": "Penar Musaraj",
      "email": "pmusaraj@gmail.com",
      "date": "2021-03-26T17:07:19Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-03-26T17:07:19Z"
    },
    "message": "FIX: Allow dismissing Discard Drafts modal via ESC (#12532)",
    "tree": {
      "sha": "21c1bf4b25c1d593a8f855ac7f8d32e4a1c1104f",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/21c1bf4b25c1d593a8f855ac7f8d32e4a1c1104f"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/db7be947df29bb2ab27dd3abd80e3b470dcb74e5",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgXhTHCRBK7hj4Ov3rIwAAdHIIADXQ21PTmm16dPwaUdpoOojh\nZ68+Gd03xUjBZp7JtG2UP72D+z18RRPtW40xokCt578o0uzbIyYGdoXrOpNyWVlj\nePVEyOkDyMGYf+qUsaE4+dyQ8KHMGmGPeWH8A4R5wyKqWboh3eIDsIxG9ksp9XTV\nUOYc4xC3EHwSEUZFK+I0W/qVDXJcTVad42LBv4R3GeWATcIKBif5851J9pVHlIqt\nbaBr6RR20WIw4/v4mCSLhFmdKj83vuO0aF10doUEJFb29gwRytZXbK0pC5PYTKyr\njFKgoidxx9VKOeoW6JeRrhRt36G2oRp1oZuXBxx3Kbg+Npcbjs68mQSmDR0joVc=\n=MKzM\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 21c1bf4b25c1d593a8f855ac7f8d32e4a1c1104f\nparent edc0f6192074e243a36efbbbbc818048a6a31def\nauthor Penar Musaraj <pmusaraj@gmail.com> 1616778439 -0400\ncommitter GitHub <noreply@github.com> 1616778439 -0400\n\nFIX: Allow dismissing Discard Drafts modal via ESC (#12532)\n\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/db7be947df29bb2ab27dd3abd80e3b470dcb74e5",
  "html_url": "https://github.com/discourse/discourse/commit/db7be947df29bb2ab27dd3abd80e3b470dcb74e5",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/comments",
  "author": {
    "login": "pmusaraj",
    "id": 368961,
    "node_id": "MDQ6VXNlcjM2ODk2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/368961?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pmusaraj",
    "html_url": "https://github.com/pmusaraj",
    "followers_url": "https://api.github.com/users/pmusaraj/followers",
    "following_url": "https://api.github.com/users/pmusaraj/following{/other_user}",
    "gists_url": "https://api.github.com/users/pmusaraj/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pmusaraj/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pmusaraj/subscriptions",
    "organizations_url": "https://api.github.com/users/pmusaraj/orgs",
    "repos_url": "https://api.github.com/users/pmusaraj/repos",
    "events_url": "https://api.github.com/users/pmusaraj/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pmusaraj/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "edc0f6192074e243a36efbbbbc818048a6a31def",
      "url": "https://api.github.com/repos/discourse/discourse/commits/edc0f6192074e243a36efbbbbc818048a6a31def",
      "html_url": "https://github.com/discourse/discourse/commit/edc0f6192074e243a36efbbbbc818048a6a31def"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 9,
    "deletions": 9
  },
  "files": [
    {
      "sha": "8bb6568242a8a323930e9fefc14a5c613170c7da",
      "filename": "app/assets/javascripts/discourse/app/components/d-modal.js",
      "status": "modified",
      "additions": 2,
      "deletions": 4,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/app/assets/javascripts/discourse/app/components/d-modal.js",
      "raw_url": "https://github.com/discourse/discourse/raw/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/app/assets/javascripts/discourse/app/components/d-modal.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/components/d-modal.js?ref=db7be947df29bb2ab27dd3abd80e3b470dcb74e5",
      "patch": "@@ -51,7 +51,7 @@ export default Component.extend({\n       //only respond to events when the modal is visible\n       if (!this.element.classList.contains(\"hidden\")) {\n         if (e.which === 27 && this.dismissable) {\n-          next(() => $(\".modal-header button.modal-close\").click());\n+          next(() => this.attrs.closeModal(\"initiatedByESC\"));\n         }\n \n         if (e.which === 13 && this.triggerClickOnEnter(e)) {\n@@ -130,9 +130,7 @@ export default Component.extend({\n       this.set(\"dismissable\", true);\n     }\n \n-    if (data.headerClass) {\n-      this.set(\"headerClass\", data.headerClass);\n-    }\n+    this.set(\"headerClass\", data.headerClass || null);\n \n     if (this.element) {\n       const autofocusInputs = this.element.querySelectorAll("
    },
    {
      "sha": "5c80b74b7d99e2672d991a74fd058af9ba2d43ae",
      "filename": "app/assets/javascripts/discourse/app/mixins/key-enter-escape.js",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/app/assets/javascripts/discourse/app/mixins/key-enter-escape.js",
      "raw_url": "https://github.com/discourse/discourse/raw/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/app/assets/javascripts/discourse/app/mixins/key-enter-escape.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/mixins/key-enter-escape.js?ref=db7be947df29bb2ab27dd3abd80e3b470dcb74e5",
      "patch": "@@ -3,6 +3,10 @@ import { isiPad } from \"discourse/lib/utilities\";\n // A mixin where hitting ESC calls `cancelled` and ctrl+enter calls `save.\n export default {\n   keyDown(e) {\n+    if (document.body.classList.contains(\"modal-open\")) {\n+      return;\n+    }\n+\n     if (e.which === 27) {\n       this.cancelled();\n       return false;"
    },
    {
      "sha": "46c706cbc48d4d4ac7e6be7bd3bb2fc89aefb6e5",
      "filename": "app/assets/javascripts/discourse/app/templates/modal/discard-draft.hbs",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/app/assets/javascripts/discourse/app/templates/modal/discard-draft.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/app/assets/javascripts/discourse/app/templates/modal/discard-draft.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/modal/discard-draft.hbs?ref=db7be947df29bb2ab27dd3abd80e3b470dcb74e5",
      "patch": "@@ -1,4 +1,4 @@\n-{{#d-modal-body dismissable=false headerClass=\"empty\"}}\n+{{#d-modal-body headerClass=\"hidden\"}}\n   <div class=\"instructions\">\n     {{i18n \"post.cancel_composer.confirm\"}}\n   </div>"
    },
    {
      "sha": "d595aea87cd855947447a98fe10094902a5a6e09",
      "filename": "app/assets/stylesheets/common/base/modal.scss",
      "status": "modified",
      "additions": 2,
      "deletions": 4,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/app/assets/stylesheets/common/base/modal.scss",
      "raw_url": "https://github.com/discourse/discourse/raw/db7be947df29bb2ab27dd3abd80e3b470dcb74e5/app/assets/stylesheets/common/base/modal.scss",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/stylesheets/common/base/modal.scss?ref=db7be947df29bb2ab27dd3abd80e3b470dcb74e5",
      "patch": "@@ -54,10 +54,8 @@\n \n .modal-header {\n   display: flex;\n-  &:not(.empty) {\n-    padding: 10px 15px;\n-    border-bottom: 1px solid var(--primary-low);\n-  }\n+  padding: 10px 15px;\n+  border-bottom: 1px solid var(--primary-low);\n   align-items: center;\n \n   .title {"
    }
  ]
}
