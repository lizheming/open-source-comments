{
  "sha": "d67c3d29070699b3b89513cc6857257f41228f0a",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6ZDY3YzNkMjkwNzA2OTliM2I4OTUxM2NjNjg1NzI1N2Y0MTIyOGYwYQ==",
  "commit": {
    "author": {
      "name": "Nick Funk",
      "email": "nick.funk@outlook.com",
      "date": "2020-08-11T22:05:50Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-08-11T22:05:50Z"
    },
    "message": "Mark and allow word list timed out comments (#3097)\n\nWill mark the comment's metdata as a word list\ntime out if it happens and also tag them with\nsuspect or banned word.\n\nThen we show \"possible suspect/banned word\"\nmarkers on the moderate card so moderators can\nmanually review them.\n\nCORL-1264\n\nCo-authored-by: Wyatt Johnson <wyattjoh@gmail.com>",
    "tree": {
      "sha": "6a9a63e83f6b6f8ea806233a25821e9ea4a8b6b7",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/6a9a63e83f6b6f8ea806233a25821e9ea4a8b6b7"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/d67c3d29070699b3b89513cc6857257f41228f0a",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfMxY+CRBK7hj4Ov3rIwAAdHIIAFWDOJOHp7EH2fpnPK9JbXk8\nmIWf+YMtsh0huSDSWHVelwkML4qW/JOAv9A37NDbkEugt4HNOFBUWtu6j1MsSpXg\nk0EjtALx6lZU75swoDV66HzFozpMleNQyXWfMLv3uMEN2YxlcawOiS/fXEwh4lJV\norbHUIadEOsLiShMNRqxOpe0s8QfPeRUM7s6Zxpd4S1i/ao8WqIEjbFZi3V9juUG\nnIzmcbM1VCRQhDmtoL8ekq8FvzJEFlj2oHBfY2IiDB5TJo1ZKNtIvb3eSNxcJIXt\n872wov2N0CSkhmvkFwyajH+IzhTMGUfFcvsOY79yP4ZjLTWQduCRRsBTb6iibYk=\n=3ntG\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 6a9a63e83f6b6f8ea806233a25821e9ea4a8b6b7\nparent 3398bd12c4a76336047248b3c486b08ece51e370\nauthor Nick Funk <nick.funk@outlook.com> 1597183550 -0600\ncommitter GitHub <noreply@github.com> 1597183550 +0000\n\nMark and allow word list timed out comments (#3097)\n\nWill mark the comment's metdata as a word list\ntime out if it happens and also tag them with\nsuspect or banned word.\n\nThen we show \"possible suspect/banned word\"\nmarkers on the moderate card so moderators can\nmanually review them.\n\nCORL-1264\n\nCo-authored-by: Wyatt Johnson <wyattjoh@gmail.com>"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/d67c3d29070699b3b89513cc6857257f41228f0a",
  "html_url": "https://github.com/coralproject/talk/commit/d67c3d29070699b3b89513cc6857257f41228f0a",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/d67c3d29070699b3b89513cc6857257f41228f0a/comments",
  "author": {
    "login": "nick-funk",
    "id": 5751504,
    "node_id": "MDQ6VXNlcjU3NTE1MDQ=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/5751504?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nick-funk",
    "html_url": "https://github.com/nick-funk",
    "followers_url": "https://api.github.com/users/nick-funk/followers",
    "following_url": "https://api.github.com/users/nick-funk/following{/other_user}",
    "gists_url": "https://api.github.com/users/nick-funk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nick-funk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nick-funk/subscriptions",
    "organizations_url": "https://api.github.com/users/nick-funk/orgs",
    "repos_url": "https://api.github.com/users/nick-funk/repos",
    "events_url": "https://api.github.com/users/nick-funk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nick-funk/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "3398bd12c4a76336047248b3c486b08ece51e370",
      "url": "https://api.github.com/repos/coralproject/talk/commits/3398bd12c4a76336047248b3c486b08ece51e370",
      "html_url": "https://github.com/coralproject/talk/commit/3398bd12c4a76336047248b3c486b08ece51e370"
    }
  ],
  "stats": {
    "total": 89,
    "additions": 85,
    "deletions": 4
  },
  "files": [
    {
      "sha": "1c2ab90bb5dc91d570af5afc9a807940cdb9cc7d",
      "filename": "src/core/client/admin/components/ModerateCard/MarkersContainer.spec.tsx",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/coralproject/talk/blob/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/client/admin/components/ModerateCard/MarkersContainer.spec.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/client/admin/components/ModerateCard/MarkersContainer.spec.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/ModerateCard/MarkersContainer.spec.tsx?ref=d67c3d29070699b3b89513cc6857257f41228f0a",
      "patch": "@@ -32,6 +32,11 @@ it(\"renders all markers\", () => {\n             },\n           },\n         },\n+        metadata: {\n+          wordList: {\n+            timedOut: false,\n+          },\n+        },\n       },\n     },\n     settings: {\n@@ -71,6 +76,11 @@ it(\"renders some markers\", () => {\n             },\n           },\n         },\n+        metadata: {\n+          wordList: {\n+            timedOut: false,\n+          },\n+        },\n       },\n     },\n     settings: {"
    },
    {
      "sha": "c441da276a0a048f5ed5131171be79f9d9dcfc83",
      "filename": "src/core/client/admin/components/ModerateCard/MarkersContainer.tsx",
      "status": "modified",
      "additions": 27,
      "deletions": 2,
      "changes": 29,
      "blob_url": "https://github.com/coralproject/talk/blob/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/client/admin/components/ModerateCard/MarkersContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/client/admin/components/ModerateCard/MarkersContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/ModerateCard/MarkersContainer.tsx?ref=d67c3d29070699b3b89513cc6857257f41228f0a",
      "patch": "@@ -38,15 +38,35 @@ const markers: Array<(\n     null,\n   (c) =>\n     (c.revision &&\n-      c.revision.actionCounts.flag.reasons.COMMENT_DETECTED_BANNED_WORD && (\n+      c.revision.actionCounts.flag.reasons.COMMENT_DETECTED_BANNED_WORD &&\n+      c.revision.metadata?.wordList?.timedOut && (\n+        <Localized id=\"moderate-marker-possibleBannedWord\" key={keyCounter++}>\n+          <Marker color=\"reported\">Possible Banned Word</Marker>\n+        </Localized>\n+      )) ||\n+    null,\n+  (c) =>\n+    (c.revision &&\n+      c.revision.actionCounts.flag.reasons.COMMENT_DETECTED_BANNED_WORD &&\n+      !c.revision.metadata?.wordList?.timedOut && (\n         <Localized id=\"moderate-marker-bannedWord\" key={keyCounter++}>\n           <Marker color=\"reported\">Banned Word</Marker>\n         </Localized>\n       )) ||\n     null,\n   (c) =>\n     (c.revision &&\n-      c.revision.actionCounts.flag.reasons.COMMENT_DETECTED_SUSPECT_WORD && (\n+      c.revision.actionCounts.flag.reasons.COMMENT_DETECTED_SUSPECT_WORD &&\n+      c.revision.metadata?.wordList?.timedOut && (\n+        <Localized id=\"moderate-marker-possibleSuspectWord\" key={keyCounter++}>\n+          <Marker color=\"reported\">Possible Suspect Word</Marker>\n+        </Localized>\n+      )) ||\n+    null,\n+  (c) =>\n+    (c.revision &&\n+      c.revision.actionCounts.flag.reasons.COMMENT_DETECTED_SUSPECT_WORD &&\n+      !c.revision.metadata?.wordList?.timedOut && (\n         <Localized id=\"moderate-marker-suspectWord\" key={keyCounter++}>\n           <Marker color=\"reported\">Suspect Word</Marker>\n         </Localized>\n@@ -193,6 +213,11 @@ const enhanced = withFragmentContainer<MarkersContainerProps>({\n             }\n           }\n         }\n+        metadata {\n+          wordList {\n+            timedOut\n+          }\n+        }\n       }\n     }\n   `,"
    },
    {
      "sha": "1b1eab6191e9ad8387887cfd2e18363d96960b60",
      "filename": "src/core/client/admin/components/ModerateCard/__snapshots__/MarkersContainer.spec.tsx.snap",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/coralproject/talk/blob/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/client/admin/components/ModerateCard/__snapshots__/MarkersContainer.spec.tsx.snap",
      "raw_url": "https://github.com/coralproject/talk/raw/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/client/admin/components/ModerateCard/__snapshots__/MarkersContainer.spec.tsx.snap",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/admin/components/ModerateCard/__snapshots__/MarkersContainer.spec.tsx.snap?ref=d67c3d29070699b3b89513cc6857257f41228f0a",
      "patch": "@@ -25,6 +25,11 @@ exports[`renders all markers 1`] = `\n                 },\n               },\n             },\n+            \"metadata\": Object {\n+              \"wordList\": Object {\n+                \"timedOut\": false,\n+              },\n+            },\n           },\n           \"status\": \"PREMOD\",\n         }\n@@ -172,6 +177,11 @@ exports[`renders some markers 1`] = `\n                 },\n               },\n             },\n+            \"metadata\": Object {\n+              \"wordList\": Object {\n+                \"timedOut\": false,\n+              },\n+            },\n           },\n           \"status\": \"PREMOD\",\n         }"
    },
    {
      "sha": "1e6e39e8e29eb3e99c9a0917f457bf5d7ead053f",
      "filename": "src/core/server/graph/schema/schema.graphql",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/coralproject/talk/blob/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/server/graph/schema/schema.graphql",
      "raw_url": "https://github.com/coralproject/talk/raw/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/server/graph/schema/schema.graphql",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/graph/schema/schema.graphql?ref=d67c3d29070699b3b89513cc6857257f41228f0a",
      "patch": "@@ -2655,12 +2655,26 @@ type CommentRevisionPerspectiveMetadata {\n   score: Float!\n }\n \n+type CommentRevisionWordListMetadata {\n+  \"\"\"\n+  timedOut is whether the wordlist analysis timed out when this revision\n+  of the comment was sent through the moderation phases.\n+  \"\"\"\n+  timedOut: Boolean\n+}\n+\n type CommentRevisionMetadata {\n   \"\"\"\n   perspective stores metadata associated with the pipeline analysis of this\n   revision's body.\n   \"\"\"\n   perspective: CommentRevisionPerspectiveMetadata\n+\n+  \"\"\"\n+  wordList metadata stores extra status details about what occurred during\n+  word list analysis of this comment revision.\n+  \"\"\"\n+  wordList: CommentRevisionWordListMetadata\n }\n \n \"\"\""
    },
    {
      "sha": "887df19839ebfd365d0d2869bf69ee2f518d4a6d",
      "filename": "src/core/server/models/comment/revision.ts",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/coralproject/talk/blob/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/server/models/comment/revision.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/server/models/comment/revision.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/models/comment/revision.ts?ref=d67c3d29070699b3b89513cc6857257f41228f0a",
      "patch": "@@ -28,6 +28,18 @@ export interface RevisionMetadata {\n     model: string;\n   };\n \n+  /**\n+   * wordList metadata stores extra status details about what occurred during\n+   * word list analysis of this comment revision.\n+   */\n+  wordList?: {\n+    /**\n+     * timedOut is whether the wordlist analysis timed out when this revision\n+     * of the comment was sent through the moderation phases.\n+     */\n+    timedOut?: boolean;\n+  };\n+\n   /**\n    * nudge when true indicates that the comment was written on the first try\n    * without a warning."
    },
    {
      "sha": "768785522816e8d7e665f4ecde5ff88d2a2fd59f",
      "filename": "src/core/server/services/comments/pipeline/phases/wordList.ts",
      "status": "modified",
      "additions": 10,
      "deletions": 2,
      "changes": 12,
      "blob_url": "https://github.com/coralproject/talk/blob/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/server/services/comments/pipeline/phases/wordList.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/d67c3d29070699b3b89513cc6857257f41228f0a/src/core/server/services/comments/pipeline/phases/wordList.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/comments/pipeline/phases/wordList.ts?ref=d67c3d29070699b3b89513cc6857257f41228f0a",
      "patch": "@@ -43,13 +43,17 @@ export const wordList: IntermediateModerationPhase = ({\n     };\n   } else if (banned === null) {\n     return {\n-      status: GQLCOMMENT_STATUS.SYSTEM_WITHHELD,\n       actions: [\n         {\n           actionType: ACTION_TYPE.FLAG,\n           reason: GQLCOMMENT_FLAG_REASON.COMMENT_DETECTED_BANNED_WORD,\n         },\n       ],\n+      metadata: {\n+        wordList: {\n+          timedOut: true,\n+        },\n+      },\n     };\n   }\n \n@@ -66,13 +70,17 @@ export const wordList: IntermediateModerationPhase = ({\n     };\n   } else if (suspect === null) {\n     return {\n-      status: GQLCOMMENT_STATUS.SYSTEM_WITHHELD,\n       actions: [\n         {\n           actionType: ACTION_TYPE.FLAG,\n           reason: GQLCOMMENT_FLAG_REASON.COMMENT_DETECTED_SUSPECT_WORD,\n         },\n       ],\n+      metadata: {\n+        wordList: {\n+          timedOut: true,\n+        },\n+      },\n     };\n   }\n };"
    },
    {
      "sha": "cf29d1abbf64f6377109054fdf704f770bcbcd5e",
      "filename": "src/locales/en-US/admin.ftl",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/d67c3d29070699b3b89513cc6857257f41228f0a/src/locales/en-US/admin.ftl",
      "raw_url": "https://github.com/coralproject/talk/raw/d67c3d29070699b3b89513cc6857257f41228f0a/src/locales/en-US/admin.ftl",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/locales/en-US/admin.ftl?ref=d67c3d29070699b3b89513cc6857257f41228f0a",
      "patch": "@@ -849,7 +849,9 @@ moderate-navigation-comment-count = { SHORT_NUMBER($count) }\n moderate-marker-preMod = Pre-mod\n moderate-marker-link = Link\n moderate-marker-bannedWord = Banned word\n+moderate-marker-possibleBannedWord = Possible Banned Word\n moderate-marker-suspectWord = Suspect word\n+moderate-marker-possibleSuspectWord = Possible Suspect Word\n moderate-marker-spam = Spam\n moderate-marker-spamDetected = Spam detected\n moderate-marker-toxic = Toxic"
    }
  ]
}
