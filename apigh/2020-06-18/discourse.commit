{
  "sha": "db1bebddce7dfe867b92d027c981fd003fc777fc",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpkYjFiZWJkZGNlN2RmZTg2N2I5MmQwMjdjOTgxZmQwMDNmYzc3N2Zj",
  "commit": {
    "author": {
      "name": "Bianca Nenciu",
      "email": "nbianca@users.noreply.github.com",
      "date": "2020-06-18T10:27:51Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-06-18T10:27:51Z"
    },
    "message": "FIX: Hide the post history for TL4 (#10065)",
    "tree": {
      "sha": "684db2b7ac1e7c65f5dfc467de2983b624739dc0",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/684db2b7ac1e7c65f5dfc467de2983b624739dc0"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/db1bebddce7dfe867b92d027c981fd003fc777fc",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe60GnCRBK7hj4Ov3rIwAAdHIIADPDx7NDp/N3SubuIr5RbP1U\neYOTm3eSmQvOyA6MQQn49HQ00J6jOLW/n0qoBBDgX7haZmr7u69ALg3UXKe5Hd7D\niRcfcP3kmokZUehedyt5YS+J7wuJl+i3Vkay0dkQKGzeOihjP25UfDQ6+Ax+54e6\ns3bQGzRNZIdBa8tW40ogL3i6o2uDMWvWu7hT4mafDjchWI52usJt7bmKs98o/7wc\nRx3Q/8dgK3xDB5ciscRYe8EbwoDPN8wYrCZdGHC47rT1bxe/d55e1qIm54MknZSE\nMuV7zNEFqH6vYMBEpL5D1Ig+mZ12+5NRukBl9x+Jc6xdbIHrG4iyh2w70nAlT64=\n=wUGq\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 684db2b7ac1e7c65f5dfc467de2983b624739dc0\nparent d21a08c284b4e7d30227499f7a0d682b37f51cf2\nauthor Bianca Nenciu <nbianca@users.noreply.github.com> 1592476071 +0300\ncommitter GitHub <noreply@github.com> 1592476071 +0300\n\nFIX: Hide the post history for TL4 (#10065)\n\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/db1bebddce7dfe867b92d027c981fd003fc777fc",
  "html_url": "https://github.com/discourse/discourse/commit/db1bebddce7dfe867b92d027c981fd003fc777fc",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/db1bebddce7dfe867b92d027c981fd003fc777fc/comments",
  "author": {
    "login": "nbianca",
    "id": 23153890,
    "node_id": "MDQ6VXNlcjIzMTUzODkw",
    "avatar_url": "https://avatars3.githubusercontent.com/u/23153890?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nbianca",
    "html_url": "https://github.com/nbianca",
    "followers_url": "https://api.github.com/users/nbianca/followers",
    "following_url": "https://api.github.com/users/nbianca/following{/other_user}",
    "gists_url": "https://api.github.com/users/nbianca/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nbianca/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nbianca/subscriptions",
    "organizations_url": "https://api.github.com/users/nbianca/orgs",
    "repos_url": "https://api.github.com/users/nbianca/repos",
    "events_url": "https://api.github.com/users/nbianca/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nbianca/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d21a08c284b4e7d30227499f7a0d682b37f51cf2",
      "url": "https://api.github.com/repos/discourse/discourse/commits/d21a08c284b4e7d30227499f7a0d682b37f51cf2",
      "html_url": "https://github.com/discourse/discourse/commit/d21a08c284b4e7d30227499f7a0d682b37f51cf2"
    }
  ],
  "stats": {
    "total": 13,
    "additions": 5,
    "deletions": 8
  },
  "files": [
    {
      "sha": "d05296ef33649dacb7da2a5eba1629c4a2ece507",
      "filename": "lib/guardian/post_guardian.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/db1bebddce7dfe867b92d027c981fd003fc777fc/lib/guardian/post_guardian.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/db1bebddce7dfe867b92d027c981fd003fc777fc/lib/guardian/post_guardian.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/lib/guardian/post_guardian.rb?ref=db1bebddce7dfe867b92d027c981fd003fc777fc",
      "patch": "@@ -220,7 +220,7 @@ def can_view_edit_history?(post)\n     end\n \n     authenticated? &&\n-    (is_staff? || @user.has_trust_level?(TrustLevel[4]) || @user.id == post.user_id) &&\n+    (is_staff? || @user.id == post.user_id) &&\n     can_see_post?(post)\n   end\n "
    },
    {
      "sha": "8927ea316eaf8ea268629e1b6410fff41578653d",
      "filename": "spec/components/guardian_spec.rb",
      "status": "modified",
      "additions": 2,
      "deletions": 5,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/db1bebddce7dfe867b92d027c981fd003fc777fc/spec/components/guardian_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/db1bebddce7dfe867b92d027c981fd003fc777fc/spec/components/guardian_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/components/guardian_spec.rb?ref=db1bebddce7dfe867b92d027c981fd003fc777fc",
      "patch": "@@ -890,12 +890,9 @@\n           expect(Guardian.new(moderator).can_see?(post_revision)).to be_truthy\n         end\n \n-        it 'is true for trust level 4' do\n-          expect(Guardian.new(trust_level_4).can_see?(post_revision)).to be_truthy\n-        end\n-\n-        it 'is false for trust level lower than 4' do\n+        it 'is false for trust level equal or lower than 4' do\n           expect(Guardian.new(trust_level_3).can_see?(post_revision)).to be_falsey\n+          expect(Guardian.new(trust_level_4).can_see?(post_revision)).to be_falsey\n         end\n       end\n     end"
    },
    {
      "sha": "6ccc7380d811b3328fdf8492ea9bfaf00aae2bb1",
      "filename": "spec/requests/posts_controller_spec.rb",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/db1bebddce7dfe867b92d027c981fd003fc777fc/spec/requests/posts_controller_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/db1bebddce7dfe867b92d027c981fd003fc777fc/spec/requests/posts_controller_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/requests/posts_controller_spec.rb?ref=db1bebddce7dfe867b92d027c981fd003fc777fc",
      "patch": "@@ -1323,10 +1323,10 @@\n         expect(response.status).to eq(200)\n       end\n \n-      it \"ensures trust level 4 can see the revisions\" do\n+      it \"ensures trust level 4 cannot see the revisions\" do\n         sign_in(Fabricate(:user, trust_level: 4))\n         get \"/posts/#{post_revision.post_id}/revisions/#{post_revision.number}.json\"\n-        expect(response.status).to eq(200)\n+        expect(response.status).to eq(403)\n       end\n     end\n "
    }
  ]
}
