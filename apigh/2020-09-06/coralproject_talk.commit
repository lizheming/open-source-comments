{
  "sha": "7f2e6383ba30c67396e79083142bcd3ca78a621f",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6N2YyZTYzODNiYTMwYzY3Mzk2ZTc5MDgzMTQyYmNkM2NhNzhhNjIxZg==",
  "commit": {
    "author": {
      "name": "Tessa Thornton",
      "email": "tessathornton@gmail.com",
      "date": "2020-09-04T16:12:54Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-09-04T16:12:54Z"
    },
    "message": "ensure comments tagged with staff tags are approved (#3181)",
    "tree": {
      "sha": "9019ecb7aca07be07f926e2055aa4ffd3715b2d0",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/9019ecb7aca07be07f926e2055aa4ffd3715b2d0"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/7f2e6383ba30c67396e79083142bcd3ca78a621f",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfUmeGCRBK7hj4Ov3rIwAAdHIIADIOOZeqRQzwbNdiUFFtjaIN\nEz1Y+cyOXS0OgPIi7WJR9zsNzwYxOfow7wO2QxdQNFjyPx228cvR57/j8Z57i9F2\nWgPRnapZwBrv3MDPQ5qBhL+jNXif6pWBv1f5zyJ+MdY/lRHHK5w8XjUHOlpknTQ2\nQTTEUB2oT7LyK+LHzjscHCHPCQnYcwaMZXUPBXHGmk9w2GxLDhoO3rjLUn/ia48p\nduG+oPfw78PQ93GzfGZIuctCcICrmhdwnQDUWT7QDCcMI5XJI9IsmTYPhHuoPHly\n+C0Cz2HYVeOeuSuov+oPdoAHzsvEdVkB0ciPvEHTTEPumszwlEfG6uTGT5HnE48=\n=DGnd\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 9019ecb7aca07be07f926e2055aa4ffd3715b2d0\nparent a6be167af55307a5aaa0aa7fdde0e5eaf06bacea\nauthor Tessa Thornton <tessathornton@gmail.com> 1599235974 -0400\ncommitter GitHub <noreply@github.com> 1599235974 +0000\n\nensure comments tagged with staff tags are approved (#3181)\n\n"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/7f2e6383ba30c67396e79083142bcd3ca78a621f",
  "html_url": "https://github.com/coralproject/talk/commit/7f2e6383ba30c67396e79083142bcd3ca78a621f",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/7f2e6383ba30c67396e79083142bcd3ca78a621f/comments",
  "author": {
    "login": "tessalt",
    "id": 1789029,
    "node_id": "MDQ6VXNlcjE3ODkwMjk=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/1789029?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tessalt",
    "html_url": "https://github.com/tessalt",
    "followers_url": "https://api.github.com/users/tessalt/followers",
    "following_url": "https://api.github.com/users/tessalt/following{/other_user}",
    "gists_url": "https://api.github.com/users/tessalt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tessalt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tessalt/subscriptions",
    "organizations_url": "https://api.github.com/users/tessalt/orgs",
    "repos_url": "https://api.github.com/users/tessalt/repos",
    "events_url": "https://api.github.com/users/tessalt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tessalt/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a6be167af55307a5aaa0aa7fdde0e5eaf06bacea",
      "url": "https://api.github.com/repos/coralproject/talk/commits/a6be167af55307a5aaa0aa7fdde0e5eaf06bacea",
      "html_url": "https://github.com/coralproject/talk/commit/a6be167af55307a5aaa0aa7fdde0e5eaf06bacea"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 8,
    "deletions": 1
  },
  "files": [
    {
      "sha": "a415f51be98e39b34bcb451805aa15900aaf8171",
      "filename": "src/core/server/models/comment/tag.ts",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/coralproject/talk/blob/7f2e6383ba30c67396e79083142bcd3ca78a621f/src/core/server/models/comment/tag.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/7f2e6383ba30c67396e79083142bcd3ca78a621f/src/core/server/models/comment/tag.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/models/comment/tag.ts?ref=7f2e6383ba30c67396e79083142bcd3ca78a621f",
      "patch": "@@ -22,3 +22,5 @@ export interface CommentTag {\n    */\n   createdAt: Date;\n }\n+\n+export const STAFF_TAGS = [GQLTAG.STAFF, GQLTAG.ADMIN, GQLTAG.MODERATOR];"
    },
    {
      "sha": "5704d4aded0191c58e297b2e682ccd95351277e4",
      "filename": "src/core/server/services/comments/pipeline/phases/approve.ts",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/coralproject/talk/blob/7f2e6383ba30c67396e79083142bcd3ca78a621f/src/core/server/services/comments/pipeline/phases/approve.ts",
      "raw_url": "https://github.com/coralproject/talk/raw/7f2e6383ba30c67396e79083142bcd3ca78a621f/src/core/server/services/comments/pipeline/phases/approve.ts",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/server/services/comments/pipeline/phases/approve.ts?ref=7f2e6383ba30c67396e79083142bcd3ca78a621f",
      "patch": "@@ -1,3 +1,6 @@\n+import { intersection } from \"lodash\";\n+\n+import { STAFF_TAGS } from \"coral-server/models/comment/tag\";\n import {\n   IntermediateModerationPhase,\n   IntermediatePhaseResult,\n@@ -8,6 +11,8 @@ import {\n   GQLTAG,\n } from \"coral-server/graph/schema/__generated__/types\";\n \n+const APPROVED_TAGS = STAFF_TAGS.concat(GQLTAG.EXPERT);\n+\n export const approve: IntermediateModerationPhase = ({\n   tags,\n }): IntermediatePhaseResult | void => {\n@@ -20,7 +25,7 @@ export const approve: IntermediateModerationPhase = ({\n   //   automatically approved. We will only see EXPERT\n   //   tags assigned when we are in Q&A mode, so we can\n   //   trust this simple tag type check.\n-  if (tags.includes(GQLTAG.STAFF) || tags.includes(GQLTAG.EXPERT)) {\n+  if (intersection(APPROVED_TAGS, tags).length > 0) {\n     return {\n       status: GQLCOMMENT_STATUS.APPROVED,\n     };"
    }
  ]
}
