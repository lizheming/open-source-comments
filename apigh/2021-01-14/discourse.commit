{
  "sha": "8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo4ZWUzZDJkOTU0ZTQzZGMxNWJlZDAwY2ZiNThjZmQ1ZWU4NWJmMzYz",
  "commit": {
    "author": {
      "name": "Joffrey JAFFEUX",
      "email": "j.jaffeux@gmail.com",
      "date": "2021-01-14T09:19:08Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-01-14T09:19:08Z"
    },
    "message": "FIX: prevents debouncing and query to override each other (#11704)\n\nBefore this change we were setting the input after the query has been done, resulting in us overwriting the input if the user types during the query.\r\nWe don't need to update it after the query, we just need to ensure it's set when we load the page and then it should stay in sync.",
    "tree": {
      "sha": "65422cd263ea890f76b3fa61d30847a9f7618e7a",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/65422cd263ea890f76b3fa61d30847a9f7618e7a"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgAAyMCRBK7hj4Ov3rIwAAdHIIABbAKMRaZE3EcIabJ9KGmiFx\n1g/R4sKBsNhDBIBDwX3mLZNX8MX+wXCVkASIFeFpt5HqtFz3Zfo49iQufVdiBBbs\n37kqy7i3WcIFXejUARtMOgmqkBKXnxdOb1qTa42cYbKRv4LZAQBZRqk2qTZaauoO\nhXVtNUGIRwgOVINAgUMKjIkmRky9fwRGZI52qUX2EjvdIkFS5Mc4ZXmc5raBwQdV\nx8GSigwQrJw/cwPAQCSHA/C1MW08kPbpJ3Mxw8KEoN8BAb7hXsCt+c+h2UkOuZAM\nazMQSIISLNTaYpDY4ixXZS1g+Vw+Ssfy1KCmkFhSfZNXpItSk5heIudMQaxeusw=\n=xER9\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 65422cd263ea890f76b3fa61d30847a9f7618e7a\nparent 378b925211aa2ff69d24a58cbbc2aabd9a6fd8b9\nauthor Joffrey JAFFEUX <j.jaffeux@gmail.com> 1610615948 +0100\ncommitter GitHub <noreply@github.com> 1610615948 +0100\n\nFIX: prevents debouncing and query to override each other (#11704)\n\nBefore this change we were setting the input after the query has been done, resulting in us overwriting the input if the user types during the query.\r\nWe don't need to update it after the query, we just need to ensure it's set when we load the page and then it should stay in sync."
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363",
  "html_url": "https://github.com/discourse/discourse/commit/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363/comments",
  "author": {
    "login": "jjaffeux",
    "id": 339945,
    "node_id": "MDQ6VXNlcjMzOTk0NQ==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/339945?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jjaffeux",
    "html_url": "https://github.com/jjaffeux",
    "followers_url": "https://api.github.com/users/jjaffeux/followers",
    "following_url": "https://api.github.com/users/jjaffeux/following{/other_user}",
    "gists_url": "https://api.github.com/users/jjaffeux/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jjaffeux/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jjaffeux/subscriptions",
    "organizations_url": "https://api.github.com/users/jjaffeux/orgs",
    "repos_url": "https://api.github.com/users/jjaffeux/repos",
    "events_url": "https://api.github.com/users/jjaffeux/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jjaffeux/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "378b925211aa2ff69d24a58cbbc2aabd9a6fd8b9",
      "url": "https://api.github.com/repos/discourse/discourse/commits/378b925211aa2ff69d24a58cbbc2aabd9a6fd8b9",
      "html_url": "https://github.com/discourse/discourse/commit/378b925211aa2ff69d24a58cbbc2aabd9a6fd8b9"
    }
  ],
  "stats": {
    "total": 44,
    "additions": 27,
    "deletions": 17
  },
  "files": [
    {
      "sha": "fe78c4caa2c165ad51c6d2f75411bebb55938e12",
      "filename": "app/assets/javascripts/discourse/app/controllers/users.js",
      "status": "modified",
      "additions": 15,
      "deletions": 15,
      "changes": 30,
      "blob_url": "https://github.com/discourse/discourse/blob/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363/app/assets/javascripts/discourse/app/controllers/users.js",
      "raw_url": "https://github.com/discourse/discourse/raw/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363/app/assets/javascripts/discourse/app/controllers/users.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/controllers/users.js?ref=8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363",
      "patch": "@@ -1,4 +1,5 @@\n import Controller, { inject as controller } from \"@ember/controller\";\n+import { action } from \"@ember/object\";\n import discourseDebounce from \"discourse-common/lib/debounce\";\n import { equal } from \"@ember/object/computed\";\n import { longDate } from \"discourse/lib/formatter\";\n@@ -12,6 +13,7 @@ export default Controller.extend({\n   asc: null,\n   name: \"\",\n   group: null,\n+  nameInput: null,\n   exclude_usernames: null,\n   isLoading: false,\n \n@@ -20,6 +22,8 @@ export default Controller.extend({\n   loadUsers(params) {\n     this.set(\"isLoading\", true);\n \n+    this.set(\"nameInput\", params.name);\n+\n     this.store\n       .find(\"directoryItem\", params)\n       .then((model) => {\n@@ -28,33 +32,29 @@ export default Controller.extend({\n           model,\n           lastUpdatedAt: lastUpdatedAt ? longDate(lastUpdatedAt) : null,\n           period: params.period,\n-          nameInput: params.name,\n         });\n       })\n       .finally(() => {\n         this.set(\"isLoading\", false);\n       });\n   },\n \n-  @observes(\"nameInput\")\n-  _setName() {\n-    discourseDebounce(\n-      this,\n-      function () {\n-        this.set(\"name\", this.nameInput);\n-      },\n-      500\n-    );\n+  @action\n+  onFilterChanged(filter) {\n+    discourseDebounce(this, this._setName, filter, 500);\n+  },\n+\n+  _setName(name) {\n+    this.set(\"name\", name);\n   },\n \n   @observes(\"model.canLoadMore\")\n-  _showFooter: function () {\n+  _showFooter() {\n     this.set(\"application.showFooter\", !this.get(\"model.canLoadMore\"));\n   },\n \n-  actions: {\n-    loadMore() {\n-      this.model.loadMore();\n-    },\n+  @action\n+  loadMore() {\n+    this.model.loadMore();\n   },\n });"
    },
    {
      "sha": "05c929f11332abeb7449ca5501e5ac9474e8df64",
      "filename": "app/assets/javascripts/discourse/app/templates/mobile/users.hbs",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363/app/assets/javascripts/discourse/app/templates/mobile/users.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363/app/assets/javascripts/discourse/app/templates/mobile/users.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/mobile/users.hbs?ref=8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363",
      "patch": "@@ -11,7 +11,12 @@\n             {{lastUpdatedAt}}\n           </div>\n         {{/if}}\n-        {{text-field value=nameInput placeholderKey=\"directory.filter_name\" class=\"filter-name no-blur\"}}\n+        {{input\n+          value=(readonly nameInput)\n+          input=(action \"onFilterChanged\" value=\"target.value\")\n+          placeholderKey=\"directory.filter_name\"\n+          class=\"filter-name no-blur\"\n+        }}\n       </div>\n \n       {{#conditional-loading-spinner condition=model.loading}}"
    },
    {
      "sha": "77446fbc76478c5059c9452394de1942f1ef86f1",
      "filename": "app/assets/javascripts/discourse/app/templates/users.hbs",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363/app/assets/javascripts/discourse/app/templates/users.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363/app/assets/javascripts/discourse/app/templates/users.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/users.hbs?ref=8ee3d2d954e43dc15bed00cfb58cfd5ee85bf363",
      "patch": "@@ -19,7 +19,12 @@\n                 {{i18n \"directory.total_rows\" count=model.totalRows}}\n               {{/if}}\n             </span>\n-            {{text-field value=nameInput placeholderKey=\"directory.filter_name\" class=\"filter-name no-blur\"}}\n+            {{input\n+              value=(readonly nameInput)\n+              input=(action \"onFilterChanged\" value=\"target.value\")\n+              placeholderKey=\"directory.filter_name\"\n+              class=\"filter-name no-blur\"\n+            }}\n           </div>\n         </div>\n "
    }
  ]
}
