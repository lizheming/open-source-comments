{
  "sha": "73fa4263fbed168aa17bd4058dfdc9a78a4ab244",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo3M2ZhNDI2M2ZiZWQxNjhhYTE3YmQ0MDU4ZGZkYzlhNzhhNGFiMjQ0",
  "commit": {
    "author": {
      "name": "Arpit Jalan",
      "email": "arpit@techapj.com",
      "date": "2021-02-23T11:17:54Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-02-23T11:17:54Z"
    },
    "message": "FIX: log warning when context is missing when a user is destroyed (#12182)",
    "tree": {
      "sha": "265dcea5029bac9990f09088ba83d386f37befce",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/265dcea5029bac9990f09088ba83d386f37befce"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/73fa4263fbed168aa17bd4058dfdc9a78a4ab244",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgNORiCRBK7hj4Ov3rIwAAdHIIAGdqYmMjzn7dCCSBYmICbZEK\noOxTJep53XEe4EaHznHohZdFbmWP/Z8qwPF+bGHITXxZKHUpklCdgq1okyK+cS0m\nZ7HNZ94ex+qstfTtRO4pgkWDIA5RZlW0ZysId2B6YoyXWNE0Bp0gc2F+BXi+jFHz\nAflyhpoArN5sx/VrMv2yPWmPvuNfwYcVESXtTK0UoKeuR1R/JqPHpLL/4OLtWPgy\nZxskbtreoxlMFeA1uao7LZcrmOxin0LE7BKq/f5IQEySGiivQsvjpJu6LdMPwe9K\nwKLp842+zG+WbrCnya+Jg2Fk5Z478t/oSBq8m9AE/DudHt/jtoHQUq/8TwhZxes=\n=egpI\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 265dcea5029bac9990f09088ba83d386f37befce\nparent 1844bde57cf7a1456c63cd3d2abf8812a45766bc\nauthor Arpit Jalan <arpit@techapj.com> 1614079074 +0530\ncommitter GitHub <noreply@github.com> 1614079074 +0530\n\nFIX: log warning when context is missing when a user is destroyed (#12182)\n\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/73fa4263fbed168aa17bd4058dfdc9a78a4ab244",
  "html_url": "https://github.com/discourse/discourse/commit/73fa4263fbed168aa17bd4058dfdc9a78a4ab244",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/73fa4263fbed168aa17bd4058dfdc9a78a4ab244/comments",
  "author": {
    "login": "techAPJ",
    "id": 5732281,
    "node_id": "MDQ6VXNlcjU3MzIyODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5732281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/techAPJ",
    "html_url": "https://github.com/techAPJ",
    "followers_url": "https://api.github.com/users/techAPJ/followers",
    "following_url": "https://api.github.com/users/techAPJ/following{/other_user}",
    "gists_url": "https://api.github.com/users/techAPJ/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/techAPJ/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/techAPJ/subscriptions",
    "organizations_url": "https://api.github.com/users/techAPJ/orgs",
    "repos_url": "https://api.github.com/users/techAPJ/repos",
    "events_url": "https://api.github.com/users/techAPJ/events{/privacy}",
    "received_events_url": "https://api.github.com/users/techAPJ/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1844bde57cf7a1456c63cd3d2abf8812a45766bc",
      "url": "https://api.github.com/repos/discourse/discourse/commits/1844bde57cf7a1456c63cd3d2abf8812a45766bc",
      "html_url": "https://github.com/discourse/discourse/commit/1844bde57cf7a1456c63cd3d2abf8812a45766bc"
    }
  ],
  "stats": {
    "total": 10,
    "additions": 10,
    "deletions": 0
  },
  "files": [
    {
      "sha": "13ebf83cf541d72cc679ed246932ddfe7d2817bf",
      "filename": "app/services/user_destroyer.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/73fa4263fbed168aa17bd4058dfdc9a78a4ab244/app/services/user_destroyer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/73fa4263fbed168aa17bd4058dfdc9a78a4ab244/app/services/user_destroyer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/services/user_destroyer.rb?ref=73fa4263fbed168aa17bd4058dfdc9a78a4ab244",
      "patch": "@@ -93,6 +93,7 @@ def destroy(user, opts = {})\n             deleted_by = @actor\n           end\n           StaffActionLogger.new(deleted_by).log_user_deletion(user, opts.slice(:context))\n+          Rails.logger.warn(\"User destroyed without context from: #{caller_locations(14, 1)[0]}\") if opts.slice(:context).blank?\n         end\n         MessageBus.publish \"/logout\", result.id, user_ids: [result.id]\n       end"
    },
    {
      "sha": "8ac418dad909746f11a3d67190d3a9c4e960a036",
      "filename": "spec/services/user_destroyer_spec.rb",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/discourse/discourse/blob/73fa4263fbed168aa17bd4058dfdc9a78a4ab244/spec/services/user_destroyer_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/73fa4263fbed168aa17bd4058dfdc9a78a4ab244/spec/services/user_destroyer_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/services/user_destroyer_spec.rb?ref=73fa4263fbed168aa17bd4058dfdc9a78a4ab244",
      "patch": "@@ -85,6 +85,15 @@\n       end\n     end\n \n+    context 'context is missing' do\n+      it \"logs warning message if context is missing\" do\n+        messages = track_log_messages(level: Logger::WARN) do\n+          UserDestroyer.new(admin).destroy(user)\n+        end\n+        expect(messages[0][2]).to include(\"User destroyed without context from:\")\n+      end\n+    end\n+\n     context \"with a reviewable post\" do\n       let!(:reviewable) { Fabricate(:reviewable, created_by: user) }\n "
    }
  ]
}
