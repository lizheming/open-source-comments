{
  "sha": "a7c1069cf5feab721a166e7796ce725287a46189",
  "node_id": "MDY6Q29tbWl0NjI2ODQxOTphN2MxMDY5Y2Y1ZmVhYjcyMWExNjZlNzc5NmNlNzI1Mjg3YTQ2MTg5",
  "commit": {
    "author": {
      "name": "Benoit Latinier",
      "email": "benoit@latinier.fr",
      "date": "2021-03-22T22:29:43Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-03-22T22:29:43Z"
    },
    "message": "Merge pull request #704 from ix5/client-css-no-inline\n\nServe isso.css separately instead of inline",
    "tree": {
      "sha": "1137bef4938b5d97a4bb278384b4bc447d165385",
      "url": "https://api.github.com/repos/posativ/isso/git/trees/1137bef4938b5d97a4bb278384b4bc447d165385"
    },
    "url": "https://api.github.com/repos/posativ/isso/git/commits/a7c1069cf5feab721a166e7796ce725287a46189",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgWRpXCRBK7hj4Ov3rIwAAdHIIAFkZnOW34w1tiWLcFgrWLKUg\nEkZ/YAYsmiyrieURX0SszKcRJ9wQORrvBitj3sigA83wpbH4K9ZExqn292Mlyvem\ncyu0T4oQNTwooQbOisGy1uqNHA9G+TarniK5xPruCeovHt7gZyOUewUxXtqkb5k+\ndP/vmvFiIOu/IomZ3PTQRwOnZcdbHGXFXScRcajslr/O7pIJl/BgkJYNJpl5TN5n\nMqJ8l+qdG6UESNbMp7lgaIiiYXkbK1bz3v96UvpvfHObu2u+uOH3PQxktmGadGRs\nXbcchxTUdb3eLyDlyzyhNSFljVku00aD1cHjvEP4KWi9myZn1Y7yDrG6VV87iNw=\n=qa9F\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 1137bef4938b5d97a4bb278384b4bc447d165385\nparent c73694959a2beea27debb2c4001e9a593d58f270\nparent 62dc44b83996b4a830480d1c2b526810c5858ea7\nauthor Benoit Latinier <benoit@latinier.fr> 1616452183 +0100\ncommitter GitHub <noreply@github.com> 1616452183 +0100\n\nMerge pull request #704 from ix5/client-css-no-inline\n\nServe isso.css separately instead of inline"
    }
  },
  "url": "https://api.github.com/repos/posativ/isso/commits/a7c1069cf5feab721a166e7796ce725287a46189",
  "html_url": "https://github.com/posativ/isso/commit/a7c1069cf5feab721a166e7796ce725287a46189",
  "comments_url": "https://api.github.com/repos/posativ/isso/commits/a7c1069cf5feab721a166e7796ce725287a46189/comments",
  "author": {
    "login": "blatinier",
    "id": 1086629,
    "node_id": "MDQ6VXNlcjEwODY2Mjk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1086629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/blatinier",
    "html_url": "https://github.com/blatinier",
    "followers_url": "https://api.github.com/users/blatinier/followers",
    "following_url": "https://api.github.com/users/blatinier/following{/other_user}",
    "gists_url": "https://api.github.com/users/blatinier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/blatinier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/blatinier/subscriptions",
    "organizations_url": "https://api.github.com/users/blatinier/orgs",
    "repos_url": "https://api.github.com/users/blatinier/repos",
    "events_url": "https://api.github.com/users/blatinier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/blatinier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c73694959a2beea27debb2c4001e9a593d58f270",
      "url": "https://api.github.com/repos/posativ/isso/commits/c73694959a2beea27debb2c4001e9a593d58f270",
      "html_url": "https://github.com/posativ/isso/commit/c73694959a2beea27debb2c4001e9a593d58f270"
    },
    {
      "sha": "62dc44b83996b4a830480d1c2b526810c5858ea7",
      "url": "https://api.github.com/repos/posativ/isso/commits/62dc44b83996b4a830480d1c2b526810c5858ea7",
      "html_url": "https://github.com/posativ/isso/commit/62dc44b83996b4a830480d1c2b526810c5858ea7"
    }
  ],
  "stats": {
    "total": 29,
    "additions": 20,
    "deletions": 9
  },
  "files": [
    {
      "sha": "e289bd96ca263135321bd6fdc3f8c20cbb5d38eb",
      "filename": "CHANGES.rst",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/posativ/isso/blob/a7c1069cf5feab721a166e7796ce725287a46189/CHANGES.rst",
      "raw_url": "https://github.com/posativ/isso/raw/a7c1069cf5feab721a166e7796ce725287a46189/CHANGES.rst",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/CHANGES.rst?ref=a7c1069cf5feab721a166e7796ce725287a46189",
      "patch": "@@ -8,6 +8,10 @@ Changelog for Isso\n \n - Don't ignore missing configuration files.\n   (Jelmer VernooÄ³)\n+- Serve isso.css separately to avoid `style-src: unsafe-inline` CSP and allow\n+  clients to override fetch location (#704, ix5):\n+\n+    data-isso-css-url=\"https://comments.example.org/css/isso.css\"\n - New \"samesite\" option in [server] section to override SameSite header for\n   cookies. (#700, ix5)\n - Fallback for SameSite header depending on whether host is served over https"
    },
    {
      "sha": "a17e035a172d1c9e1883be61231af3e2bb917c72",
      "filename": "docs/docs/configuration/client.rst",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/posativ/isso/blob/a7c1069cf5feab721a166e7796ce725287a46189/docs/docs/configuration/client.rst",
      "raw_url": "https://github.com/posativ/isso/raw/a7c1069cf5feab721a166e7796ce725287a46189/docs/docs/configuration/client.rst",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/docs/docs/configuration/client.rst?ref=a7c1069cf5feab721a166e7796ce725287a46189",
      "patch": "@@ -9,6 +9,7 @@ preferably in the script tag which embeds the JS:\n     <script data-isso=\"/prefix/\"\n             data-isso-id=\"thread-id\"\n             data-isso-css=\"true\"\n+            data-isso-css-url=\"null\"\n             data-isso-lang=\"ru\"\n             data-isso-reply-to-self=\"false\"\n             data-isso-require-author=\"false\"\n@@ -97,6 +98,16 @@ override the API location:\n \n     <script data-isso=\"/isso\" src=\"/path/to/embed.min.js\"></script>\n \n+data-isso-css-url\n+-----------------\n+\n+Set URL from which to fetch ``isso.css``, e.g. from a CDN.\n+Defaults to fetching from the API endpoint.\n+\n+.. code-block:: html\n+\n+    <script src=\"...\" data-isso-css-url=\"/path/to/isso.css\"></script>\n+\n data-isso-css\n -------------\n "
    },
    {
      "sha": "4fe130937538691778627f27b89d6be066decd79",
      "filename": "isso/js/app/config.js",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/posativ/isso/blob/a7c1069cf5feab721a166e7796ce725287a46189/isso/js/app/config.js",
      "raw_url": "https://github.com/posativ/isso/raw/a7c1069cf5feab721a166e7796ce725287a46189/isso/js/app/config.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/js/app/config.js?ref=a7c1069cf5feab721a166e7796ce725287a46189",
      "patch": "@@ -3,6 +3,7 @@ define(function() {\n \n     var config = {\n         \"css\": true,\n+        \"css-url\": null,\n         \"lang\": (navigator.language || navigator.userLanguage).split(\"-\")[0],\n         \"reply-to-self\": false,\n         \"require-email\": false,"
    },
    {
      "sha": "ff9ba656c8542f59e2b3a870459ba973271673d5",
      "filename": "isso/js/app/text/css.js",
      "status": "removed",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/posativ/isso/blob/c73694959a2beea27debb2c4001e9a593d58f270/isso/js/app/text/css.js",
      "raw_url": "https://github.com/posativ/isso/raw/c73694959a2beea27debb2c4001e9a593d58f270/isso/js/app/text/css.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/js/app/text/css.js?ref=c73694959a2beea27debb2c4001e9a593d58f270",
      "patch": "@@ -1,5 +0,0 @@\n-define([\"text!../../../css/isso.css\"], function(isso) {\n-    return {\n-        inline: isso\n-    };\n-});"
    },
    {
      "sha": "f4aa47ac90aa7743f422f3f183f603351ee6c2bd",
      "filename": "isso/js/build.count.js",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/posativ/isso/blob/a7c1069cf5feab721a166e7796ce725287a46189/isso/js/build.count.js",
      "raw_url": "https://github.com/posativ/isso/raw/a7c1069cf5feab721a166e7796ce725287a46189/isso/js/build.count.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/js/build.count.js?ref=a7c1069cf5feab721a166e7796ce725287a46189",
      "patch": "@@ -3,7 +3,6 @@\n     mainConfigFile: 'config.js',\n     paths: {\n         \"app/text/svg\": \"app/text/dummy\",\n-        \"app/text/css\": \"app/text/dummy\"\n     },\n \n     name: \"../../node_modules/almond/almond\","
    },
    {
      "sha": "52c805ef6c21f339a5dd37481bb44e1dda3a4376",
      "filename": "isso/js/embed.js",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/posativ/isso/blob/a7c1069cf5feab721a166e7796ce725287a46189/isso/js/embed.js",
      "raw_url": "https://github.com/posativ/isso/raw/a7c1069cf5feab721a166e7796ce725287a46189/isso/js/embed.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/js/embed.js?ref=a7c1069cf5feab721a166e7796ce725287a46189",
      "patch": "@@ -3,7 +3,7 @@\n  * Distributed under the MIT license\n  */\n \n-require([\"app/lib/ready\", \"app/config\", \"app/i18n\", \"app/api\", \"app/isso\", \"app/count\", \"app/dom\", \"app/text/css\", \"app/text/svg\", \"app/jade\"], function(domready, config, i18n, api, isso, count, $, css, svg, jade) {\n+require([\"app/lib/ready\", \"app/config\", \"app/i18n\", \"app/api\", \"app/isso\", \"app/count\", \"app/dom\", \"app/text/svg\", \"app/jade\"], function(domready, config, i18n, api, isso, count, $, svg, jade) {\n \n     \"use strict\";\n \n@@ -20,10 +20,11 @@ require([\"app/lib/ready\", \"app/config\", \"app/i18n\", \"app/api\", \"app/isso\", \"app/\n         heading = $.new(\"h4\");\n \n         if (config[\"css\"] && $(\"style#isso-style\") === null) {\n-            var style = $.new(\"style\");\n+            var style = $.new(\"link\");\n             style.id = \"isso-style\";\n+            style.rel =\"stylesheet\";\n             style.type = \"text/css\";\n-            style.textContent = css.inline;\n+            style.href = config[\"css-url\"] ? config[\"css-url\"] : api.endpoint + \"/css/isso.css\";\n             $(\"head\").append(style);\n         }\n "
    }
  ]
}
