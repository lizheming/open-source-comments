{
  "sha": "4f36f604c8a6321df39eb068b690ab25bec1240a",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo0ZjM2ZjYwNGM4YTYzMjFkZjM5ZWIwNjhiNjkwYWIyNWJlYzEyNDBh",
  "commit": {
    "author": {
      "name": "Gerhard Schlager",
      "email": "mail@gerhard-schlager.at",
      "date": "2021-04-30T11:54:45Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-04-30T11:54:45Z"
    },
    "message": "FIX: Looking up translation overrides by symbol failed when `count` is used (#12896)",
    "tree": {
      "sha": "cf84c0090e443d4a02bf27a73ea3b1ee13152227",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/cf84c0090e443d4a02bf27a73ea3b1ee13152227"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/4f36f604c8a6321df39eb068b690ab25bec1240a",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgi/AFCRBK7hj4Ov3rIwAApoQIAA6v21fZO8l9X2gbvAlDenD2\nzZdNdMP9/Pa4Kp9H1b9LW3jJxOiV1rizyDAIVJsmXbNnSh3u/8XHCycjP5Q0vn2H\nK7DLSG9+b40FJyNSdhg+XBu0O+GBgP20a9G1qszeKZ2RgDIcwI88flpG0+pBiTlf\nZ+EailFAQfzt+rmjH94us4fp1ugh7J+Y1I1jhluPT9WdCvojuAlxck7PUF8p3Utc\nMieysSpcJGZEQmrjElBXPuPBWPmvR4e0JTKj4H6cFh5QGRly3VxR28hzD38F+OdE\no6/yzBr9tKm0DPY2REX8IBet3GRZWDG2vnEi7W+MfygCC/A1LwhARMrnwxmUHQk=\n=Wnmt\n-----END PGP SIGNATURE-----\n",
      "payload": "tree cf84c0090e443d4a02bf27a73ea3b1ee13152227\nparent 0188d53f3a57727b374f015fc5fdeb9e4ee93848\nauthor Gerhard Schlager <mail@gerhard-schlager.at> 1619783685 +0200\ncommitter GitHub <noreply@github.com> 1619783685 +0200\n\nFIX: Looking up translation overrides by symbol failed when `count` is used (#12896)\n\n"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/4f36f604c8a6321df39eb068b690ab25bec1240a",
  "html_url": "https://github.com/discourse/discourse/commit/4f36f604c8a6321df39eb068b690ab25bec1240a",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/4f36f604c8a6321df39eb068b690ab25bec1240a/comments",
  "author": {
    "login": "gschlager",
    "id": 473736,
    "node_id": "MDQ6VXNlcjQ3MzczNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/473736?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gschlager",
    "html_url": "https://github.com/gschlager",
    "followers_url": "https://api.github.com/users/gschlager/followers",
    "following_url": "https://api.github.com/users/gschlager/following{/other_user}",
    "gists_url": "https://api.github.com/users/gschlager/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gschlager/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gschlager/subscriptions",
    "organizations_url": "https://api.github.com/users/gschlager/orgs",
    "repos_url": "https://api.github.com/users/gschlager/repos",
    "events_url": "https://api.github.com/users/gschlager/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gschlager/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0188d53f3a57727b374f015fc5fdeb9e4ee93848",
      "url": "https://api.github.com/repos/discourse/discourse/commits/0188d53f3a57727b374f015fc5fdeb9e4ee93848",
      "html_url": "https://github.com/discourse/discourse/commit/0188d53f3a57727b374f015fc5fdeb9e4ee93848"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 8,
    "deletions": 1
  },
  "files": [
    {
      "sha": "2fd498f66870997c0c46a2c5391edde2c6d22663",
      "filename": "lib/i18n/backend/discourse_i18n.rb",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/discourse/discourse/blob/4f36f604c8a6321df39eb068b690ab25bec1240a/lib/i18n/backend/discourse_i18n.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/4f36f604c8a6321df39eb068b690ab25bec1240a/lib/i18n/backend/discourse_i18n.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/lib/i18n/backend/discourse_i18n.rb?ref=4f36f604c8a6321df39eb068b690ab25bec1240a",
      "patch": "@@ -91,6 +91,7 @@ def lookup(locale, key, scope = [], options = {})\n         return existing_translations if scope.is_a?(Array) && scope.include?(:models)\n \n         overrides = options.dig(:overrides, locale)\n+        key = key.to_s\n \n         if overrides\n           if options[:count]\n@@ -112,7 +113,7 @@ def lookup(locale, key, scope = [], options = {})\n               result = {}\n \n               remapped_translations.merge(overrides).each do |k, v|\n-                result[k.split('.').last.to_sym] = v if k != key && k.start_with?(key.to_s)\n+                result[k.split('.').last.to_sym] = v if k != key && k.start_with?(key)\n               end\n               return result if result.size > 0\n             end"
    },
    {
      "sha": "cd52c799ede81dab31126c8b10e9c50c5a8502ef",
      "filename": "spec/components/freedom_patches/translate_accelerator_spec.rb",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/4f36f604c8a6321df39eb068b690ab25bec1240a/spec/components/freedom_patches/translate_accelerator_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/4f36f604c8a6321df39eb068b690ab25bec1240a/spec/components/freedom_patches/translate_accelerator_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/components/freedom_patches/translate_accelerator_spec.rb?ref=4f36f604c8a6321df39eb068b690ab25bec1240a",
      "patch": "@@ -179,6 +179,12 @@ def override_translation(locale, key, value)\n       expect(I18n.t('items', count: 1)).to eq('one fish')\n     end\n \n+    it \"works with strings and symbols for non-pluralized string when count is given\" do\n+      override_translation('en', 'fish', 'trout')\n+      expect(I18n.t(:fish, count: 1)).to eq('trout')\n+      expect(I18n.t('fish', count: 1)).to eq('trout')\n+    end\n+\n     it \"supports one and other with fallback locale\" do\n       override_translation('en_GB', 'items.one', 'one fish')\n       override_translation('en_GB', 'items.other', '%{count} fishies')"
    }
  ]
}
