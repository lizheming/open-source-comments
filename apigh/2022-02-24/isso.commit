{
  "sha": "568debf6737d2f3462bdd9baa5ace45031b8ed95",
  "node_id": "C_kwDOAF-mA9oAKDU2OGRlYmY2NzM3ZDJmMzQ2MmJkZDliYWE1YWNlNDUwMzFiOGVkOTU",
  "commit": {
    "author": {
      "name": "ix5",
      "email": "ix5@users.noreply.github.com",
      "date": "2022-02-23T10:43:56Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2022-02-23T10:43:56Z"
    },
    "message": "admin: Use textarea for comment editing (#793)\n\nUse a `<textarea>` element to let the user properly edit\r\ncomments, where `contenteditable` was poorly suited for\r\nmulti-line input.",
    "tree": {
      "sha": "df40230a8f028453876018aa084718b3dab69f02",
      "url": "https://api.github.com/repos/posativ/isso/git/trees/df40230a8f028453876018aa084718b3dab69f02"
    },
    "url": "https://api.github.com/repos/posativ/isso/git/commits/568debf6737d2f3462bdd9baa5ace45031b8ed95",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiFg/sCRBK7hj4Ov3rIwAAEKEIAEjngEhqQhH4RG0WJtkiOREN\nzE4j9gjMOrMS3+u31MRMBKCyt8BwoMGY90HgiX1bSBVACD/twT17fncT6bo8GUnB\n7o8q26ILx2n+bL30J75hAxFWu1UPADDIL72kMnVR21eivHENJMRGU2Zq94hRP22K\n6ZENpQE9nEG8CwxuTdZejlKSmb7bkxqdm9K9sQbNGPma75P946mWEHnzd0s23RCF\nzx1r15TeNRlDCIHniKKqAUlKEAIbn1+2TcmjfXQymf8lxowjHiZ7m4mOjlRgJHxn\nts10GeuLFQdJJRYp1sphvMEgjkMOs6w1lvHTTq3eG2cj1J10mlxjiAD52udkSto=\n=cFJi\n-----END PGP SIGNATURE-----\n",
      "payload": "tree df40230a8f028453876018aa084718b3dab69f02\nparent 2216de62392786d4cb0d8fede54b1ff567c35564\nauthor ix5 <ix5@users.noreply.github.com> 1645613036 +0100\ncommitter GitHub <noreply@github.com> 1645613036 +0100\n\nadmin: Use textarea for comment editing (#793)\n\nUse a `<textarea>` element to let the user properly edit\r\ncomments, where `contenteditable` was poorly suited for\r\nmulti-line input."
    }
  },
  "url": "https://api.github.com/repos/posativ/isso/commits/568debf6737d2f3462bdd9baa5ace45031b8ed95",
  "html_url": "https://github.com/posativ/isso/commit/568debf6737d2f3462bdd9baa5ace45031b8ed95",
  "comments_url": "https://api.github.com/repos/posativ/isso/commits/568debf6737d2f3462bdd9baa5ace45031b8ed95/comments",
  "author": {
    "login": "ix5",
    "id": 10212877,
    "node_id": "MDQ6VXNlcjEwMjEyODc3",
    "avatar_url": "https://avatars.githubusercontent.com/u/10212877?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ix5",
    "html_url": "https://github.com/ix5",
    "followers_url": "https://api.github.com/users/ix5/followers",
    "following_url": "https://api.github.com/users/ix5/following{/other_user}",
    "gists_url": "https://api.github.com/users/ix5/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ix5/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ix5/subscriptions",
    "organizations_url": "https://api.github.com/users/ix5/orgs",
    "repos_url": "https://api.github.com/users/ix5/repos",
    "events_url": "https://api.github.com/users/ix5/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ix5/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2216de62392786d4cb0d8fede54b1ff567c35564",
      "url": "https://api.github.com/repos/posativ/isso/commits/2216de62392786d4cb0d8fede54b1ff567c35564",
      "html_url": "https://github.com/posativ/isso/commit/2216de62392786d4cb0d8fede54b1ff567c35564"
    }
  ],
  "stats": {
    "total": 42,
    "additions": 36,
    "deletions": 6
  },
  "files": [
    {
      "sha": "3f694c34fe56741c40a16bdfc8ba65ff549aa299",
      "filename": "isso/css/admin.css",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/posativ/isso/blob/568debf6737d2f3462bdd9baa5ace45031b8ed95/isso/css/admin.css",
      "raw_url": "https://github.com/posativ/isso/raw/568debf6737d2f3462bdd9baa5ace45031b8ed95/isso/css/admin.css",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/css/admin.css?ref=568debf6737d2f3462bdd9baa5ace45031b8ed95",
      "patch": "@@ -135,3 +135,10 @@ a {\n .hidden {\n   display: none;\n }\n+.text-wrapper .text {\n+    margin: 0.5em 0;\n+}\n+.text-wrapper .text textarea {\n+    width: 100%;\n+    margin-top: 1em;\n+}"
    },
    {
      "sha": "5b1e5086c11bb1e2bec41d7fa8b9879ad4c9c0c9",
      "filename": "isso/js/admin.js",
      "status": "modified",
      "additions": 28,
      "deletions": 5,
      "changes": 33,
      "blob_url": "https://github.com/posativ/isso/blob/568debf6737d2f3462bdd9baa5ace45031b8ed95/isso/js/admin.js",
      "raw_url": "https://github.com/posativ/isso/raw/568debf6737d2f3462bdd9baa5ace45031b8ed95/isso/js/admin.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/js/admin.js?ref=568debf6737d2f3462bdd9baa5ace45031b8ed95",
      "patch": "@@ -72,23 +72,44 @@ function set_editable(elt_id) {\n function start_edit(com_id) {\n     var editable_elements = ['isso-author-' + com_id,\n                              'isso-email-' + com_id,\n-                             'isso-website-' + com_id,\n-                             'isso-text-' + com_id];\n+                             'isso-website-' + com_id];\n     for (var idx=0; idx <= editable_elements.length; idx++) {\n         set_editable(editable_elements[idx]);\n     }\n+    // Append a <textarea> to edit comment text inside <pre>\n+    // This preserves original formatting as contentEditable is hard to wrange\n+    var elt = document.getElementById('isso-text-' + com_id);\n+    if (elt) {\n+        elt.dataset['originContent'] = elt.innerHTML;\n+        var textarea = document.createElement(\"textarea\");\n+        textarea.id = 'isso-text-' + com_id + \"-textarea\";\n+        textarea.value = elt.dataset['originContent'];\n+        textarea.classList.add(\"editable\");\n+        // Set row size, but not larger than 40\n+        // TODO: Make textarea grow with input\n+        // Idea: https://css-tricks.com/auto-growing-inputs-textareas/\n+        textarea.rows = Math.min(elt.textContent.split('\\n').length, 40)\n+        elt.innerHTML = \"\"\n+        elt.appendChild(textarea);\n+    }\n     document.getElementById('edit-btn-' + com_id).classList.toggle('hidden');\n     document.getElementById('stop-edit-btn-' + com_id).classList.toggle('hidden');\n     document.getElementById('send-edit-btn-' + com_id).classList.toggle('hidden');\n }\n function stop_edit(com_id, save_changes) {\n     var editable_elements = ['isso-author-' + com_id,\n                              'isso-email-' + com_id,\n-                             'isso-website-' + com_id,\n-                             'isso-text-' + com_id];\n+                             'isso-website-' + com_id];\n     for (var idx=0; idx <= editable_elements.length; idx++) {\n       unset_editable(editable_elements[idx], save_changes);\n     }\n+    var elt = document.getElementById('isso-text-' + com_id);\n+    var textarea = document.getElementById('isso-text-' + com_id + \"-textarea\");\n+    if (elt && textarea) {\n+        elt.innerHTML = save_changes ? textarea.value : elt.dataset['originContent'];\n+        delete elt.dataset['originContent'];\n+        elt.classList.remove(\"editable\");\n+    }\n     document.getElementById('edit-btn-' + com_id).classList.toggle('hidden');\n     document.getElementById('stop-edit-btn-' + com_id).classList.toggle('hidden');\n     document.getElementById('send-edit-btn-' + com_id).classList.toggle('hidden');\n@@ -97,7 +118,9 @@ function send_edit(com_id, hash, isso_host_script) {\n     var author = document.getElementById('isso-author-' + com_id).textContent;\n     var email = document.getElementById('isso-email-' + com_id).textContent;\n     var website = document.getElementById('isso-website-' + com_id).textContent;\n-    var comment = document.getElementById('isso-text-' + com_id).textContent;\n+    // Need to use element.value instead of textContent for <textarea>, else\n+    // only the initial contents will be fetched\n+    var comment = document.getElementById('isso-text-' + com_id + \"-textarea\").value;\n     edit(com_id, hash, author, email, website, comment, isso_host_script);\n     stop_edit(com_id, true);\n }"
    },
    {
      "sha": "3332c5b66290d008b529a2372ac37b912c714c45",
      "filename": "isso/templates/admin.html",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/posativ/isso/blob/568debf6737d2f3462bdd9baa5ace45031b8ed95/isso/templates/admin.html",
      "raw_url": "https://github.com/posativ/isso/raw/568debf6737d2f3462bdd9baa5ace45031b8ed95/isso/templates/admin.html",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/templates/admin.html?ref=568debf6737d2f3462bdd9baa5ace45031b8ed95",
      "patch": "@@ -123,7 +123,7 @@ <h2 class=\"thread-title\">{{comment.title}} (<a href=\"{{comment.uri}}\">{{comment.\n         {% if comment.mode == 4 %}\n           <strong>HIDDEN</strong>. Original text: <br />\n         {% endif %}\n-        <div id=\"isso-text-{{comment.id}}\"><pre>{{comment.text}}</pre></div>\n+        <pre id=\"isso-text-{{comment.id}}\">{{comment.text}}</pre>\n       </div>\n       <div class='isso-comment-footer'>\n         {% if conf.votes and comment.likes - comment.dislikes != 0 %}"
    }
  ]
}
