{
  "sha": "6f429851bf1af2d8f31abac0b4bd843c51e76545",
  "node_id": "C_kwDOAF-mA9oAKDZmNDI5ODUxYmYxYWYyZDhmMzFhYmFjMGI0YmQ4NDNjNTFlNzY1NDU",
  "commit": {
    "author": {
      "name": "ix5",
      "email": "ix5@users.noreply.github.com",
      "date": "2022-05-05T22:20:35Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2022-05-05T22:20:35Z"
    },
    "message": "Merge pull request #857 from ix5/js-template-no-strip-newline\n\njs: template: Do not strip newlines",
    "tree": {
      "sha": "49376bc279e2963acdef831715ec14698b88f224",
      "url": "https://api.github.com/repos/posativ/isso/git/trees/49376bc279e2963acdef831715ec14698b88f224"
    },
    "url": "https://api.github.com/repos/posativ/isso/git/commits/6f429851bf1af2d8f31abac0b4bd843c51e76545",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJidE2zCRBK7hj4Ov3rIwAAaHYIAFSKSwT8/5akclKWDxboEl6Q\n41TPSWqyQmxU9GSTvROnZNP/43la/pECnrwkEhU2KhzkMvCs2AX30sUMgB0puIq2\nBnfOItCpesfk/tVDC7q5cN1NXQGtHPuoi0N0uGrqivITH1PoLMImlDiMEfzanbbo\nXDYG4pjKA6IZSxRnmMrZ1A2bsxMGRGnD9JEhzla8h67I3E/PxPoE/M98Cq/LeIsN\nvRvxk9Rr3zEiwWxmntMRTzlR89x+y+iiWo6RcVmgI9BsxmxjCiOnH4qmBDufg3bA\nJ+O5Kt601f+tcscsrJ8tfjwfxnWwF9baeWKU5bs55ko/prKTs/xJJ7QyKUBaewk=\n=kZIt\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 49376bc279e2963acdef831715ec14698b88f224\nparent 795aed68ea5c39ccb4d96b3a5e1a660d2ea4174b\nparent 4abdc2924dea1f256c3f9fac0b19961e6f74a5da\nauthor ix5 <ix5@users.noreply.github.com> 1651789235 +0200\ncommitter GitHub <noreply@github.com> 1651789235 +0200\n\nMerge pull request #857 from ix5/js-template-no-strip-newline\n\njs: template: Do not strip newlines"
    }
  },
  "url": "https://api.github.com/repos/posativ/isso/commits/6f429851bf1af2d8f31abac0b4bd843c51e76545",
  "html_url": "https://github.com/posativ/isso/commit/6f429851bf1af2d8f31abac0b4bd843c51e76545",
  "comments_url": "https://api.github.com/repos/posativ/isso/commits/6f429851bf1af2d8f31abac0b4bd843c51e76545/comments",
  "author": {
    "login": "ix5",
    "id": 10212877,
    "node_id": "MDQ6VXNlcjEwMjEyODc3",
    "avatar_url": "https://avatars.githubusercontent.com/u/10212877?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ix5",
    "html_url": "https://github.com/ix5",
    "followers_url": "https://api.github.com/users/ix5/followers",
    "following_url": "https://api.github.com/users/ix5/following{/other_user}",
    "gists_url": "https://api.github.com/users/ix5/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ix5/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ix5/subscriptions",
    "organizations_url": "https://api.github.com/users/ix5/orgs",
    "repos_url": "https://api.github.com/users/ix5/repos",
    "events_url": "https://api.github.com/users/ix5/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ix5/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "795aed68ea5c39ccb4d96b3a5e1a660d2ea4174b",
      "url": "https://api.github.com/repos/posativ/isso/commits/795aed68ea5c39ccb4d96b3a5e1a660d2ea4174b",
      "html_url": "https://github.com/posativ/isso/commit/795aed68ea5c39ccb4d96b3a5e1a660d2ea4174b"
    },
    {
      "sha": "4abdc2924dea1f256c3f9fac0b19961e6f74a5da",
      "url": "https://api.github.com/repos/posativ/isso/commits/4abdc2924dea1f256c3f9fac0b19961e6f74a5da",
      "html_url": "https://github.com/posativ/isso/commit/4abdc2924dea1f256c3f9fac0b19961e6f74a5da"
    }
  ],
  "stats": {
    "total": 85,
    "additions": 79,
    "deletions": 6
  },
  "files": [
    {
      "sha": "1f04ca7c5abc5397aa82b15a7817b86a205f0596",
      "filename": "isso/js/app/template.js",
      "status": "modified",
      "additions": 0,
      "deletions": 6,
      "changes": 6,
      "blob_url": "https://github.com/posativ/isso/blob/6f429851bf1af2d8f31abac0b4bd843c51e76545/isso%2Fjs%2Fapp%2Ftemplate.js",
      "raw_url": "https://github.com/posativ/isso/raw/6f429851bf1af2d8f31abac0b4bd843c51e76545/isso%2Fjs%2Fapp%2Ftemplate.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Fapp%2Ftemplate.js?ref=6f429851bf1af2d8f31abac0b4bd843c51e76545",
      "patch": "@@ -63,12 +63,6 @@ var render = function(name, locals) {\n \n     rv = templates[name](globals);\n \n-    // These are all needed, else DOM.htmlify will fail to create the element!\n-    // Strip newlines rendered from template literals\n-    rv = rv.replace(/\\r?\\n|\\r/g, \" \");\n-    // Trim whitespace\n-    rv = rv.trim();\n-\n     for (var i = 0; i < keys.length; i++) {\n         delete globals[keys[i]];\n     }"
    },
    {
      "sha": "ce2ffb4ab628b5f1a556f006070f710156c7e159",
      "filename": "isso/js/tests/unit/__snapshots__/template-comment-newlines.test.js.snap",
      "status": "added",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/posativ/isso/blob/6f429851bf1af2d8f31abac0b4bd843c51e76545/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Ftemplate-comment-newlines.test.js.snap",
      "raw_url": "https://github.com/posativ/isso/raw/6f429851bf1af2d8f31abac0b4bd843c51e76545/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Ftemplate-comment-newlines.test.js.snap",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2F__snapshots__%2Ftemplate-comment-newlines.test.js.snap?ref=6f429851bf1af2d8f31abac0b4bd843c51e76545",
      "patch": "@@ -0,0 +1,12 @@\n+// Jest Snapshot v1, https://goo.gl/fbAQLP\n+\n+exports[`Code blocks in rendered comment should not be clipped 1`] = `\n+\"<p>A comment with</p>\n+<pre><code>code blocks\n+New line: preformatted\n+\n+Double newline\n+</code></pre>\"\n+`;\n+\n+exports[`Simple comment text should render on one line 1`] = `\"<p>A comment</p>\"`;"
    },
    {
      "sha": "3a5943f7891e35b0b42cbb62c6bac17672774516",
      "filename": "isso/js/tests/unit/template-comment-newlines.test.js",
      "status": "added",
      "additions": 67,
      "deletions": 0,
      "changes": 67,
      "blob_url": "https://github.com/posativ/isso/blob/6f429851bf1af2d8f31abac0b4bd843c51e76545/isso%2Fjs%2Ftests%2Funit%2Ftemplate-comment-newlines.test.js",
      "raw_url": "https://github.com/posativ/isso/raw/6f429851bf1af2d8f31abac0b4bd843c51e76545/isso%2Fjs%2Ftests%2Funit%2Ftemplate-comment-newlines.test.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Ftests%2Funit%2Ftemplate-comment-newlines.test.js?ref=6f429851bf1af2d8f31abac0b4bd843c51e76545",
      "patch": "@@ -0,0 +1,67 @@\n+/**\n+ * @jest-environment jsdom\n+ */\n+\n+/* Keep the above exactly as-is!\n+ * https://jestjs.io/docs/configuration#testenvironment-string\n+ * https://jestjs.io/docs/configuration#testenvironmentoptions-object\n+ */\n+\n+\"use strict\";\n+\n+/* Test rendered code blocks inside \"comment\" template\n+ * See https://github.com/posativ/isso/discussions/856\n+ * and https://github.com/posativ/isso/pull/857\n+ */\n+\n+// Set up our document body\n+document.body.innerHTML =\n+  '<div id=isso-thread></div>' +\n+  '<script ' +\n+    'src=\"http://isso.api/js/embed.min.js\" ' +\n+    'data-isso=\"/\" ' +\n+    '></script>';\n+\n+const isso = require(\"app/isso\");\n+const $ = require(\"app/dom\");\n+const config = require(\"app/config\");\n+const template = require(\"app/template\");\n+\n+const i18n = require(\"app/i18n\");\n+const svg = require(\"app/svg\");\n+\n+template.set(\"conf\", config);\n+template.set(\"i18n\", i18n.translate);\n+template.set(\"pluralize\", i18n.pluralize);\n+template.set(\"svg\", svg);\n+\n+test('Simple comment text should render on one line', () => {\n+  let comment = {\n+      \"id\": 1,\n+      \"created\": 1651788192.4473603,\n+      \"mode\": 1,\n+      \"text\": \"<p>A comment</p>\",\n+      \"author\": \"John\",\n+      \"website\": \"http://website.org\",\n+      \"hash\": \"4505c1eeda98\",\n+  }\n+  let rendered = template.render(\"comment\", {\"comment\": comment});\n+  let el = $.htmlify(rendered);\n+  expect($('.isso-text', el).innerHTML).toMatchSnapshot();\n+\n+});\n+\n+test('Code blocks in rendered comment should not be clipped', () => {\n+  let comment = {\n+      \"id\": 2,\n+      \"created\": 1651788192.4473603,\n+      \"mode\": 1,\n+      \"text\": \"<p>A comment with</p>\\n<pre><code>code blocks\\nNew line: preformatted\\n\\nDouble newline\\n</code></pre>\",\n+      \"author\": \"John\",\n+      \"website\": \"http://website.org\",\n+      \"hash\": \"4505c1eeda98\",\n+  }\n+  let rendered = template.render(\"comment\", {\"comment\": comment});\n+  let el = $.htmlify(rendered);\n+  expect($('.isso-text', el).innerHTML).toMatchSnapshot();\n+});"
    }
  ]
}
