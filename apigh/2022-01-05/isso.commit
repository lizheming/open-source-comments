{
  "sha": "bbad14e8e1384d49cd274f573cfe8ea121fef532",
  "node_id": "C_kwDOAF-mA9oAKGJiYWQxNGU4ZTEzODRkNDljZDI3NGY1NzNjZmU4ZWExMjFmZWY1MzI",
  "commit": {
    "author": {
      "name": "Stefan Gehn",
      "email": "stefangehn@users.noreply.github.com",
      "date": "2022-01-04T19:29:06Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2022-01-04T19:29:06Z"
    },
    "message": "Build JavaScript files during python package build (#697)\n\nMake package builds via setuptools automatically trigger building of\r\nmerged & minified JS assets.\r\n\r\nThis fixes installing isso from source when using \"pip install\" as long\r\nas both the python and node requirements are met. It also ensures that\r\nsetup.py commands like \"build\" or \"bdist_wheel\" create archives that\r\ncontain generated JS code.",
    "tree": {
      "sha": "867b5caca763aeb217547d0d2801ffdf5d4a26eb",
      "url": "https://api.github.com/repos/posativ/isso/git/trees/867b5caca763aeb217547d0d2801ffdf5d4a26eb"
    },
    "url": "https://api.github.com/repos/posativ/isso/git/commits/bbad14e8e1384d49cd274f573cfe8ea121fef532",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh1KACCRBK7hj4Ov3rIwAAUycIAIqFFnt8LCKGb9KKKo/SI/EP\nFNcfXyAuclYl0Liv60yzHXbhYq0ZHGk7cofXU3po5Dj6i6LK2npW5fE5ZgWTt4dt\niViUl7mW+ciRVYbSrV2rO5d52c5Y/hVqJqC3y4VcC1hT5MP71/vhzGS7IvKW1BmN\nBDnRX/DR6KLHS5cgFgi8SGP7JnzHmOpW5BOwxazG8yka8wpAkbWdoPegD2h/ubmJ\nqkpBfUOUzJo836Gmf+2RoBG9qph9yI7wXDw62YK6Au8DGTF4eZ9Q+61hwP1k6CXE\nrS34e7bpgv8c+Zz5V33h6C5FAqpMe+WbokSJpOX7liQK0j+fVHD3HQux2duWJCQ=\n=5ovk\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 867b5caca763aeb217547d0d2801ffdf5d4a26eb\nparent e6dbd21819f8fdca9fdace447e9ba01276e8d6a9\nauthor Stefan Gehn <stefangehn@users.noreply.github.com> 1641324546 +0100\ncommitter GitHub <noreply@github.com> 1641324546 +0000\n\nBuild JavaScript files during python package build (#697)\n\nMake package builds via setuptools automatically trigger building of\r\nmerged & minified JS assets.\r\n\r\nThis fixes installing isso from source when using \"pip install\" as long\r\nas both the python and node requirements are met. It also ensures that\r\nsetup.py commands like \"build\" or \"bdist_wheel\" create archives that\r\ncontain generated JS code."
    }
  },
  "url": "https://api.github.com/repos/posativ/isso/commits/bbad14e8e1384d49cd274f573cfe8ea121fef532",
  "html_url": "https://github.com/posativ/isso/commit/bbad14e8e1384d49cd274f573cfe8ea121fef532",
  "comments_url": "https://api.github.com/repos/posativ/isso/commits/bbad14e8e1384d49cd274f573cfe8ea121fef532/comments",
  "author": {
    "login": "stefangehn",
    "id": 6630737,
    "node_id": "MDQ6VXNlcjY2MzA3Mzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6630737?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stefangehn",
    "html_url": "https://github.com/stefangehn",
    "followers_url": "https://api.github.com/users/stefangehn/followers",
    "following_url": "https://api.github.com/users/stefangehn/following{/other_user}",
    "gists_url": "https://api.github.com/users/stefangehn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stefangehn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stefangehn/subscriptions",
    "organizations_url": "https://api.github.com/users/stefangehn/orgs",
    "repos_url": "https://api.github.com/users/stefangehn/repos",
    "events_url": "https://api.github.com/users/stefangehn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stefangehn/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e6dbd21819f8fdca9fdace447e9ba01276e8d6a9",
      "url": "https://api.github.com/repos/posativ/isso/commits/e6dbd21819f8fdca9fdace447e9ba01276e8d6a9",
      "html_url": "https://github.com/posativ/isso/commit/e6dbd21819f8fdca9fdace447e9ba01276e8d6a9"
    }
  ],
  "stats": {
    "total": 19,
    "additions": 18,
    "deletions": 1
  },
  "files": [
    {
      "sha": "18d12a76b4308b0100e2156b685142eca0e63792",
      "filename": "setup.py",
      "status": "modified",
      "additions": 18,
      "deletions": 1,
      "changes": 19,
      "blob_url": "https://github.com/posativ/isso/blob/bbad14e8e1384d49cd274f573cfe8ea121fef532/setup.py",
      "raw_url": "https://github.com/posativ/isso/raw/bbad14e8e1384d49cd274f573cfe8ea121fef532/setup.py",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/setup.py?ref=bbad14e8e1384d49cd274f573cfe8ea121fef532",
      "patch": "@@ -1,11 +1,25 @@\n #!/usr/bin/env python3\n # -*- encoding: utf-8 -*-\n \n+import os\n+import setuptools.command.build_py\n+import subprocess\n+\n from setuptools import setup, find_packages\n \n requires = ['itsdangerous', 'Jinja2', 'misaka>=2.0,<3.0', 'html5lib',\n             'werkzeug>=1.0', 'bleach', 'Flask-Caching>=1.9', 'Flask']\n \n+\n+class NpmBuildCommand(setuptools.command.build_py.build_py):\n+    \"\"\"Prefix Python build with node-based asset build\"\"\"\n+\n+    def run(self):\n+        if 'TOX_ENV' not in os.environ:\n+            subprocess.check_call(['make', 'init', 'js'])\n+        setuptools.command.build_py.build_py.run(self)\n+\n+\n setup(\n     name='isso',\n     version='0.12.5',\n@@ -34,5 +48,8 @@\n     entry_points={\n         'console_scripts':\n             ['isso = isso:main'],\n-    }\n+    },\n+    cmdclass={\n+        'build_py': NpmBuildCommand,\n+    },\n )"
    }
  ]
}
