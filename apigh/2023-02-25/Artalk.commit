{
  "sha": "f3a0ef6de8c837fc077b279bd811837f312f1d12",
  "node_id": "C_kwDOCQOkhNoAKGYzYTBlZjZkZThjODM3ZmMwNzdiMjc5YmQ4MTE4MzdmMzEyZjFkMTI",
  "commit": {
    "author": {
      "name": "qwqcode",
      "email": "qwqcode@gmail.com",
      "date": "2023-02-24T14:29:18Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2023-02-24T14:29:18Z"
    },
    "message": "refactor(ui/dark-mode): separate dark mode logic into its own module (#430)",
    "tree": {
      "sha": "ceffce8f51c2e4f1248da9620b955ca2e06e261e",
      "url": "https://api.github.com/repos/ArtalkJS/Artalk/git/trees/ceffce8f51c2e4f1248da9620b955ca2e06e261e"
    },
    "url": "https://api.github.com/repos/ArtalkJS/Artalk/git/commits/f3a0ef6de8c837fc077b279bd811837f312f1d12",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj+Mm+CRBK7hj4Ov3rIwAAaNsIABhO04vLRoE0pr+2dZu65eF8\nfF8G7AOBdPTPMlx3EmiVKzjYJvm+TyiGskwi3n+G6faxZ+rznjN+uKtzYdo7Jlsg\nPluq2Uqluqz17YJp5bWIjA6a3+jYmqYfU5K+LEnX/NYB+iXr9c14K45Pa2ngEA1d\nFBSVV1Gv5HzVKkfaeWPlsl1BpNRv3Gb34gYzfyLQ3IgALhfxuvfzp7Cdlaqt9kQs\n0JBFItTUkDpQRZnZS9PugvqT0nbqZGL/XAaigGo/GkLBH2+SiFxE6VU4D9UMmZtO\nhvozk/AATiNmAt7yHvbOfFs40/ghIXHBkBfC+2j9fZNNFa6UMbAaZNznwxcSreM=\n=URni\n-----END PGP SIGNATURE-----\n",
      "payload": "tree ceffce8f51c2e4f1248da9620b955ca2e06e261e\nparent e2944f383f4aba8a2a3fc50f5fbc85f3374b29b9\nauthor qwqcode <qwqcode@gmail.com> 1677248958 +0800\ncommitter GitHub <noreply@github.com> 1677248958 +0800\n\nrefactor(ui/dark-mode): separate dark mode logic into its own module (#430)\n\n"
    }
  },
  "url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/f3a0ef6de8c837fc077b279bd811837f312f1d12",
  "html_url": "https://github.com/ArtalkJS/Artalk/commit/f3a0ef6de8c837fc077b279bd811837f312f1d12",
  "comments_url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/f3a0ef6de8c837fc077b279bd811837f312f1d12/comments",
  "author": {
    "login": "qwqcode",
    "id": 22412567,
    "node_id": "MDQ6VXNlcjIyNDEyNTY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/22412567?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qwqcode",
    "html_url": "https://github.com/qwqcode",
    "followers_url": "https://api.github.com/users/qwqcode/followers",
    "following_url": "https://api.github.com/users/qwqcode/following{/other_user}",
    "gists_url": "https://api.github.com/users/qwqcode/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qwqcode/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qwqcode/subscriptions",
    "organizations_url": "https://api.github.com/users/qwqcode/orgs",
    "repos_url": "https://api.github.com/users/qwqcode/repos",
    "events_url": "https://api.github.com/users/qwqcode/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qwqcode/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e2944f383f4aba8a2a3fc50f5fbc85f3374b29b9",
      "url": "https://api.github.com/repos/ArtalkJS/Artalk/commits/e2944f383f4aba8a2a3fc50f5fbc85f3374b29b9",
      "html_url": "https://github.com/ArtalkJS/Artalk/commit/e2944f383f4aba8a2a3fc50f5fbc85f3374b29b9"
    }
  ],
  "stats": {
    "total": 403,
    "additions": 60,
    "deletions": 343
  },
  "files": [
    {
      "sha": "50374114ac0c2c6aafe2444491f9b55a184fec12",
      "filename": "conf/artalk.example.simple.yml",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/f3a0ef6de8c837fc077b279bd811837f312f1d12/conf%2Fartalk.example.simple.yml",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/f3a0ef6de8c837fc077b279bd811837f312f1d12/conf%2Fartalk.example.simple.yml",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/conf%2Fartalk.example.simple.yml?ref=f3a0ef6de8c837fc077b279bd811837f312f1d12",
      "patch": "@@ -130,7 +130,6 @@ frontend:\n   noComment: \"No comments yet.\"\n   sendBtn: \"Send\"\n   editorTravel: true\n-  darkMode: false\n   emoticons: \"https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json\"\n   vote: true\n   voteDown: false"
    },
    {
      "sha": "1a547f334f8517c12908c712a8e79d4bd08b2ff0",
      "filename": "conf/artalk.example.yml",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/f3a0ef6de8c837fc077b279bd811837f312f1d12/conf%2Fartalk.example.yml",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/f3a0ef6de8c837fc077b279bd811837f312f1d12/conf%2Fartalk.example.yml",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/conf%2Fartalk.example.yml?ref=f3a0ef6de8c837fc077b279bd811837f312f1d12",
      "patch": "@@ -260,8 +260,6 @@ frontend:\n   sendBtn: \"Send\"\n   # Movable comment box\n   editorTravel: true\n-  # Dark mode\n-  darkMode: false\n   # Emoticons\n   emoticons: \"https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json\"\n   # Vote button"
    },
    {
      "sha": "e7e5315a4744f1203a1e950ae5f94b2cf299cb75",
      "filename": "conf/artalk.example.zh-CN.yml",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/f3a0ef6de8c837fc077b279bd811837f312f1d12/conf%2Fartalk.example.zh-CN.yml",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/f3a0ef6de8c837fc077b279bd811837f312f1d12/conf%2Fartalk.example.zh-CN.yml",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/conf%2Fartalk.example.zh-CN.yml?ref=f3a0ef6de8c837fc077b279bd811837f312f1d12",
      "patch": "@@ -256,8 +256,6 @@ frontend:\n   sendBtn: \"发送评论\"\n   # 评论框旅行\n   editorTravel: true\n-  # 暗黑模式\n-  darkMode: false\n   # 表情包\n   emoticons: \"https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json\"\n   # 投票按钮"
    },
    {
      "sha": "f7b753f87a9789d081339ae482bd687dfc367d98",
      "filename": "internal/query/testdata/example_site_conf.yml",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/f3a0ef6de8c837fc077b279bd811837f312f1d12/internal%2Fquery%2Ftestdata%2Fexample_site_conf.yml",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/f3a0ef6de8c837fc077b279bd811837f312f1d12/internal%2Fquery%2Ftestdata%2Fexample_site_conf.yml",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/internal%2Fquery%2Ftestdata%2Fexample_site_conf.yml?ref=f3a0ef6de8c837fc077b279bd811837f312f1d12",
      "patch": "@@ -136,7 +136,6 @@ frontend:\n   noComment: \"No comments yet.\"\n   sendBtn: \"Send\"\n   editorTravel: true\n-  darkMode: false\n   emoticons: \"https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json\"\n   vote: true\n   voteDown: false"
    },
    {
      "sha": "ddd0e5e89f47a3bcf29dba4f8c51bc1747a24f2c",
      "filename": "ui/packages/artalk-sidebar/src/assets/artalk.example.yml",
      "status": "removed",
      "additions": 0,
      "deletions": 301,
      "changes": 301,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/e2944f383f4aba8a2a3fc50f5fbc85f3374b29b9/ui%2Fpackages%2Fartalk-sidebar%2Fsrc%2Fassets%2Fartalk.example.yml",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/e2944f383f4aba8a2a3fc50f5fbc85f3374b29b9/ui%2Fpackages%2Fartalk-sidebar%2Fsrc%2Fassets%2Fartalk.example.yml",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/ui%2Fpackages%2Fartalk-sidebar%2Fsrc%2Fassets%2Fartalk.example.yml?ref=e2944f383f4aba8a2a3fc50f5fbc85f3374b29b9",
      "patch": "@@ -1,301 +0,0 @@\n-# 服务器地址\n-host: \"0.0.0.0\"\n-\n-# 服务器端口\n-port: 23366\n-\n-# 加密密钥\n-app_key: \"\"\n-\n-# 调试模式\n-debug: false\n-\n-# 时间区域\n-timezone: \"Asia/Shanghai\"\n-\n-# 默认站点名\n-site_default: \"默认站点\"\n-\n-# 登陆有效时长 (单位：秒)\n-login_timeout: 259200\n-\n-# 数据库\n-db:\n-  # 数据库类型 [\"sqlite\", \"mysql\", \"pgsql\", \"mssql\"]\n-  type: \"sqlite\"\n-  # 数据库文件 (仅 SQLite 数据库需填写)\n-  file: \"./data/artalk.db\"\n-  # 数据库名称\n-  name: \"artalk\"\n-  # 数据库地址\n-  host: \"localhost\"\n-  # 数据库端口\n-  port: 3306\n-  # 数据库账户\n-  user: \"root\"\n-  # 数据库密码\n-  password: \"\"\n-  # 编码格式\n-  charset: \"utf8mb4\"\n-  # 表前缀 (例如：\"atk_\")\n-  table_prefix: \"\"\n-\n-# 日志\n-log:\n-  # 启用日志\n-  enabled: true\n-  # 日志文件路径\n-  filename: \"./data/artalk.log\"\n-\n-# 缓存\n-cache:\n-  # 缓存类型 [\"redis\", \"memcache\", \"builtin\"]\n-  type: \"builtin\"\n-  # 缓存过期时间 (单位：分钟)\n-  expires: 30\n-  # 缓存启动预热 (程序启动时预热缓存)\n-  warm_up: false\n-  # 缓存服务器地址 (例如：\"localhost:6379\")\n-  server: \"\"\n-  # Redis 配置\n-  redis:\n-    # 连接方式 [\"tcp\", \"unix\"]\n-    network: \"tcp\"\n-    # 用户名\n-    username: \"\"\n-    # 密码\n-    password: \"\"\n-    # 数据库编号 (例如使用零号数据库填写 0)\n-    db: 0\n-\n-# 可信域名\n-trusted_domains: [] # 例如：[\"https://artalk.example.com:23366\"]\n-\n-# SSL\n-ssl:\n-  # 启用 SSL\n-  enabled: false\n-  # 证书文件路径\n-  cert_path: \"\"\n-  # 密钥文件路径\n-  key_path: \"\"\n-\n-# 管理员账户\n-admin_users:\n-  # - name: \"admin\"\n-  #   email: \"admin@example.com\"\n-  #   password: \"\" # 支持 bcrypt 或 md5 加密，如：\"(md5)50c21190c6e4e5418c6a90d2b5031119\"\n-  #   badge_name: \"管理员\"\n-  #   badge_color: \"#FF6C00\"\n-\n-# 评论审核\n-moderator:\n-  # 默认待审 (发表新评论需要后台人工审核后才能显示)\n-  pending_default: false\n-  # API 请求错误时拦截 (关闭此项当请求错误时让评论放行)\n-  api_fail_block: false\n-  # Akismet Key\n-  # (Akismet 反垃圾服务，https://akismet.com)\n-  akismet_key: \"\"\n-  # 腾讯云文本内容安全\n-  # (https://cloud.tencent.com/document/product/1124/64508)\n-  tencent:\n-    enabled: false\n-    secret_id: \"\"\n-    secret_key: \"\"\n-    region: \"ap-guangzhou\"\n-  # 阿里云内容安全\n-  # (https://help.aliyun.com/document_detail/28417.html)\n-  aliyun:\n-    enabled: false\n-    access_key_id: \"\"\n-    access_key_secret: \"\"\n-    region: \"cn-shanghai\"\n-  # 关键词过滤 (本地离线词库)\n-  keywords:\n-    enabled: false\n-    # 匹配成功设为待审状态\n-    pending: false\n-    # 词库文件 (支持多个词库文件)\n-    files:\n-      - \"./data/词库_1.txt\"\n-    # 词库文件内容分割符 (例如填写 \"\\n\" 文件中一行一个关键词)\n-    file_sep: \"\\n\"\n-    # 替换字符\n-    replac_to: \"x\"\n-\n-# 验证码\n-captcha:\n-  # 启用验证码\n-  enabled: true\n-  # 总是需要验证码\n-  always: false\n-  # 激活验证码所需操作次数\n-  action_limit: 3\n-  # 重置操作计数器超时 (单位：s, 设为 -1 不重置)\n-  action_reset: 60\n-  # Geetest 极验 (https://www.geetest.com)\n-  geetest:\n-    enabled: false\n-    captcha_id: \"\"\n-    captcha_key: \"\"\n-\n-# 邮件通知\n-email:\n-  # 启用邮件通知\n-  enabled: false\n-  # 发送方式 [\"smtp\", \"ali_dm\", \"sendmail\"]\n-  send_type: \"smtp\"\n-  # 发信人昵称\n-  send_name: \"{{reply_nick}}\"\n-  # 发信人地址\n-  send_addr: \"noreply@example.com\"\n-  # 邮件标题\n-  mail_subject: \"[{{site_name}}] 您收到了来自 @{{reply_nick}} 的回复\"\n-  # 邮件模板文件 (填入文件路径使用自定义模板)\n-  mail_tpl: \"default\"\n-  # SMTP 发送 (启用请将发送方式设为 \"smtp\")\n-  smtp:\n-    # 发件地址\n-    host: \"smtp.qq.com\"\n-    # 发件端口\n-    port: 587\n-    # 用户名\n-    username: \"example@qq.com\"\n-    # 密码\n-    password: \"\"\n-  # 阿里云邮件推送\n-  # (启用请将发送方式设为 \"ali_dm\"；参考：https://help.aliyun.com/document_detail/29444.html)\n-  ali_dm:\n-    access_key_id: \"\"\n-    access_key_secret: \"\"\n-    account_name: \"noreply@example.com\"\n-\n-# 图片上传\n-img_upload:\n-  # 启用图片上传\n-  enabled: true\n-  # 图片存放路径\n-  path: \"./data/artalk-img/\"\n-  # 图片大小限制 (单位：MB)\n-  max_size: 5\n-  # 图片链接基础路径 (默认为 \"/static/images/\")\n-  public_path: null\n-  # Upgit 配置\n-  # (使用 Upgit 将图片上传到 GitHub 或图床：https://github.com/pluveto/upgit)\n-  upgit:\n-    # 启用 Upgit\n-    enabled: false\n-    # 命令行参数\n-    exec: \"./upgit -c <upgit配置文件路径> -t /artalk-img\"\n-    # 上传后删除本地的图片\n-    del_local: true\n-\n-# 多元推送\n-admin_notify:\n-  # 通知模版 (填入文件路径使用自定义模板)\n-  notify_tpl: \"default\"\n-  # 嘈杂模式\n-  noise_mode: false\n-  # 邮件通知管理员\n-  email:\n-    # 开启 (当使用其他推送方式时，可以关闭管理员邮件通知)\n-    enabled: true\n-    # 邮件标题 (发送给管理员的邮件标题)\n-    mail_subject: \"[{{site_name}}] 您的文章「{{page_title}}」有新回复\"\n-  # Telegram\n-  telegram:\n-    enabled: false\n-    api_token: \"\"\n-    receivers:\n-      - 7777777\n-  # Bark\n-  bark:\n-    enabled: false\n-    server: \"http://day.app/xxxxxxx/\"\n-  # 飞书\n-  lark:\n-    enabled: false\n-    webhook_url: \"\"\n-  # WebHook\n-  webhook:\n-    enabled: false\n-    url: \"\"\n-  # 钉钉\n-  ding_talk:\n-    enabled: false\n-    token: \"\"\n-    secret: \"\"\n-  # Slack\n-  slack:\n-    enabled: false\n-    oauth_token: \"\"\n-    receivers:\n-      - \"CHANNEL_ID\"\n-  # LINE\n-  line:\n-    enabled: false\n-    channel_secret: \"\"\n-    channel_access_token: \"\"\n-    receivers:\n-      - \"USER_ID_1\"\n-      - \"GROUP_ID_1\"\n-\n-# 前端配置\n-frontend:\n-  # 评论框占位文字\n-  placeholder: \"键入内容...\"\n-  # 无评论显示文字\n-  noComment: \"「此时无声胜有声」\"\n-  # 发送按钮文字\n-  sendBtn: \"发送评论\"\n-  # 评论框旅行\n-  editorTravel: true\n-  # 暗黑模式\n-  darkMode: false\n-  # 表情包\n-  emoticons: \"https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json\"\n-  # 投票按钮\n-  vote: true\n-  # 反对按钮\n-  voteDown: false\n-  # 用户 UA 徽标\n-  uaBadge: true\n-  # 评论排序功能\n-  listSort: true\n-  # 页面 PV 绑定元素\n-  pvEl: \"#ArtalkPV\"\n-  # 评论数绑定元素\n-  countEl: \"#ArtalkCount\"\n-  # 编辑器实时预览功能\n-  preview: true\n-  # 平铺模式 [\"auto\", true, false]\n-  flatMode: \"auto\"\n-  # 最大嵌套层数\n-  nestMax: 2\n-  # 嵌套评论排序规则 [\"DATE_ASC\", \"DATE_DESC\", \"VOTE_UP_DESC\"]\n-  nestSort: DATE_ASC\n-  # 头像\n-  gravatar:\n-    # Gravatar 镜像地址\n-    mirror: \"https://cravatar.cn/avatar/\"\n-    # 默认头像\n-    default: \"mp\"\n-  # 评论分页\n-  pagination:\n-    # 每页评论数\n-    pageSize: 20\n-    # 加载更多模式 (关闭则使用分页条)\n-    readMore: true\n-    # 滚动加载\n-    autoLoad: true\n-  # 内容限高\n-  heightLimit:\n-    # 评论内容限高 (单位：px)\n-    content: 300\n-    # 子评论区域限高 (单位：px)\n-    children: 400\n-  # 请求超时 (单位：毫秒)\n-  reqTimeout: 15000\n-  # 版本检测\n-  versionCheck: true"
    },
    {
      "sha": "f9e6c96a2d4a941e719d68c6195a2e50dc81d5f6",
      "filename": "ui/packages/artalk/src/context.ts",
      "status": "modified",
      "additions": 2,
      "deletions": 36,
      "changes": 38,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/f3a0ef6de8c837fc077b279bd811837f312f1d12/ui%2Fpackages%2Fartalk%2Fsrc%2Fcontext.ts",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/f3a0ef6de8c837fc077b279bd811837f312f1d12/ui%2Fpackages%2Fartalk%2Fsrc%2Fcontext.ts",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/ui%2Fpackages%2Fartalk%2Fsrc%2Fcontext.ts?ref=f3a0ef6de8c837fc077b279bd811837f312f1d12",
      "patch": "@@ -6,6 +6,7 @@ import type ContextApi from '~/types/context'\n import type { TInjectedServices } from './service'\n import getI18n, { I18n } from './i18n'\n import * as Utils from './lib/utils'\n+import * as DarkMode from './lib/dark-mode'\n import Comment from './comment'\n import * as marked from './lib/marked'\n import { SidebarShowPayload } from './layer/sidebar-layer'\n@@ -39,10 +40,6 @@ class Context implements ContextApi {\n     this.$root.innerHTML = ''\n \n     this.api = new Api(this)\n-\n-    this.on('conf-loaded', () => {\n-      this.refreshDarkModeConf()\n-    })\n   }\n \n   public inject(depName: string, obj: any) {\n@@ -235,38 +232,7 @@ class Context implements ContextApi {\n   }\n \n   public setDarkMode(darkMode: boolean): void {\n-    const darkModeClassName = 'atk-dark-mode'\n-\n-    this.conf.darkMode = darkMode\n-\n-    if (darkMode) this.$root.classList.add(darkModeClassName)\n-    else this.$root.classList.remove(darkModeClassName)\n-\n-    // for Layer\n-    const { $wrap: $layerWrap } = getLayerWrap()\n-    if ($layerWrap) {\n-      if (darkMode) $layerWrap.classList.add(darkModeClassName)\n-      else $layerWrap.classList.remove(darkModeClassName)\n-    }\n-  }\n-\n-  private darkModeMedia = window.matchMedia('(prefers-color-scheme: dark)')\n-  private darkModeAutoFunc?: (evt: MediaQueryListEvent) => void\n-  private refreshDarkModeConf(): void {\n-    if (this.conf.darkMode === 'auto') {\n-      // 自动切换暗黑模式，事件监听\n-      this.setDarkMode(this.darkModeMedia.matches)\n-      if (!this.darkModeAutoFunc) {\n-        this.darkModeAutoFunc = (evt) => { this.setDarkMode(evt.matches) }\n-        this.darkModeMedia.addEventListener('change', this.darkModeAutoFunc)\n-      }\n-    } else {\n-      if (this.darkModeAutoFunc) {\n-        // 解除事件监听绑定\n-        this.darkModeMedia.removeEventListener('change', this.darkModeAutoFunc)\n-      }\n-      this.setDarkMode(this.conf.darkMode || false)\n-    }\n+    DarkMode.setDarkMode(this, darkMode)\n   }\n \n   public updateConf(nConf: Partial<ArtalkConfig>): void {"
    },
    {
      "sha": "08b4901d0517c5af360e5a7912a1eb33babcfabf",
      "filename": "ui/packages/artalk/src/lib/dark-mode.ts",
      "status": "added",
      "additions": 48,
      "deletions": 0,
      "changes": 48,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/f3a0ef6de8c837fc077b279bd811837f312f1d12/ui%2Fpackages%2Fartalk%2Fsrc%2Flib%2Fdark-mode.ts",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/f3a0ef6de8c837fc077b279bd811837f312f1d12/ui%2Fpackages%2Fartalk%2Fsrc%2Flib%2Fdark-mode.ts",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/ui%2Fpackages%2Fartalk%2Fsrc%2Flib%2Fdark-mode.ts?ref=f3a0ef6de8c837fc077b279bd811837f312f1d12",
      "patch": "@@ -0,0 +1,48 @@\n+import type Context from '~/types/context'\n+import { getLayerWrap } from '../layer'\n+\n+const darkModeMedia = window.matchMedia('(prefers-color-scheme: dark)')\n+let darkModeAutoFunc: (evt: MediaQueryListEvent) => void\n+\n+export function syncDarkModeConf(ctx: Context) {\n+  setDarkMode(ctx, ctx.conf.darkMode, false) // ref `conf.darkMode` data, so no need to `alterConf`\n+}\n+\n+export function setDarkMode(ctx: Context, darkMode: boolean|'auto', alterConf = true) {\n+  const apply = (d: boolean) => {\n+    updateClassName(ctx, d)\n+    if (alterConf) alterCtxConf(ctx, d)\n+  }\n+\n+  if (darkMode === 'auto') {\n+    if (!darkModeAutoFunc) { // 自动切换暗黑模式，事件监听\n+      darkModeAutoFunc = (evt) => apply(evt.matches)\n+      darkModeMedia.addEventListener('change', darkModeAutoFunc)\n+    }\n+\n+    apply(darkModeMedia.matches)\n+  } else {\n+    // if the type of darkMode is boolean\n+    if (darkModeAutoFunc) // 解除事件监听绑定\n+      darkModeMedia.removeEventListener('change', darkModeAutoFunc)\n+\n+    apply(darkMode)\n+  }\n+}\n+\n+function alterCtxConf(ctx: Context, darkMode: boolean) {\n+  ctx.conf.darkMode = darkMode\n+}\n+\n+const DarkModeClassName = 'atk-dark-mode'\n+export function updateClassName(ctx: Context, darkMode: boolean) {\n+  if (darkMode) ctx.$root.classList.add(DarkModeClassName)\n+  else ctx.$root.classList.remove(DarkModeClassName)\n+\n+  // for Layer\n+  const { $wrap: $layerWrap } = getLayerWrap()\n+  if ($layerWrap) {\n+    if (darkMode) $layerWrap.classList.add(DarkModeClassName)\n+    else $layerWrap.classList.remove(DarkModeClassName)\n+  }\n+}"
    },
    {
      "sha": "ea934877864b09626eda347e0909b5efdce14610",
      "filename": "ui/packages/artalk/src/service.ts",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/ArtalkJS/Artalk/blob/f3a0ef6de8c837fc077b279bd811837f312f1d12/ui%2Fpackages%2Fartalk%2Fsrc%2Fservice.ts",
      "raw_url": "https://github.com/ArtalkJS/Artalk/raw/f3a0ef6de8c837fc077b279bd811837f312f1d12/ui%2Fpackages%2Fartalk%2Fsrc%2Fservice.ts",
      "contents_url": "https://api.github.com/repos/ArtalkJS/Artalk/contents/ui%2Fpackages%2Fartalk%2Fsrc%2Fservice.ts?ref=f3a0ef6de8c837fc077b279bd811837f312f1d12",
      "patch": "@@ -8,6 +8,7 @@ import SidebarLayer from './layer/sidebar-layer'\n import { initMarked } from './lib/marked'\n import User from './lib/user'\n import ListLite from './list/list-lite'\n+import * as DarkMode from './lib/dark-mode'\n \n /**\n  * Services\n@@ -84,6 +85,15 @@ const services = {\n       ctx.checkAdminShowEl()\n       ctx.listRefreshUI()\n     })\n+  },\n+\n+  // 暗黑模式\n+  darkMode(ctx: Context) {\n+    DarkMode.syncDarkModeConf(ctx)\n+\n+    ctx.on('conf-loaded', () => {\n+      DarkMode.syncDarkModeConf(ctx)\n+    })\n   }\n }\n "
    }
  ]
}
