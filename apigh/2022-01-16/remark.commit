{
  "sha": "a748e26166e25f825477071673f362abaedd8624",
  "node_id": "C_kwDOBtgov9oAKGE3NDhlMjYxNjZlMjVmODI1NDc3MDcxNjczZjM2MmFiYWVkZDg2MjQ",
  "commit": {
    "author": {
      "name": "elmaester",
      "email": "54346168+elmaester@users.noreply.github.com",
      "date": "2022-01-15T18:04:40Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2022-01-15T18:04:40Z"
    },
    "message": "Integrating Remark42 with Gatsby (documentation) (#1222)\n\n* add sample Gatsby/React component with comments md\r\n\r\n* fix typo\r\n\r\n* remove semicolons\r\n\r\n* add link to gatsby doc in nav.json\r\n\r\n* fix typo\r\n\r\n* make comment actually a comment in the return\r\n\r\n* improve comment syntax\r\n\r\nCo-authored-by: Ben <BenRoe@users.noreply.github.com>",
    "tree": {
      "sha": "7cee6bfca862402369cb5722ed3cded10d5fa747",
      "url": "https://api.github.com/repos/umputun/remark42/git/trees/7cee6bfca862402369cb5722ed3cded10d5fa747"
    },
    "url": "https://api.github.com/repos/umputun/remark42/git/commits/a748e26166e25f825477071673f362abaedd8624",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh4wy4CRBK7hj4Ov3rIwAAoi8IAGLA1LsnjHDMRZcyEaDH62Bv\nVI7ucoIsDjhwHxfd8N+whaeiS5sYIsZzd9ZkM9MM9L6Fcd1mB1lxyW+hWGa62ZsL\n5ObiC1ZnXiKXt8WuA3iKvnd756mo0XkWFCIx/+n2WmSbFAIiANYWX8oMqMPUu41r\ndICCvlheplTLErDwJjRZUW5BHT8W8jFA7+HE5QKvPhx8CYOqwfOerW0UK3B9E/kV\npSDSPRcJBaFR88GK+JQfHaTtF3GArHbFbdH/Lh2sL2NDcq+BbGR8j9jVAi9ka9kB\n7YeY8LVNmB6svbUv2+R5dF2fC8vF04q8pnaj5M/EWe+C47ywqhmZ2uF1giF2KMU=\n=ZMIT\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 7cee6bfca862402369cb5722ed3cded10d5fa747\nparent 0521c7024c2f8702b3925a01e49c39b2ae18c4b2\nauthor elmaester <54346168+elmaester@users.noreply.github.com> 1642269880 +0200\ncommitter GitHub <noreply@github.com> 1642269880 -0600\n\nIntegrating Remark42 with Gatsby (documentation) (#1222)\n\n* add sample Gatsby/React component with comments md\r\n\r\n* fix typo\r\n\r\n* remove semicolons\r\n\r\n* add link to gatsby doc in nav.json\r\n\r\n* fix typo\r\n\r\n* make comment actually a comment in the return\r\n\r\n* improve comment syntax\r\n\r\nCo-authored-by: Ben <BenRoe@users.noreply.github.com>"
    }
  },
  "url": "https://api.github.com/repos/umputun/remark42/commits/a748e26166e25f825477071673f362abaedd8624",
  "html_url": "https://github.com/umputun/remark42/commit/a748e26166e25f825477071673f362abaedd8624",
  "comments_url": "https://api.github.com/repos/umputun/remark42/commits/a748e26166e25f825477071673f362abaedd8624/comments",
  "author": {
    "login": "elmaester",
    "id": 54346168,
    "node_id": "MDQ6VXNlcjU0MzQ2MTY4",
    "avatar_url": "https://avatars.githubusercontent.com/u/54346168?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/elmaester",
    "html_url": "https://github.com/elmaester",
    "followers_url": "https://api.github.com/users/elmaester/followers",
    "following_url": "https://api.github.com/users/elmaester/following{/other_user}",
    "gists_url": "https://api.github.com/users/elmaester/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/elmaester/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/elmaester/subscriptions",
    "organizations_url": "https://api.github.com/users/elmaester/orgs",
    "repos_url": "https://api.github.com/users/elmaester/repos",
    "events_url": "https://api.github.com/users/elmaester/events{/privacy}",
    "received_events_url": "https://api.github.com/users/elmaester/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0521c7024c2f8702b3925a01e49c39b2ae18c4b2",
      "url": "https://api.github.com/repos/umputun/remark42/commits/0521c7024c2f8702b3925a01e49c39b2ae18c4b2",
      "html_url": "https://github.com/umputun/remark42/commit/0521c7024c2f8702b3925a01e49c39b2ae18c4b2"
    }
  ],
  "stats": {
    "total": 102,
    "additions": 102,
    "deletions": 0
  },
  "files": [
    {
      "sha": "bf62c6b2f14cf31dfcdbd33f58f9ad90d3e3db4b",
      "filename": "site/src/docs/getting-started/integration-with-gatsby/index.md",
      "status": "added",
      "additions": 98,
      "deletions": 0,
      "changes": 98,
      "blob_url": "https://github.com/umputun/remark42/blob/a748e26166e25f825477071673f362abaedd8624/site/src/docs/getting-started/integration-with-gatsby/index.md",
      "raw_url": "https://github.com/umputun/remark42/raw/a748e26166e25f825477071673f362abaedd8624/site/src/docs/getting-started/integration-with-gatsby/index.md",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/site/src/docs/getting-started/integration-with-gatsby/index.md?ref=a748e26166e25f825477071673f362abaedd8624",
      "patch": "@@ -0,0 +1,98 @@\n+# Using Remark42 in Gatsby projects\n+## Sample Comments.js React component:\n+\n+```js\n+\n+import * as React from \"react\"\n+\n+// This function will insert the usual <script> tag of\n+// Remark42 into the specified DOM location (parentElement)\n+const insertScript = (id, parentElement) => {\n+  const script = window.document.createElement(\"script\")\n+  script.type = \"text/javascript\"\n+  script.async = true\n+  script.id = id\n+  /* For Gatsby it's important to manually provide the URL\n+  and make sure it does not contain a trailing slash (\"/\").\n+  Because otherwise the comments for paths with/without \n+  the trailing slash are stored separately in the BoltDB database.\n+  When following a Gatsby Link a page is loaded without the trailing slash,\n+  but when refreshing the page (F5) it is loaded with the trailing slash.\n+  So essentially every URL can become duplicated in the DB and you may not see\n+  your comments from the inverse URL at your present URL.\n+  Making sure url is provided without the trailing slash\n+  in the remark42 config solves this. */\n+  let url = window.location.origin + window.location.pathname\n+  if(url.endsWith(\"/\")) {\n+    url = url.slice(0, -1)\n+  }\n+  // Now the actual config and script-fetching function:\n+  script.innerHTML = `\n+    var remark_config = {\n+      host: \"https://remark42.example.com\",\n+      site_id: \"example-name\",\n+      url: \"${url}\",\n+      theme: \"dark\",\n+      components: [\"embed\"],\n+    };\n+    !function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement(\"script\"),c=\".js\",d=n.head||n.body;\"noModule\"in r?(r.type=\"module\",c=\".mjs\"):r.async=!0,r.defer=!0,r.src=remark_config.host+\"/web/\"+e[o]+c,d.appendChild(r)}}(remark_config.components||[\"embed\"],document);`\n+  parentElement.appendChild(script)\n+}\n+\n+/* This function removes the previously added script from the DOM.\n+Might be necessary when page transitions happen, to make sure a new instance \n+is created, pointing to the current URL. Although this might actually \n+not be necessary, please do your own testing.*/\n+const removeScript = (id, parentElement) => {\n+  const script = window.document.getElementById(id)\n+  if (script) {\n+    parentElement.removeChild(script)\n+  }\n+}\n+\n+// This function will be provided to useEffect and will insert the script\n+// when the component is mounted and remove it when it unmounts\n+const manageScript = () => {\n+  if (!window) {\n+    return\n+  }\n+  const document = window.document\n+  if (document.getElementById(\"remark42\")) {\n+    insertScript(\"comments-script\", document.body)\n+  }\n+  return () => removeScript(\"comments-script\", document.body)\n+}\n+\n+/* Another function for another useEffect - this is the most crucial part for\n+Gatsby compatibility. It will ensure that each page loads its own appropriate\n+comments, and that comments will be properly loaded */\n+const recreateRemark42Instance = () => {\n+    if (!window) {\n+      return\n+    }\n+    const remark42 = window.REMARK42\n+    if (remark42) {\n+      remark42.destroy()\n+      remark42.createInstance(window.remark_config)\n+    }\n+}\n+\n+// The location prop is {props.location.pathname} from the parent component.\n+// I.e. invoke the component like this in the parent: <Comments location={props.location.pathname} />\n+const Comments = ({ location }) => {\n+  // Insert the two useEffect hooks. Maybe you can combine them into one? Feel free if you want to.\n+  React.useEffect(manageScript, [location])\n+  React.useEffect(recreateRemark42Instance, [location])\n+\n+  return (\n+    <>\n+      <h2>Comments</h2>\n+      { /* This div is the target for actual comments insertion */ }\n+      <div id=\"remark42\"></div>\n+    </>\n+  )\n+}\n+\n+export default Comments\n+\n+```"
    },
    {
      "sha": "09b8ae086b0ad12d56338e37e1f51c9d2bf622d8",
      "filename": "site/src/docs/nav.json",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/umputun/remark42/blob/a748e26166e25f825477071673f362abaedd8624/site/src/docs/nav.json",
      "raw_url": "https://github.com/umputun/remark42/raw/a748e26166e25f825477071673f362abaedd8624/site/src/docs/nav.json",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/site/src/docs/nav.json?ref=a748e26166e25f825477071673f362abaedd8624",
      "patch": "@@ -9,6 +9,10 @@\n \t  {\n \t\t\"title\": \"System Requirements\",\n \t\t\"href\": \"/getting-started/system-requirements/\"\n+\t  },\n+\t  {\n+\t\t\"title\": \"Integration With Gatsby\",\n+\t\t\"href\": \"/getting-started/integration-with-gatsby/\"\n \t  }\n \t]\n   },"
    }
  ]
}
