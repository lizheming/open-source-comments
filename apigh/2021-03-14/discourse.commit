{
  "sha": "5c84f702b0f846139f040066c878e28f4674e787",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo1Yzg0ZjcwMmIwZjg0NjEzOWYwNDAwNjZjODc4ZTI4ZjQ2NzRlNzg3",
  "commit": {
    "author": {
      "name": "Blake Erickson",
      "email": "o.blakeerickson@gmail.com",
      "date": "2021-03-12T23:48:39Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-03-12T23:48:39Z"
    },
    "message": "DEV: Update api docs to deprecate target_usernames field (#12394)\n\nWhen creating a PM target_usernames has been deprecated for some time\r\nnow but the api docs have yet to reflect this.\r\n\r\nThe api docs now specify to use target_recipients.\r\n\r\nSee: eef21625c6b9dd589573bc1771c7075a12e0abc9",
    "tree": {
      "sha": "aaa59d992d4635c749ba04b70f373954ddf83e49",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/aaa59d992d4635c749ba04b70f373954ddf83e49"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/5c84f702b0f846139f040066c878e28f4674e787",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgS/3XCRBK7hj4Ov3rIwAAdHIIADEIxTzT4HlwwS0s1vQdRpmi\nSETt1liTR1ATfJliC0BYRasAp77bLa33LdxEGdUC2iIA4ZH9kYWkIQLBySh3nV9O\nOKbu7p7BV0bdlI1rmO7ccDlobiQhe06BS4qnWbbw02h9gJNFjcTidipIPegX7UdN\nbmFNTwKBrG6XQtPRBqh18wUTr0dHckANN6v3hhPOfBtMaxZ2ALIgcTvnzw9beRbU\njmB0ImU9vQlOygQecR8jf8I8Ld7KO5FUkF0Xjaf9DUe+fII12nD9qsXbD1RD7YYe\nwOWb3f61/7F0Sag1IKJMJP3Y4N0McYCz+ISm0h3pQfR2XpsY0YXEFSzpAHFH2TE=\n=qiaG\n-----END PGP SIGNATURE-----\n",
      "payload": "tree aaa59d992d4635c749ba04b70f373954ddf83e49\nparent 01babeccdfa6190d089a4ca340533f2623a18bc7\nauthor Blake Erickson <o.blakeerickson@gmail.com> 1615592919 -0700\ncommitter GitHub <noreply@github.com> 1615592919 -0700\n\nDEV: Update api docs to deprecate target_usernames field (#12394)\n\nWhen creating a PM target_usernames has been deprecated for some time\r\nnow but the api docs have yet to reflect this.\r\n\r\nThe api docs now specify to use target_recipients.\r\n\r\nSee: eef21625c6b9dd589573bc1771c7075a12e0abc9"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/5c84f702b0f846139f040066c878e28f4674e787",
  "html_url": "https://github.com/discourse/discourse/commit/5c84f702b0f846139f040066c878e28f4674e787",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/5c84f702b0f846139f040066c878e28f4674e787/comments",
  "author": {
    "login": "oblakeerickson",
    "id": 1490496,
    "node_id": "MDQ6VXNlcjE0OTA0OTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1490496?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/oblakeerickson",
    "html_url": "https://github.com/oblakeerickson",
    "followers_url": "https://api.github.com/users/oblakeerickson/followers",
    "following_url": "https://api.github.com/users/oblakeerickson/following{/other_user}",
    "gists_url": "https://api.github.com/users/oblakeerickson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/oblakeerickson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/oblakeerickson/subscriptions",
    "organizations_url": "https://api.github.com/users/oblakeerickson/orgs",
    "repos_url": "https://api.github.com/users/oblakeerickson/repos",
    "events_url": "https://api.github.com/users/oblakeerickson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/oblakeerickson/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "01babeccdfa6190d089a4ca340533f2623a18bc7",
      "url": "https://api.github.com/repos/discourse/discourse/commits/01babeccdfa6190d089a4ca340533f2623a18bc7",
      "html_url": "https://github.com/discourse/discourse/commit/01babeccdfa6190d089a4ca340533f2623a18bc7"
    }
  ],
  "stats": {
    "total": 394,
    "additions": 305,
    "deletions": 89
  },
  "files": [
    {
      "sha": "fd45f7997a3b9a9f07724fb01dfff2a07c558c66",
      "filename": "spec/requests/api/posts_spec.rb",
      "status": "modified",
      "additions": 17,
      "deletions": 89,
      "changes": 106,
      "blob_url": "https://github.com/discourse/discourse/blob/5c84f702b0f846139f040066c878e28f4674e787/spec/requests/api/posts_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/5c84f702b0f846139f040066c878e28f4674e787/spec/requests/api/posts_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/requests/api/posts_spec.rb?ref=5c84f702b0f846139f040066c878e28f4674e787",
      "patch": "@@ -5,6 +5,12 @@\n \n   let(:'Api-Key') { Fabricate(:api_key).key }\n   let(:'Api-Username') { 'system' }\n+  let(:admin) { Fabricate(:admin) }\n+\n+  before do\n+    Jobs.run_immediately!\n+    sign_in(admin)\n+  end\n \n   path '/posts.json' do\n \n@@ -90,100 +96,22 @@\n     end\n \n     post 'Creates a new topic, a new post, or a private message' do\n-      tags 'Posts', 'Topics'\n+      tags 'Posts', 'Topics', 'Private Messages'\n       consumes 'application/json'\n-      parameter name: 'Api-Key', in: :header, type: :string, required: true\n-      parameter name: 'Api-Username', in: :header, type: :string, required: true\n-      # Can't be named :post!\n-      parameter name: :post_body, in: :body, schema: {\n-        type: :object,\n-        properties: {\n-          title: {\n-            type: :string,\n-            description: 'Required if creating a new topic or new private message.'\n-          },\n-          topic_id: {\n-            type: :integer,\n-            description: 'Required if creating a new post.'\n-          },\n-          raw: { type: :string },\n-          category: {\n-            type: :integer,\n-            description: 'Optional if creating a new topic, and ignored if creating a new post.'\n-          },\n-          target_usernames: {\n-            type: :string,\n-            description: 'Required for private message, comma separated.',\n-            example: 'blake,sam'\n-          },\n-          archetype: { type: :string },\n-          created_at: { type: :string },\n-        },\n-        required: [ 'raw' ]\n-      }\n+      expected_request_schema = load_spec_schema('topic_create_request')\n+      parameter name: :params, in: :body, schema: expected_request_schema\n \n       produces 'application/json'\n       response '200', 'post created' do\n-        schema type: :object, properties: {\n-          id: { type: :integer },\n-          name: { type: :string, nullable: true },\n-          username: { type: :string },\n-          avatar_template: { type: :string },\n-          created_at: { type: :string },\n-          cooked: { type: :string },\n-          post_number: { type: :integer },\n-          post_type: { type: :integer },\n-          updated_at: { type: :string },\n-          reply_count: { type: :integer },\n-          reply_to_post_number: { type: :string, nullable: true },\n-          quote_count: { type: :integer },\n-          incoming_link_count: { type: :integer },\n-          reads: { type: :integer },\n-          readers_count: { type: :integer },\n-          score: { type: :integer },\n-          yours: { type: :boolean },\n-          topic_id: { type: :integer },\n-          topic_slug: { type: :string },\n-          display_username: { type: :string, nullable: true },\n-          primary_group_name: { type: :string, nullable: true },\n-          primary_group_flair_url: { type: :string, nullable: true },\n-          primary_group_flair_bg_color: { type: :string, nullable: true },\n-          primary_group_flair_color: { type: :string, nullable: true },\n-          version: { type: :integer },\n-          can_edit: { type: :boolean },\n-          can_delete: { type: :boolean },\n-          can_recover: { type: :boolean },\n-          can_wiki: { type: :boolean },\n-          user_title: { type: :string, nullable: true },\n-          actions_summary: {\n-            type: :array,\n-            items: {\n-              type: :object,\n-              properties: {\n-                id: { type: :integer },\n-                can_act: { type: :boolean },\n-              }\n-            },\n-          },\n-          moderator: { type: :boolean },\n-          admin: { type: :boolean },\n-          staff: { type: :boolean },\n-          user_id: { type: :integer },\n-          draft_sequence: { type: :integer },\n-          hidden: { type: :boolean },\n-          trust_level: { type: :integer },\n-          deleted_at: { type: :string, nullable: true },\n-          user_deleted: { type: :boolean },\n-          edit_reason: { type: :string, nullable: true },\n-          can_view_edit_history: { type: :boolean },\n-          wiki: { type: :boolean },\n-          reviewable_id: { type: :string, nullable: true },\n-          reviewable_score_count: { type: :integer },\n-          reviewable_score_pending_count: { type: :integer },\n-        }\n+        expected_response_schema = load_spec_schema('topic_create_response')\n+        schema expected_response_schema\n \n-        let(:post_body) { Fabricate(:post) }\n-        run_test!\n+        let(:params) { Fabricate(:post) }\n+\n+        it_behaves_like \"a JSON endpoint\", 200 do\n+          let(:expected_response_schema) { expected_response_schema }\n+          let(:expected_request_schema) { expected_request_schema }\n+        end\n       end\n     end\n   end"
    },
    {
      "sha": "c9a822e45833221df29cc11e0d4992b0e912745f",
      "filename": "spec/requests/api/schemas/json/topic_create_request.json",
      "status": "added",
      "additions": 42,
      "deletions": 0,
      "changes": 42,
      "blob_url": "https://github.com/discourse/discourse/blob/5c84f702b0f846139f040066c878e28f4674e787/spec/requests/api/schemas/json/topic_create_request.json",
      "raw_url": "https://github.com/discourse/discourse/raw/5c84f702b0f846139f040066c878e28f4674e787/spec/requests/api/schemas/json/topic_create_request.json",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/requests/api/schemas/json/topic_create_request.json?ref=5c84f702b0f846139f040066c878e28f4674e787",
      "patch": "@@ -0,0 +1,42 @@\n+{\n+  \"additionalProperties\": false,\n+  \"properties\": {\n+    \"title\": {\n+      \"type\": \"string\",\n+      \"description\": \"Required if creating a new topic or new private message.\"\n+    },\n+    \"raw\": {\n+      \"type\": \"string\"\n+    },\n+    \"topic_id\": {\n+      \"type\": \"integer\",\n+      \"description\": \"Required if creating a new post.\"\n+    },\n+    \"category\": {\n+      \"type\": \"integer\",\n+      \"description\": \"Optional if creating a new topic, and ignored if creating a new post.\"\n+    },\n+    \"target_recipients\": {\n+      \"type\": \"string\",\n+      \"description\": \"Required for private message, comma separated.\",\n+      \"example\": \"blake,sam\"\n+    },\n+    \"target_usernames\": {\n+      \"type\": \"string\",\n+      \"description\": \"Deprecated. Use target_recipients instead.\",\n+      \"deprecated\": true\n+    },\n+    \"archetype\": {\n+      \"type\": \"string\",\n+      \"description\": \"Required for new private message.\",\n+      \"example\": \"private_message\"\n+    },\n+    \"created_at\": {\n+      \"type\": \"string\"\n+    }\n+  },\n+  \"required\": [\n+    \"raw\"\n+  ]\n+}\n+"
    },
    {
      "sha": "d80c4c2901375bb575d1412d9699d56d802dd0d0",
      "filename": "spec/requests/api/schemas/json/topic_create_response.json",
      "status": "added",
      "additions": 246,
      "deletions": 0,
      "changes": 246,
      "blob_url": "https://github.com/discourse/discourse/blob/5c84f702b0f846139f040066c878e28f4674e787/spec/requests/api/schemas/json/topic_create_response.json",
      "raw_url": "https://github.com/discourse/discourse/raw/5c84f702b0f846139f040066c878e28f4674e787/spec/requests/api/schemas/json/topic_create_response.json",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/requests/api/schemas/json/topic_create_response.json?ref=5c84f702b0f846139f040066c878e28f4674e787",
      "patch": "@@ -0,0 +1,246 @@\n+{\n+  \"additionalProperties\": false,\n+  \"properties\": {\n+    \"id\": {\n+      \"type\": \"integer\"\n+    },\n+    \"name\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"username\": {\n+      \"type\": \"string\"\n+    },\n+    \"avatar_template\": {\n+      \"type\": \"string\"\n+    },\n+    \"created_at\": {\n+      \"type\": \"string\"\n+    },\n+    \"cooked\": {\n+      \"type\": \"string\"\n+    },\n+    \"post_number\": {\n+      \"type\": \"integer\"\n+    },\n+    \"post_type\": {\n+      \"type\": \"integer\"\n+    },\n+    \"updated_at\": {\n+      \"type\": \"string\"\n+    },\n+    \"reply_count\": {\n+      \"type\": \"integer\"\n+    },\n+    \"reply_to_post_number\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"quote_count\": {\n+      \"type\": \"integer\"\n+    },\n+    \"incoming_link_count\": {\n+      \"type\": \"integer\"\n+    },\n+    \"reads\": {\n+      \"type\": \"integer\"\n+    },\n+    \"readers_count\": {\n+      \"type\": \"integer\"\n+    },\n+    \"score\": {\n+      \"type\": \"integer\"\n+    },\n+    \"yours\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"topic_id\": {\n+      \"type\": \"integer\"\n+    },\n+    \"topic_slug\": {\n+      \"type\": \"string\"\n+    },\n+    \"display_username\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"primary_group_name\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"primary_group_flair_url\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"primary_group_flair_bg_color\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"primary_group_flair_color\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"version\": {\n+      \"type\": \"integer\"\n+    },\n+    \"can_edit\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"can_delete\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"can_recover\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"can_wiki\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"user_title\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"bookmarked\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"actions_summary\": {\n+      \"type\": \"array\",\n+      \"items\": [\n+        {\n+          \"type\": \"object\",\n+          \"additionalProperties\": false,\n+          \"properties\": {\n+            \"id\": {\n+              \"type\": \"integer\"\n+            },\n+            \"can_act\": {\n+              \"type\": \"boolean\"\n+            }\n+          },\n+          \"required\": [\n+            \"id\",\n+            \"can_act\"\n+          ]\n+        }\n+      ]\n+    },\n+    \"moderator\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"admin\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"staff\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"user_id\": {\n+      \"type\": \"integer\"\n+    },\n+    \"draft_sequence\": {\n+      \"type\": \"integer\"\n+    },\n+    \"hidden\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"trust_level\": {\n+      \"type\": \"integer\"\n+    },\n+    \"deleted_at\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"user_deleted\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"edit_reason\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"can_view_edit_history\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"wiki\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"reviewable_id\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"reviewable_score_count\": {\n+      \"type\": \"integer\"\n+    },\n+    \"reviewable_score_pending_count\": {\n+      \"type\": \"integer\"\n+    }\n+  },\n+  \"required\": [\n+    \"id\",\n+    \"name\",\n+    \"username\",\n+    \"avatar_template\",\n+    \"created_at\",\n+    \"cooked\",\n+    \"post_number\",\n+    \"post_type\",\n+    \"updated_at\",\n+    \"reply_count\",\n+    \"reply_to_post_number\",\n+    \"quote_count\",\n+    \"incoming_link_count\",\n+    \"reads\",\n+    \"readers_count\",\n+    \"score\",\n+    \"yours\",\n+    \"topic_id\",\n+    \"topic_slug\",\n+    \"display_username\",\n+    \"primary_group_name\",\n+    \"primary_group_flair_url\",\n+    \"primary_group_flair_bg_color\",\n+    \"primary_group_flair_color\",\n+    \"version\",\n+    \"can_edit\",\n+    \"can_delete\",\n+    \"can_recover\",\n+    \"can_wiki\",\n+    \"user_title\",\n+    \"bookmarked\",\n+    \"actions_summary\",\n+    \"moderator\",\n+    \"admin\",\n+    \"staff\",\n+    \"user_id\",\n+    \"draft_sequence\",\n+    \"hidden\",\n+    \"trust_level\",\n+    \"deleted_at\",\n+    \"user_deleted\",\n+    \"edit_reason\",\n+    \"can_view_edit_history\",\n+    \"wiki\",\n+    \"reviewable_id\",\n+    \"reviewable_score_count\",\n+    \"reviewable_score_pending_count\"\n+  ]\n+}"
    }
  ]
}
