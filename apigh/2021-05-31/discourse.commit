{
  "sha": "ccbe3bea79da2d87647d977d0ec55e2a3235d0d9",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpjY2JlM2JlYTc5ZGEyZDg3NjQ3ZDk3N2QwZWM1NWUyYTMyMzVkMGQ5",
  "commit": {
    "author": {
      "name": "Dan Ungureanu",
      "email": "dan@ungureanu.me",
      "date": "2021-05-31T11:03:19Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-05-31T11:03:19Z"
    },
    "message": "UX: Improve style of GitHub PR body in emails (#13198)\n\nOn the web, we display only an excerpt in a monospace font and the rest\r\nof the body is hidden under ellipsis. The email displayed both of them\r\nand it did not use the same style. This commit leaves only the excerpt\r\nin emails and makes it use a monospace font to display it.",
    "tree": {
      "sha": "6287e873d93cf174fa260408c3a75a3457f4a362",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/6287e873d93cf174fa260408c3a75a3457f4a362"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/ccbe3bea79da2d87647d977d0ec55e2a3235d0d9",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgtMJ3CRBK7hj4Ov3rIwAA4PMIAEyyHDXUiCNp0tJCDPPJQ+7D\nKumW8Gpre4xTyKAuHIx8DGWtErlxspMQeHu+GT2fXJOV2z1w0FMtgYt9mlqlPCoQ\nkxeK7gN/qeyU9OgNyk8f1nA34IrRt4Eyh7a/CokbqDo5zv3TB6kMy07AimmgwJVw\nt0/RUU+h4DuvzkIxHXFXHulxQjixzcbO3E9AMxDx5D9h0LgsDLAWFcb5F+iMNc3b\nTRb++WY+Zhcn0eu8WOc8uoT5frmcvz0TcJB83DkEqopF+a5+W57V+qzi8zaHjEhe\n1929crcTbkp7/GPhftTkxkLOTVFtO59iYaZjwFLDfYDE3Ho4E0CePNKmvC5+tTk=\n=aDGr\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 6287e873d93cf174fa260408c3a75a3457f4a362\nparent 00300b118d54605e6bb3f1ffcb685b1944100bb2\nauthor Dan Ungureanu <dan@ungureanu.me> 1622458999 +0300\ncommitter GitHub <noreply@github.com> 1622458999 +0300\n\nUX: Improve style of GitHub PR body in emails (#13198)\n\nOn the web, we display only an excerpt in a monospace font and the rest\r\nof the body is hidden under ellipsis. The email displayed both of them\r\nand it did not use the same style. This commit leaves only the excerpt\r\nin emails and makes it use a monospace font to display it."
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/ccbe3bea79da2d87647d977d0ec55e2a3235d0d9",
  "html_url": "https://github.com/discourse/discourse/commit/ccbe3bea79da2d87647d977d0ec55e2a3235d0d9",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/ccbe3bea79da2d87647d977d0ec55e2a3235d0d9/comments",
  "author": {
    "login": "udan11",
    "id": 4147664,
    "node_id": "MDQ6VXNlcjQxNDc2NjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4147664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/udan11",
    "html_url": "https://github.com/udan11",
    "followers_url": "https://api.github.com/users/udan11/followers",
    "following_url": "https://api.github.com/users/udan11/following{/other_user}",
    "gists_url": "https://api.github.com/users/udan11/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/udan11/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/udan11/subscriptions",
    "organizations_url": "https://api.github.com/users/udan11/orgs",
    "repos_url": "https://api.github.com/users/udan11/repos",
    "events_url": "https://api.github.com/users/udan11/events{/privacy}",
    "received_events_url": "https://api.github.com/users/udan11/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "00300b118d54605e6bb3f1ffcb685b1944100bb2",
      "url": "https://api.github.com/repos/discourse/discourse/commits/00300b118d54605e6bb3f1ffcb685b1944100bb2",
      "html_url": "https://github.com/discourse/discourse/commit/00300b118d54605e6bb3f1ffcb685b1944100bb2"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 12,
    "deletions": 0
  },
  "files": [
    {
      "sha": "73c6e08329cce4c47c54dbc9297cbf3684750f9f",
      "filename": "lib/email/styles.rb",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/discourse/discourse/blob/ccbe3bea79da2d87647d977d0ec55e2a3235d0d9/lib/email/styles.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/ccbe3bea79da2d87647d977d0ec55e2a3235d0d9/lib/email/styles.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/lib/email/styles.rb?ref=ccbe3bea79da2d87647d977d0ec55e2a3235d0d9",
      "patch": "@@ -139,8 +139,11 @@ def onebox_styles\n       style('.github-info div', \"display: inline; margin-right: 10px;\")\n       style('.github-icon-container', 'float: left;')\n       style('.github-icon-container *', 'fill: #646464; width: 40px; height: 40px;')\n+      style('.github-body-container', 'font-family: Consolas, Menlo, Monaco, \"Lucida Console\", \"Liberation Mono\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Courier New\", monospace; margin-top: 1em !important;')\n       style('.onebox-avatar-inline', ONEBOX_INLINE_AVATAR_STYLE)\n \n+      @fragment.css('.github-body-container .excerpt').remove\n+\n       @fragment.css('aside.quote blockquote > p').each do |p|\n         p['style'] = 'padding: 0;'\n       end"
    },
    {
      "sha": "55fe5187ef8dc02e835ab4763e588f9759e12c6e",
      "filename": "spec/components/email/styles_spec.rb",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/discourse/discourse/blob/ccbe3bea79da2d87647d977d0ec55e2a3235d0d9/spec/components/email/styles_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/ccbe3bea79da2d87647d977d0ec55e2a3235d0d9/spec/components/email/styles_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/components/email/styles_spec.rb?ref=ccbe3bea79da2d87647d977d0ec55e2a3235d0d9",
      "patch": "@@ -185,6 +185,15 @@ def html_fragment(html)\n       fragment = html_fragment('<aside class=\"quote\"> <div class=\"title\"> <div class=\"quote-controls\"> <i class=\"fa fa-chevron-down\" title=\"expand/collapse\"></i><a href=\"/t/xyz/123\" title=\"go to the quoted post\" class=\"back\"></a> </div> <img alt=\"\" width=\"20\" height=\"20\" src=\"https://cdn-enterprise.discourse.org/boingboing/user_avatar/bbs.boingboing.net/techapj/40/54379_1.png\" class=\"avatar\">techAPJ: </div> <blockquote> <p>lorem ipsum</p> </blockquote> </aside>')\n       expect(fragment.to_s.squish).to match(/^<blockquote.+<\\/blockquote>$/)\n     end\n+\n+    it \"removes GitHub excerpts\" do\n+      stub_request(:head, \"https://github.com/discourse/discourse/pull/1253\").to_return(status: 200, body: \"\", headers: {})\n+      stub_request(:get, \"https://api.github.com/repos/discourse/discourse/pulls/1253\").to_return(status: 200, body: onebox_response(\"githubpullrequest\"))\n+\n+      onebox = Oneboxer.onebox(\"https://github.com/discourse/discourse/pull/1253\")\n+      fragment = html_fragment(onebox)\n+      expect(fragment.css(\".github-body-container .excerpt\")).to be_empty\n+    end\n   end\n \n   context \"replace_secure_media_urls\" do"
    }
  ]
}
