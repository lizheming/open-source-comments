{
  "sha": "bb74ccf2888d99c98ad406998eeb15070863ded7",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpiYjc0Y2NmMjg4OGQ5OWM5OGFkNDA2OTk4ZWViMTUwNzA4NjNkZWQ3",
  "commit": {
    "author": {
      "name": "Martin Brennan",
      "email": "mjrbrennan@gmail.com",
      "date": "2020-08-18T02:15:00Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-08-18T02:15:00Z"
    },
    "message": "FIX: Add bookmark-list component (#10451)\n\nMoving the bookmark list into its own component to solve click binding issues for external links, because controllers are not the place for DOM manipulation!",
    "tree": {
      "sha": "0d2c7e76617a407d90e7b987c7d7a2216083f42b",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/0d2c7e76617a407d90e7b987c7d7a2216083f42b"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/bb74ccf2888d99c98ad406998eeb15070863ded7",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfOzmkCRBK7hj4Ov3rIwAAdHIIAKOb3yXGA1ETu2Ng9FGOyO4/\nxIvIdEm7ojGdHetjF6sck1P92iyhh6PHz6tQOy7Tw3o5nSQzelQgVjAWm7xuQMFU\nV/bt0zfRJ4mvgN8PR9BW01XO0JDeg2UcJmBQdi883oMWhvU+t12xkZ1bOXldlZl9\n2+bZMOGU7UrL2X4hjqC0KLWtPdQhC0CKuWu89VCp938OhaXbVeZdcS9Yev8Gcidw\nA04kQ6MeM/Qa8IXckMAKHcUhhnVCJjphsxXXR+NPFsE+5Xqs7loPfxC+n21SkF3d\n6CFfVg+nfh9Ak0ehNPSvERpWeFf2CL1IDPPZFt+QjHYtdVfJKvvAUoY4kKqeeR0=\n=IRU4\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 0d2c7e76617a407d90e7b987c7d7a2216083f42b\nparent ba9fbb3443d6f258b928676cb8fd794bcf86284b\nauthor Martin Brennan <mjrbrennan@gmail.com> 1597716900 +1000\ncommitter GitHub <noreply@github.com> 1597716900 +1000\n\nFIX: Add bookmark-list component (#10451)\n\nMoving the bookmark list into its own component to solve click binding issues for external links, because controllers are not the place for DOM manipulation!"
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/bb74ccf2888d99c98ad406998eeb15070863ded7",
  "html_url": "https://github.com/discourse/discourse/commit/bb74ccf2888d99c98ad406998eeb15070863ded7",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/bb74ccf2888d99c98ad406998eeb15070863ded7/comments",
  "author": {
    "login": "martin-brennan",
    "id": 920448,
    "node_id": "MDQ6VXNlcjkyMDQ0OA==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/920448?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/martin-brennan",
    "html_url": "https://github.com/martin-brennan",
    "followers_url": "https://api.github.com/users/martin-brennan/followers",
    "following_url": "https://api.github.com/users/martin-brennan/following{/other_user}",
    "gists_url": "https://api.github.com/users/martin-brennan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/martin-brennan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/martin-brennan/subscriptions",
    "organizations_url": "https://api.github.com/users/martin-brennan/orgs",
    "repos_url": "https://api.github.com/users/martin-brennan/repos",
    "events_url": "https://api.github.com/users/martin-brennan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/martin-brennan/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ba9fbb3443d6f258b928676cb8fd794bcf86284b",
      "url": "https://api.github.com/repos/discourse/discourse/commits/ba9fbb3443d6f258b928676cb8fd794bcf86284b",
      "html_url": "https://github.com/discourse/discourse/commit/ba9fbb3443d6f258b928676cb8fd794bcf86284b"
    }
  ],
  "stats": {
    "total": 295,
    "additions": 148,
    "deletions": 147
  },
  "files": [
    {
      "sha": "1a5917a7d97628bb14caac7ba1422132b190b6ea",
      "filename": "app/assets/javascripts/discourse/app/components/bookmark-list.js",
      "status": "added",
      "additions": 60,
      "deletions": 0,
      "changes": 60,
      "blob_url": "https://github.com/discourse/discourse/blob/bb74ccf2888d99c98ad406998eeb15070863ded7/app/assets/javascripts/discourse/app/components/bookmark-list.js",
      "raw_url": "https://github.com/discourse/discourse/raw/bb74ccf2888d99c98ad406998eeb15070863ded7/app/assets/javascripts/discourse/app/components/bookmark-list.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/components/bookmark-list.js?ref=bb74ccf2888d99c98ad406998eeb15070863ded7",
      "patch": "@@ -0,0 +1,60 @@\n+import Component from \"@ember/component\";\n+import I18n from \"I18n\";\n+import { action } from \"@ember/object\";\n+import showModal from \"discourse/lib/show-modal\";\n+import {\n+  shouldOpenInNewTab,\n+  openLinkInNewTab\n+} from \"discourse/lib/click-track\";\n+\n+export default Component.extend({\n+  classNames: [\"bookmark-list-wrapper\"],\n+\n+  @action\n+  removeBookmark(bookmark) {\n+    const deleteBookmark = () => {\n+      return bookmark\n+        .destroy()\n+        .then(() => this._removeBookmarkFromList(bookmark));\n+    };\n+    if (!bookmark.reminder_at) {\n+      return deleteBookmark();\n+    }\n+    bootbox.confirm(I18n.t(\"bookmarks.confirm_delete\"), result => {\n+      if (result) {\n+        return deleteBookmark();\n+      }\n+    });\n+  },\n+\n+  @action\n+  screenExcerptForExternalLink(event) {\n+    if (event.target && event.target.tagName === \"A\") {\n+      let link = event.target;\n+      if (shouldOpenInNewTab(link.href)) {\n+        openLinkInNewTab(link);\n+      }\n+    }\n+  },\n+\n+  @action\n+  editBookmark(bookmark) {\n+    let controller = showModal(\"bookmark\", {\n+      model: {\n+        postId: bookmark.post_id,\n+        id: bookmark.id,\n+        reminderAt: bookmark.reminder_at,\n+        name: bookmark.name\n+      },\n+      title: \"post.bookmarks.edit\",\n+      modalClass: \"bookmark-with-reminder\"\n+    });\n+    controller.setProperties({\n+      afterSave: () => this.reload()\n+    });\n+  },\n+\n+  _removeBookmarkFromList(bookmark) {\n+    this.content.removeObject(bookmark);\n+  }\n+});"
    },
    {
      "sha": "c566b6289060752096d45b0dfa47506cde40c124",
      "filename": "app/assets/javascripts/discourse/app/controllers/user-activity-bookmarks.js",
      "status": "modified",
      "additions": 2,
      "deletions": 66,
      "changes": 68,
      "blob_url": "https://github.com/discourse/discourse/blob/bb74ccf2888d99c98ad406998eeb15070863ded7/app/assets/javascripts/discourse/app/controllers/user-activity-bookmarks.js",
      "raw_url": "https://github.com/discourse/discourse/raw/bb74ccf2888d99c98ad406998eeb15070863ded7/app/assets/javascripts/discourse/app/controllers/user-activity-bookmarks.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/controllers/user-activity-bookmarks.js?ref=bb74ccf2888d99c98ad406998eeb15070863ded7",
      "patch": "@@ -1,16 +1,10 @@\n import I18n from \"I18n\";\n-import { schedule } from \"@ember/runloop\";\n import Controller from \"@ember/controller\";\n-import showModal from \"discourse/lib/show-modal\";\n import { Promise } from \"rsvp\";\n import { inject } from \"@ember/controller\";\n import { action } from \"@ember/object\";\n import discourseComputed from \"discourse-common/utils/decorators\";\n import Bookmark from \"discourse/models/bookmark\";\n-import {\n-  shouldOpenInNewTab,\n-  openLinkInNewTab\n-} from \"discourse/lib/click-track\";\n \n export default Controller.extend({\n   application: inject(),\n@@ -24,11 +18,6 @@ export default Controller.extend({\n \n   queryParams: [\"q\"],\n \n-  init() {\n-    this._super(...arguments);\n-    this._boundClick = false;\n-  },\n-\n   loadItems() {\n     this.setProperties({\n       content: [],\n@@ -40,26 +29,6 @@ export default Controller.extend({\n       this.set(\"searchTerm\", this.q);\n     }\n \n-    if (!this._boundClick) {\n-      schedule(\"afterRender\", () => {\n-        // TODO(martin): This should be pulled out into a bookmark-list component,\n-        // the controller is not the best place for this.\n-        let wrapper = document.querySelector(\".bookmark-list-wrapper\");\n-        if (!wrapper) {\n-          return;\n-        }\n-        wrapper.addEventListener(\"click\", function(e) {\n-          if (e.target && e.target.tagName === \"A\") {\n-            let link = e.target;\n-            if (shouldOpenInNewTab(link.href)) {\n-              openLinkInNewTab(link);\n-            }\n-          }\n-        });\n-        this._boundClick = true;\n-      });\n-    }\n-\n     return this.model\n       .loadItems({ q: this.searchTerm })\n       .then(response => this._processLoadResponse(response))\n@@ -77,48 +46,15 @@ export default Controller.extend({\n     return loaded && contentLength === 0 && noResultsHelp;\n   },\n \n-  _removeBookmarkFromList(bookmark) {\n-    this.content.removeObject(bookmark);\n-  },\n-\n   @action\n   search() {\n     this.set(\"q\", this.searchTerm);\n     this.loadItems();\n   },\n \n   @action\n-  removeBookmark(bookmark) {\n-    const deleteBookmark = () => {\n-      return bookmark\n-        .destroy()\n-        .then(() => this._removeBookmarkFromList(bookmark));\n-    };\n-    if (!bookmark.reminder_at) {\n-      return deleteBookmark();\n-    }\n-    bootbox.confirm(I18n.t(\"bookmarks.confirm_delete\"), result => {\n-      if (result) {\n-        return deleteBookmark();\n-      }\n-    });\n-  },\n-\n-  @action\n-  editBookmark(bookmark) {\n-    let controller = showModal(\"bookmark\", {\n-      model: {\n-        postId: bookmark.post_id,\n-        id: bookmark.id,\n-        reminderAt: bookmark.reminder_at,\n-        name: bookmark.name\n-      },\n-      title: \"post.bookmarks.edit\",\n-      modalClass: \"bookmark-with-reminder\"\n-    });\n-    controller.setProperties({\n-      afterSave: () => this.loadItems()\n-    });\n+  reload() {\n+    this.loadItems();\n   },\n \n   @action"
    },
    {
      "sha": "6d49d71a4d748d9e3a740fb7abfc4e3cd1dca2c5",
      "filename": "app/assets/javascripts/discourse/app/templates/components/bookmark-list.hbs",
      "status": "added",
      "additions": 80,
      "deletions": 0,
      "changes": 80,
      "blob_url": "https://github.com/discourse/discourse/blob/bb74ccf2888d99c98ad406998eeb15070863ded7/app/assets/javascripts/discourse/app/templates/components/bookmark-list.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/bb74ccf2888d99c98ad406998eeb15070863ded7/app/assets/javascripts/discourse/app/templates/components/bookmark-list.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/components/bookmark-list.hbs?ref=bb74ccf2888d99c98ad406998eeb15070863ded7",
      "patch": "@@ -0,0 +1,80 @@\n+{{#conditional-loading-spinner condition=loading}}\n+  {{#load-more selector=\".bookmark-list .bookmark-list-item\" action=loadMore}}\n+    <table class=\"topic-list bookmark-list\">\n+      <thead>\n+        {{#if site.mobileView}}\n+          <th>&nbsp;</th>\n+          <th>{{i18n \"topic.title\"}}</th>\n+          <th>&nbsp;</th>\n+        {{else}}\n+          <th>{{i18n \"topic.title\"}}</th>\n+          <th>&nbsp;</th>\n+          <th class=\"post-metadata\">{{i18n \"post.bookmarks.updated\"}}</th>\n+          <th class=\"post-metadata\">{{i18n \"activity\"}}</th>\n+          <th>&nbsp;</th>\n+        {{/if}}\n+      </thead>\n+      <tbody>\n+        {{#each content as |bookmark|}}\n+          <tr class=\"topic-list-item bookmark-list-item\">\n+            {{#if site.mobileView}}\n+              <td>\n+                {{#if bookmark.post_user_avatar_template}}\n+                  <a href={{bookmark.postUser.path}} data-user-card={{bookmark.post_user_username}}>\n+                    {{avatar bookmark.postUser avatarTemplatePath=\"avatar_template\" usernamePath=\"username\" namePath=\"name\" imageSize=\"small\"}}\n+                  </a>\n+                {{/if}}\n+              </td>\n+            {{/if}}\n+            <td class=\"main-link\">\n+              <span class=\"link-top-line\">\n+                <div class=\"bookmark-metadata\">\n+                  {{#if bookmark.name}}\n+                    <span class=\"bookmark-metadata-item\">\n+                      {{d-icon \"info-circle\"}}{{bookmark.name}}\n+                    </span>\n+                  {{/if}}\n+                  {{#if bookmark.reminder_at}}\n+                    <span class=\"bookmark-metadata-item\">\n+                      {{d-icon \"far-clock\"}}{{bookmark.formattedReminder}}\n+                    </span>\n+                  {{/if}}\n+                </div>\n+\n+                {{topic-status topic=bookmark}}\n+                {{topic-link bookmark}}\n+              </span>\n+              {{#if bookmark.excerpt}}\n+                {{!-- template-lint-disable  --}}\n+                <p class=\"post-excerpt\" {{on \"click\" this.screenExcerptForExternalLink}}>{{html-safe bookmark.excerpt}}</p>\n+              {{/if}}\n+              <div class=\"link-bottom-line\">\n+                {{category-link bookmark.category}}\n+                {{discourse-tags bookmark mode=\"list\" tagsForUser=tagsForUser}}\n+              </div>\n+            </td>\n+            {{#unless site.mobileView}}\n+              <td>\n+                {{#if bookmark.post_user_avatar_template}}\n+                  <a href={{bookmark.postUser.path}} data-user-card={{bookmark.post_user_username}}>\n+                    {{avatar bookmark.postUser avatarTemplatePath=\"avatar_template\" usernamePath=\"username\" namePath=\"name\" imageSize=\"small\"}}\n+                  </a>\n+                {{/if}}\n+              </td>\n+              <td class=\"post-metadata\">{{format-date bookmark.updated_at format=\"tiny\"}}</td>\n+              {{raw \"list/activity-column\" topic=bookmark class=\"num post-metadata\" tagName=\"td\"}}\n+            {{/unless}}\n+            <td>\n+              {{bookmark-actions-dropdown\n+              bookmark=bookmark\n+              removeBookmark=(action \"removeBookmark\")\n+              editBookmark=(action \"editBookmark\")\n+              }}\n+            </td>\n+          </tr>\n+        {{/each}}\n+      </tbody>\n+    </table>\n+    {{conditional-loading-spinner condition=loadingMore}}\n+  {{/load-more}}\n+{{/conditional-loading-spinner}}"
    },
    {
      "sha": "d9733ff885791c1cb9e9ef135e625a78b221abaa",
      "filename": "app/assets/javascripts/discourse/app/templates/user/bookmarks.hbs",
      "status": "modified",
      "additions": 6,
      "deletions": 81,
      "changes": 87,
      "blob_url": "https://github.com/discourse/discourse/blob/bb74ccf2888d99c98ad406998eeb15070863ded7/app/assets/javascripts/discourse/app/templates/user/bookmarks.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/bb74ccf2888d99c98ad406998eeb15070863ded7/app/assets/javascripts/discourse/app/templates/user/bookmarks.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/user/bookmarks.hbs?ref=bb74ccf2888d99c98ad406998eeb15070863ded7",
      "patch": "@@ -13,85 +13,10 @@\n {{#if noContent}}\n   <div class=\"alert alert-info\">{{noResultsHelp}}</div>\n {{else}}\n-  <div class=\"bookmark-list-wrapper\">\n-    {{#conditional-loading-spinner condition=loading}}\n-      {{#load-more selector=\".bookmark-list .bookmark-list-item\" action=(action \"loadMore\")}}\n-        <table class=\"topic-list bookmark-list\">\n-          <thead>\n-            {{#if site.mobileView}}\n-              <th>&nbsp;</th>\n-              <th>{{i18n \"topic.title\"}}</th>\n-              <th>&nbsp;</th>\n-            {{else}}\n-              <th>{{i18n \"topic.title\"}}</th>\n-              <th>&nbsp;</th>\n-              <th class=\"post-metadata\">{{i18n \"post.bookmarks.updated\"}}</th>\n-              <th class=\"post-metadata\">{{i18n \"activity\"}}</th>\n-              <th>&nbsp;</th>\n-            {{/if}}\n-          </thead>\n-          <tbody>\n-            {{#each content as |bookmark|}}\n-              <tr class=\"topic-list-item bookmark-list-item\">\n-                {{#if site.mobileView}}\n-                  <td>\n-                    {{#if bookmark.post_user_avatar_template}}\n-                      <a href={{bookmark.postUser.path}} data-user-card={{bookmark.post_user_username}}>\n-                        {{avatar bookmark.postUser avatarTemplatePath=\"avatar_template\" usernamePath=\"username\" namePath=\"name\" imageSize=\"small\"}}\n-                      </a>\n-                    {{/if}}\n-                  </td>\n-                {{/if}}\n-                <td class=\"main-link\">\n-                  <span class=\"link-top-line\">\n-                    <div class=\"bookmark-metadata\">\n-                      {{#if bookmark.name}}\n-                        <span class=\"bookmark-metadata-item\">\n-                          {{d-icon \"info-circle\"}}{{bookmark.name}}\n-                        </span>\n-                      {{/if}}\n-                      {{#if bookmark.reminder_at}}\n-                        <span class=\"bookmark-metadata-item\">\n-                          {{d-icon \"far-clock\"}}{{bookmark.formattedReminder}}\n-                        </span>\n-                      {{/if}}\n-                    </div>\n-\n-                    {{topic-status topic=bookmark}}\n-                    {{topic-link bookmark}}\n-                  </span>\n-                  {{#if bookmark.excerpt}}\n-                    <p class=\"post-excerpt\">{{html-safe bookmark.excerpt}}</p>\n-                  {{/if}}\n-                  <div class=\"link-bottom-line\">\n-                    {{category-link bookmark.category}}\n-                    {{discourse-tags bookmark mode=\"list\" tagsForUser=tagsForUser}}\n-                  </div>\n-                </td>\n-                {{#unless site.mobileView}}\n-                  <td>\n-                    {{#if bookmark.post_user_avatar_template}}\n-                      <a href={{bookmark.postUser.path}} data-user-card={{bookmark.post_user_username}}>\n-                        {{avatar bookmark.postUser avatarTemplatePath=\"avatar_template\" usernamePath=\"username\" namePath=\"name\" imageSize=\"small\"}}\n-                      </a>\n-                    {{/if}}\n-                  </td>\n-                  <td class=\"post-metadata\">{{format-date bookmark.updated_at format=\"tiny\"}}</td>\n-                  {{raw \"list/activity-column\" topic=bookmark class=\"num post-metadata\" tagName=\"td\"}}\n-                {{/unless}}\n-                <td>\n-                  {{bookmark-actions-dropdown\n-                    bookmark=bookmark\n-                    removeBookmark=(action \"removeBookmark\")\n-                    editBookmark=(action \"editBookmark\")\n-                  }}\n-                </td>\n-              </tr>\n-            {{/each}}\n-          </tbody>\n-        </table>\n-        {{conditional-loading-spinner condition=loadingMore}}\n-      {{/load-more}}\n-    {{/conditional-loading-spinner}}\n-  </div>\n+  {{bookmark-list\n+    loadMore=(action \"loadMore\")\n+    reload=(action \"reload\")\n+    loading=loading\n+    loadingMore=loadingMore\n+    content=content}}\n {{/if}}"
    }
  ]
}
