{
  "sha": "5c36aca9ece0458012e7249f42d38a894924df95",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOjVjMzZhY2E5ZWNlMDQ1ODAxMmU3MjQ5ZjQyZDM4YTg5NDkyNGRmOTU=",
  "commit": {
    "author": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2020-05-23T16:58:39Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-05-23T16:58:39Z"
    },
    "message": "Merge pull request #716 from Mavrin/fix_name_regexp\n\nallow non latin letter for user name",
    "tree": {
      "sha": "7c5d0c5b84ee9ef392b86e510277ef5fe48648dd",
      "url": "https://api.github.com/repos/umputun/remark42/git/trees/7c5d0c5b84ee9ef392b86e510277ef5fe48648dd"
    },
    "url": "https://api.github.com/repos/umputun/remark42/git/commits/5c36aca9ece0458012e7249f42d38a894924df95",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeyVY/CRBK7hj4Ov3rIwAAdHIIAITx51z0VqG9yOiRJTVpp4R7\nMQZCDbrMFoBHNji9gw6hSesdAfJ72byZCIE0vjZCczolS1OfKkxPrNVXWBYx9OnS\nNthSZdqKbODLPCkS3KN8892Zg0cnOlGy+lT0IU7RLh8pA7/cNNwQ3Usvr3jyz/0B\nSo4R5bizuyKIq7/+cXbqScxZzXyC61E52EJIfACQ7k8vKDGuAysjNZLZIobd8Qi7\nlAsTtSZWqsxGn79irSc9AEvlzGTyFmasQj632AiIykABkMCdyANzY28qGAaTP3aq\ngzrr/cJjga3Qr6I47Pwp0+SomKd+COKZobVTVHcCW0SyflCiTKBwkjNfWeBbqak=\n=Prsj\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 7c5d0c5b84ee9ef392b86e510277ef5fe48648dd\nparent 2f20b64c0f7804c32907227d526678e66a38368e\nparent 07a9f84c49fd7fabd45da525f35eb95aca1b71f5\nauthor Umputun <umputun@gmail.com> 1590253119 -0500\ncommitter GitHub <noreply@github.com> 1590253119 -0500\n\nMerge pull request #716 from Mavrin/fix_name_regexp\n\nallow non latin letter for user name"
    }
  },
  "url": "https://api.github.com/repos/umputun/remark42/commits/5c36aca9ece0458012e7249f42d38a894924df95",
  "html_url": "https://github.com/umputun/remark42/commit/5c36aca9ece0458012e7249f42d38a894924df95",
  "comments_url": "https://api.github.com/repos/umputun/remark42/commits/5c36aca9ece0458012e7249f42d38a894924df95/comments",
  "author": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2f20b64c0f7804c32907227d526678e66a38368e",
      "url": "https://api.github.com/repos/umputun/remark42/commits/2f20b64c0f7804c32907227d526678e66a38368e",
      "html_url": "https://github.com/umputun/remark42/commit/2f20b64c0f7804c32907227d526678e66a38368e"
    },
    {
      "sha": "07a9f84c49fd7fabd45da525f35eb95aca1b71f5",
      "url": "https://api.github.com/repos/umputun/remark42/commits/07a9f84c49fd7fabd45da525f35eb95aca1b71f5",
      "html_url": "https://github.com/umputun/remark42/commit/07a9f84c49fd7fabd45da525f35eb95aca1b71f5"
    }
  ],
  "stats": {
    "total": 35,
    "additions": 26,
    "deletions": 9
  },
  "files": [
    {
      "sha": "1379630b24f6cd299d8510c39f4c16162799aeab",
      "filename": "frontend/.size-limit.js",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark42/blob/5c36aca9ece0458012e7249f42d38a894924df95/frontend/.size-limit.js",
      "raw_url": "https://github.com/umputun/remark42/raw/5c36aca9ece0458012e7249f42d38a894924df95/frontend/.size-limit.js",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend/.size-limit.js?ref=5c36aca9ece0458012e7249f42d38a894924df95",
      "patch": "@@ -4,7 +4,7 @@ module.exports = [\n     limit: '2.55 KB',\n   },\n   {\n-    limit: '83 KB',\n+    limit: '86 KB',\n     path: 'public/remark.js',\n   },\n   {"
    },
    {
      "sha": "77ab38ba853c11f74dcff3218fb1d5a077023454",
      "filename": "frontend/app/components/auth/__anonymous-login-form/auth__anonymous-login-form.tsx",
      "status": "modified",
      "additions": 4,
      "deletions": 5,
      "changes": 9,
      "blob_url": "https://github.com/umputun/remark42/blob/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/components/auth/__anonymous-login-form/auth__anonymous-login-form.tsx",
      "raw_url": "https://github.com/umputun/remark42/raw/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/components/auth/__anonymous-login-form/auth__anonymous-login-form.tsx",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend/app/components/auth/__anonymous-login-form/auth__anonymous-login-form.tsx?ref=5c36aca9ece0458012e7249f42d38a894924df95",
      "patch": "@@ -7,6 +7,8 @@ import { Theme } from '@app/common/types';\n import { Input } from '@app/components/input';\n import { Button } from '@app/components/button';\n \n+import { validateUserName } from '../validateUserName';\n+\n interface Props {\n   onSubmit(username: string): Promise<void>;\n   theme: Theme;\n@@ -26,7 +28,7 @@ export const messages = defineMessages({\n   },\n   symbolLimit: {\n     id: 'anonymousLoginForm.symbol-limit',\n-    defaultMessage: 'Username must start with a letter and contain only latin letters, numbers, underscores, or spaces',\n+    defaultMessage: 'Username must contain only letters, numbers, underscores or spaces',\n   },\n   userName: {\n     id: 'anonymousLoginForm.user-name',\n@@ -35,13 +37,10 @@ export const messages = defineMessages({\n });\n \n export class AnonymousLoginForm extends Component<Props, State> {\n-  static usernameRegex = /^[a-zA-Z][\\w ]+$/;\n-\n   inputRef = createRef<HTMLInputElement>();\n \n   constructor(props: Props) {\n     super(props);\n-\n     this.state = {\n       inputValue: '',\n       honeyPotValue: false,\n@@ -70,7 +69,7 @@ export class AnonymousLoginForm extends Component<Props, State> {\n     const value = this.state.inputValue;\n     const intl = this.props.intl;\n     if (value.length < 3) return intl.formatMessage(messages.lengthLimit);\n-    if (!AnonymousLoginForm.usernameRegex.test(value)) return intl.formatMessage(messages.symbolLimit);\n+    if (!validateUserName(value)) return intl.formatMessage(messages.symbolLimit);\n     return null;\n   }\n "
    },
    {
      "sha": "c6b544af9ebd65508a9243b75a4f8fe741c11be8",
      "filename": "frontend/app/components/auth/__email-login-form/auth__email-login-form.tsx",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/umputun/remark42/blob/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/components/auth/__email-login-form/auth__email-login-form.tsx",
      "raw_url": "https://github.com/umputun/remark42/raw/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/components/auth/__email-login-form/auth__email-login-form.tsx",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend/app/components/auth/__email-login-form/auth__email-login-form.tsx?ref=5c36aca9ece0458012e7249f42d38a894924df95",
      "patch": "@@ -13,6 +13,8 @@ import { Button } from '@app/components/button';\n import { isJwtExpired } from '@app/utils/jwt';\n import { defineMessages, IntlShape, useIntl, FormattedMessage } from 'react-intl';\n \n+import { validateUserName } from '../validateUserName';\n+\n import { messages as loginForm } from '../__anonymous-login-form/auth__anonymous-login-form';\n \n interface OwnProps {\n@@ -65,7 +67,6 @@ const messages = defineMessages({\n });\n \n export class EmailLoginForm extends Component<Props, State> {\n-  static usernameRegex = /^[a-zA-Z][\\w ]+$/;\n   static emailRegex = /[^@]+@[^.]+\\..+/;\n \n   usernameInputRef = createRef<HTMLInputElement>();\n@@ -179,7 +180,7 @@ export class EmailLoginForm extends Component<Props, State> {\n     if (this.state.loading) return intl.formatMessage(messages.loading);\n     const username = this.state.usernameValue;\n     if (username.length < 3) return intl.formatMessage(loginForm.lengthLimit);\n-    if (!EmailLoginForm.usernameRegex.test(username)) return intl.formatMessage(loginForm.symbolLimit);\n+    if (!validateUserName(username)) return intl.formatMessage(loginForm.symbolLimit);\n     if (!EmailLoginForm.emailRegex.test(this.state.addressValue)) return intl.formatMessage(messages.invalidEmail);\n     return null;\n   }"
    },
    {
      "sha": "80b5994d2d561877668fa75cbb66d70b7392d886",
      "filename": "frontend/app/components/auth/validateUserName.test.ts",
      "status": "added",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/umputun/remark42/blob/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/components/auth/validateUserName.test.ts",
      "raw_url": "https://github.com/umputun/remark42/raw/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/components/auth/validateUserName.test.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend/app/components/auth/validateUserName.test.ts?ref=5c36aca9ece0458012e7249f42d38a894924df95",
      "patch": "@@ -0,0 +1,13 @@\n+import { validateUserName } from './validateUserName';\n+\n+describe('validate user name', () => {\n+  it('should allow good name', () => {\n+    expect(validateUserName('Раз_Два Три_34567')).toEqual(true);\n+  });\n+  it('should not allow bad name', () => {\n+    expect(validateUserName('**blah123')).toEqual(false);\n+  });\n+  it('should not allow only spaces', () => {\n+    expect(validateUserName('     ')).toEqual(false);\n+  });\n+});"
    },
    {
      "sha": "988a4785c30c66c975db33f2728da90495979b69",
      "filename": "frontend/app/components/auth/validateUserName.ts",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/umputun/remark42/blob/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/components/auth/validateUserName.ts",
      "raw_url": "https://github.com/umputun/remark42/raw/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/components/auth/validateUserName.ts",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend/app/components/auth/validateUserName.ts?ref=5c36aca9ece0458012e7249f42d38a894924df95",
      "patch": "@@ -0,0 +1,4 @@\n+const userNameRegex = /^[\\p{L}\\d_ ]+$/u;\n+export function validateUserName(userName: string) {\n+  return userNameRegex.test(userName.trim());\n+}"
    },
    {
      "sha": "040dec9293e10358738a6feed1deb0daf1d38f23",
      "filename": "frontend/app/locales/en.json",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark42/blob/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/locales/en.json",
      "raw_url": "https://github.com/umputun/remark42/raw/5c36aca9ece0458012e7249f42d38a894924df95/frontend/app/locales/en.json",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend/app/locales/en.json?ref=5c36aca9ece0458012e7249f42d38a894924df95",
      "patch": "@@ -1,7 +1,7 @@\n {\n   \"anonymousLoginForm.length-limit\": \"Username must be at least 3 characters long\",\n   \"anonymousLoginForm.log-in\": \"Log in\",\n-  \"anonymousLoginForm.symbol-limit\": \"Username must start with a letter and contain only latin letters, numbers, underscores, or spaces\",\n+  \"anonymousLoginForm.symbol-limit\": \"Username must contain only letters, numbers, underscores or spaces\",\n   \"anonymousLoginForm.user-name\": \"Username\",\n   \"authPanel.anonymous-provider\": \"Anonymous\",\n   \"authPanel.disable-comments\": \"Disable comments\","
    }
  ]
}
