{
  "sha": "ca9456acc0b9a537e42e9c83cab416e2c25d6a95",
  "node_id": "MDY6Q29tbWl0NzI0NTQyNDI6Y2E5NDU2YWNjMGI5YTUzN2U0MmU5YzgzY2FiNDE2ZTJjMjVkNmE5NQ==",
  "commit": {
    "author": {
      "name": "Nick Funk",
      "email": "nick.funk@outlook.com",
      "date": "2020-08-18T17:57:55Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2020-08-18T17:57:55Z"
    },
    "message": "Hide user media preferences if all media types are disabled (#3107)\n\nCORL-1282\n\nCo-authored-by: kodiakhq[bot] <49736102+kodiakhq[bot]@users.noreply.github.com>\nCo-authored-by: Kim Gardner <kgardnr@gmail.com>",
    "tree": {
      "sha": "d69a1a3cff7093ec16daf601cbbed9a274f61152",
      "url": "https://api.github.com/repos/coralproject/talk/git/trees/d69a1a3cff7093ec16daf601cbbed9a274f61152"
    },
    "url": "https://api.github.com/repos/coralproject/talk/git/commits/ca9456acc0b9a537e42e9c83cab416e2c25d6a95",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfPBajCRBK7hj4Ov3rIwAAdHIIAK2s8pkC3pooktddBWff5B8S\ndSRioBQOwaau3aHyDRG1gw/woWNBPAaX5CI22HeirTiEmXOfCPWN/D4LnAzpxxdV\nnXFt6Qqi/XUokF+q+5Z+fhvRZ1SiZoaD3sE3B+HDapLjPC9ewj3bbI8PE+dYD1sz\n6GhFhNsri5udJkVMPybcNoduRy3bGUqBIJCQQHipJUDNQ6bp/qhAoYt+iveEllSN\ntDyay5Wqa57cnsm7WzlwKs/pqNbnp50lo8obp2cShbtO4EaEuHChLD+OKZrBIOPj\nrTgLFLuiKTHvOpXkoUSWjWwbKTmi31g4xmSgZV/cOJKU0JhdPlKOmY0TGLQcH6Q=\n=83Gt\n-----END PGP SIGNATURE-----\n",
      "payload": "tree d69a1a3cff7093ec16daf601cbbed9a274f61152\nparent a977d4c9e34b02425cf8432a2fddadac323addab\nauthor Nick Funk <nick.funk@outlook.com> 1597773475 -0600\ncommitter GitHub <noreply@github.com> 1597773475 +0000\n\nHide user media preferences if all media types are disabled (#3107)\n\nCORL-1282\n\nCo-authored-by: kodiakhq[bot] <49736102+kodiakhq[bot]@users.noreply.github.com>\nCo-authored-by: Kim Gardner <kgardnr@gmail.com>"
    }
  },
  "url": "https://api.github.com/repos/coralproject/talk/commits/ca9456acc0b9a537e42e9c83cab416e2c25d6a95",
  "html_url": "https://github.com/coralproject/talk/commit/ca9456acc0b9a537e42e9c83cab416e2c25d6a95",
  "comments_url": "https://api.github.com/repos/coralproject/talk/commits/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/comments",
  "author": {
    "login": "nick-funk",
    "id": 5751504,
    "node_id": "MDQ6VXNlcjU3NTE1MDQ=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/5751504?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nick-funk",
    "html_url": "https://github.com/nick-funk",
    "followers_url": "https://api.github.com/users/nick-funk/followers",
    "following_url": "https://api.github.com/users/nick-funk/following{/other_user}",
    "gists_url": "https://api.github.com/users/nick-funk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nick-funk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nick-funk/subscriptions",
    "organizations_url": "https://api.github.com/users/nick-funk/orgs",
    "repos_url": "https://api.github.com/users/nick-funk/repos",
    "events_url": "https://api.github.com/users/nick-funk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nick-funk/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a977d4c9e34b02425cf8432a2fddadac323addab",
      "url": "https://api.github.com/repos/coralproject/talk/commits/a977d4c9e34b02425cf8432a2fddadac323addab",
      "html_url": "https://github.com/coralproject/talk/commit/a977d4c9e34b02425cf8432a2fddadac323addab"
    }
  ],
  "stats": {
    "total": 215,
    "additions": 131,
    "deletions": 84
  },
  "files": [
    {
      "sha": "b9f02fbb319133e2d7e29486afd76a73faf8a5e9",
      "filename": "src/core/client/stream/tabs/Profile/Preferences/MediaSettingsContainer.tsx",
      "status": "modified",
      "additions": 115,
      "deletions": 79,
      "changes": 194,
      "blob_url": "https://github.com/coralproject/talk/blob/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/src/core/client/stream/tabs/Profile/Preferences/MediaSettingsContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/src/core/client/stream/tabs/Profile/Preferences/MediaSettingsContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Profile/Preferences/MediaSettingsContainer.tsx?ref=ca9456acc0b9a537e42e9c83cab416e2c25d6a95",
      "patch": "@@ -13,21 +13,27 @@ import {\n   FieldSet,\n   FormField,\n   HorizontalGutter,\n+  HorizontalRule,\n   Icon,\n } from \"coral-ui/components/v2\";\n import { Button, CallOut } from \"coral-ui/components/v3\";\n \n+import { MediaSettingsContainer_settings } from \"coral-stream/__generated__/MediaSettingsContainer_settings.graphql\";\n import { MediaSettingsContainer_viewer } from \"coral-stream/__generated__/MediaSettingsContainer_viewer.graphql\";\n \n import UpdateUserMediaSettingsMutation from \"./UpdateUserMediaSettingsMutation\";\n \n import styles from \"./MediaSettingsContainer.css\";\n \n interface Props {\n+  settings: MediaSettingsContainer_settings;\n   viewer: MediaSettingsContainer_viewer;\n }\n \n-const MediaSettingsContainer: FunctionComponent<Props> = ({ viewer }) => {\n+const MediaSettingsContainer: FunctionComponent<Props> = ({\n+  viewer,\n+  settings,\n+}) => {\n   const updateMediaSettings = useMutation(UpdateUserMediaSettingsMutation);\n   const [showSuccess, setShowSuccess] = useState(false);\n   const [showError, setShowError] = useState(false);\n@@ -58,91 +64,121 @@ const MediaSettingsContainer: FunctionComponent<Props> = ({ viewer }) => {\n     [updateMediaSettings, setShowSuccess, setShowError]\n   );\n \n+  if (\n+    !settings.media?.giphy?.enabled &&\n+    !settings.media?.twitter?.enabled &&\n+    !settings.media?.youtube?.enabled\n+  ) {\n+    return null;\n+  }\n+\n   return (\n-    <HorizontalGutter>\n-      <Form initialValues={viewer.mediaSettings} onSubmit={onSubmit}>\n-        {({\n-          handleSubmit,\n-          submitting,\n-          submitError,\n-          pristine,\n-          submitSucceeded,\n-        }) => (\n-          <form className={styles.form} onSubmit={handleSubmit}>\n-            <Localized id=\"profile-preferences-mediaPreferences\">\n-              <div className={styles.title}>Media Preferences</div>\n-            </Localized>\n-            <div className={styles.options}>\n-              <FieldSet>\n-                <FormField>\n-                  <Field name=\"unfurlEmbeds\" type=\"checkbox\">\n-                    {({ input }) => (\n-                      <CheckBox {...input} id={input.name} variant=\"streamBlue\">\n-                        <Localized id=\"profile-preferences-mediaPreferences-alwaysShow\">\n-                          <div>Always show GIFs, Tweets, YouTube, etc.</div>\n-                        </Localized>\n-                      </CheckBox>\n-                    )}\n-                  </Field>\n-                </FormField>\n-              </FieldSet>\n-              <Localized id=\"profile-preferences-mediaPreferences-thisMayMake\">\n-                <div className={styles.checkBoxDescription}>\n-                  This may make the comments slower to load\n-                </div>\n-              </Localized>\n-            </div>\n-            <div\n-              className={cn(styles.updateButton, {\n-                [styles.updateButtonNotification]: showSuccess || showError,\n-              })}\n-            >\n-              <Localized id=\"profile-preferences-mediaPreferences-update\">\n-                <Button\n-                  type=\"submit\"\n-                  disabled={submitting || pristine}\n-                  className={CLASSES.mediaPreferences.updateButton}\n-                  upperCase\n-                >\n-                  Update\n-                </Button>\n+    <>\n+      <HorizontalGutter>\n+        <Form initialValues={viewer.mediaSettings} onSubmit={onSubmit}>\n+          {({\n+            handleSubmit,\n+            submitting,\n+            submitError,\n+            pristine,\n+            submitSucceeded,\n+          }) => (\n+            <form className={styles.form} onSubmit={handleSubmit}>\n+              <Localized id=\"profile-preferences-mediaPreferences\">\n+                <div className={styles.title}>Media Preferences</div>\n               </Localized>\n-            </div>\n-            {((submitError && showError) ||\n-              (submitSucceeded && showSuccess)) && (\n-              <div className={styles.callOut}>\n-                {submitError && showError && (\n-                  <CallOut\n-                    color=\"error\"\n-                    onClose={closeError}\n-                    icon={<Icon size=\"sm\">warning</Icon>}\n-                    titleWeight=\"semiBold\"\n-                    title={<span>{submitError}</span>}\n-                  />\n-                )}\n-                {submitSucceeded && showSuccess && (\n-                  <CallOut\n-                    color=\"success\"\n-                    onClose={closeSuccess}\n-                    icon={<Icon size=\"sm\">check_circle</Icon>}\n-                    titleWeight=\"semiBold\"\n-                    title={\n-                      <Localized id=\"profile-preferences-mediaPreferences-preferencesUpdated\">\n-                        <span>Your media preferences have been updated</span>\n-                      </Localized>\n-                    }\n-                  />\n-                )}\n+              <div className={styles.options}>\n+                <FieldSet>\n+                  <FormField>\n+                    <Field name=\"unfurlEmbeds\" type=\"checkbox\">\n+                      {({ input }) => (\n+                        <CheckBox\n+                          {...input}\n+                          id={input.name}\n+                          variant=\"streamBlue\"\n+                        >\n+                          <Localized id=\"profile-preferences-mediaPreferences-alwaysShow\">\n+                            <div>Always show GIFs, Tweets, YouTube, etc.</div>\n+                          </Localized>\n+                        </CheckBox>\n+                      )}\n+                    </Field>\n+                  </FormField>\n+                </FieldSet>\n+                <Localized id=\"profile-preferences-mediaPreferences-thisMayMake\">\n+                  <div className={styles.checkBoxDescription}>\n+                    This may make the comments slower to load\n+                  </div>\n+                </Localized>\n               </div>\n-            )}\n-          </form>\n-        )}\n-      </Form>\n-    </HorizontalGutter>\n+              <div\n+                className={cn(styles.updateButton, {\n+                  [styles.updateButtonNotification]: showSuccess || showError,\n+                })}\n+              >\n+                <Localized id=\"profile-preferences-mediaPreferences-update\">\n+                  <Button\n+                    type=\"submit\"\n+                    disabled={submitting || pristine}\n+                    className={CLASSES.mediaPreferences.updateButton}\n+                    upperCase\n+                  >\n+                    Update\n+                  </Button>\n+                </Localized>\n+              </div>\n+              {((submitError && showError) ||\n+                (submitSucceeded && showSuccess)) && (\n+                <div className={styles.callOut}>\n+                  {submitError && showError && (\n+                    <CallOut\n+                      color=\"error\"\n+                      onClose={closeError}\n+                      icon={<Icon size=\"sm\">warning</Icon>}\n+                      titleWeight=\"semiBold\"\n+                      title={<span>{submitError}</span>}\n+                    />\n+                  )}\n+                  {submitSucceeded && showSuccess && (\n+                    <CallOut\n+                      color=\"success\"\n+                      onClose={closeSuccess}\n+                      icon={<Icon size=\"sm\">check_circle</Icon>}\n+                      titleWeight=\"semiBold\"\n+                      title={\n+                        <Localized id=\"profile-preferences-mediaPreferences-preferencesUpdated\">\n+                          <span>Your media preferences have been updated</span>\n+                        </Localized>\n+                      }\n+                    />\n+                  )}\n+                </div>\n+              )}\n+            </form>\n+          )}\n+        </Form>\n+      </HorizontalGutter>\n+      <HorizontalRule></HorizontalRule>\n+    </>\n   );\n };\n \n const enhanced = withFragmentContainer<Props>({\n+  settings: graphql`\n+    fragment MediaSettingsContainer_settings on Settings {\n+      media {\n+        giphy {\n+          enabled\n+        }\n+        twitter {\n+          enabled\n+        }\n+        youtube {\n+          enabled\n+        }\n+      }\n+    }\n+  `,\n   viewer: graphql`\n     fragment MediaSettingsContainer_viewer on User {\n       id"
    },
    {
      "sha": "bac4bf45c598dde48b542111605f25fadffa65c7",
      "filename": "src/core/client/stream/tabs/Profile/Preferences/PreferencesContainer.tsx",
      "status": "modified",
      "additions": 9,
      "deletions": 3,
      "changes": 12,
      "blob_url": "https://github.com/coralproject/talk/blob/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/src/core/client/stream/tabs/Profile/Preferences/PreferencesContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/src/core/client/stream/tabs/Profile/Preferences/PreferencesContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Profile/Preferences/PreferencesContainer.tsx?ref=ca9456acc0b9a537e42e9c83cab416e2c25d6a95",
      "patch": "@@ -2,8 +2,9 @@ import React, { FunctionComponent } from \"react\";\n import { graphql } from \"react-relay\";\n \n import { withFragmentContainer } from \"coral-framework/lib/relay\";\n-import { HorizontalGutter, HorizontalRule } from \"coral-ui/components/v2\";\n+import { HorizontalGutter } from \"coral-ui/components/v2\";\n \n+import { PreferencesContainer_settings } from \"coral-stream/__generated__/PreferencesContainer_settings.graphql\";\n import { PreferencesContainer_viewer } from \"coral-stream/__generated__/PreferencesContainer_viewer.graphql\";\n \n import IgnoreUserSettingsContainer from \"./IgnoreUserSettingsContainer\";\n@@ -12,20 +13,25 @@ import NotificationSettingsContainer from \"./NotificationSettingsContainer\";\n \n interface Props {\n   viewer: PreferencesContainer_viewer;\n+  settings: PreferencesContainer_settings;\n }\n \n const PreferencesContainer: FunctionComponent<Props> = (props) => {\n   return (\n     <HorizontalGutter spacing={4}>\n       <NotificationSettingsContainer viewer={props.viewer} />\n-      <MediaSettingsContainer viewer={props.viewer} />\n-      <HorizontalRule></HorizontalRule>\n+      <MediaSettingsContainer viewer={props.viewer} settings={props.settings} />\n       <IgnoreUserSettingsContainer viewer={props.viewer} />\n     </HorizontalGutter>\n   );\n };\n \n const enhanced = withFragmentContainer<Props>({\n+  settings: graphql`\n+    fragment PreferencesContainer_settings on Settings {\n+      ...MediaSettingsContainer_settings\n+    }\n+  `,\n   viewer: graphql`\n     fragment PreferencesContainer_viewer on User {\n       ...NotificationSettingsContainer_viewer"
    },
    {
      "sha": "f31963913aa95b7182495afeab5d331c488ed777",
      "filename": "src/core/client/stream/tabs/Profile/Profile.tsx",
      "status": "modified",
      "additions": 6,
      "deletions": 2,
      "changes": 8,
      "blob_url": "https://github.com/coralproject/talk/blob/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/src/core/client/stream/tabs/Profile/Profile.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/src/core/client/stream/tabs/Profile/Profile.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Profile/Profile.tsx?ref=ca9456acc0b9a537e42e9c83cab416e2c25d6a95",
      "patch": "@@ -35,7 +35,8 @@ export interface ProfileProps {\n     PropTypesOf<typeof PreferencesContainer>[\"viewer\"];\n   settings: PropTypesOf<typeof UserBoxContainer>[\"settings\"] &\n     PropTypesOf<typeof AccountSettingsContainer>[\"settings\"] &\n-    PropTypesOf<typeof MyCommentsContainer>[\"settings\"];\n+    PropTypesOf<typeof MyCommentsContainer>[\"settings\"] &\n+    PropTypesOf<typeof PreferencesContainer>[\"settings\"];\n }\n \n const Profile: FunctionComponent<ProfileProps> = (props) => {\n@@ -135,7 +136,10 @@ const Profile: FunctionComponent<ProfileProps> = (props) => {\n           className={CLASSES.preferencesTabPane.$root}\n           tabID=\"PREFERENCES\"\n         >\n-          <PreferencesContainer viewer={props.viewer} />\n+          <PreferencesContainer\n+            viewer={props.viewer}\n+            settings={props.settings}\n+          />\n         </TabPane>\n         {showAccountTab && (\n           <TabPane className={CLASSES.accountTabPane.$root} tabID=\"ACCOUNT\">"
    },
    {
      "sha": "f3c9659478a0776362baa073b43d7a3c466ea0fb",
      "filename": "src/core/client/stream/tabs/Profile/ProfileContainer.tsx",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/coralproject/talk/blob/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/src/core/client/stream/tabs/Profile/ProfileContainer.tsx",
      "raw_url": "https://github.com/coralproject/talk/raw/ca9456acc0b9a537e42e9c83cab416e2c25d6a95/src/core/client/stream/tabs/Profile/ProfileContainer.tsx",
      "contents_url": "https://api.github.com/repos/coralproject/talk/contents/src/core/client/stream/tabs/Profile/ProfileContainer.tsx?ref=ca9456acc0b9a537e42e9c83cab416e2c25d6a95",
      "patch": "@@ -56,6 +56,7 @@ const enhanced = withFragmentContainer<ProfileContainerProps>({\n       ...UserBoxContainer_settings\n       ...AccountSettingsContainer_settings\n       ...MyCommentsContainer_settings\n+      ...PreferencesContainer_settings\n     }\n   `,\n })(ProfileContainer);"
    }
  ]
}
