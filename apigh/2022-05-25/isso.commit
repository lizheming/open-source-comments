{
  "sha": "06dff17c255bea55f0f71f1ebecfe5be4d32e2b7",
  "node_id": "C_kwDOAF-mA9oAKDA2ZGZmMTdjMjU1YmVhNTVmMGY3MWYxZWJlY2ZlNWJlNGQzMmUyYjc",
  "commit": {
    "author": {
      "name": "ix5",
      "email": "ix5@users.noreply.github.com",
      "date": "2022-05-25T09:34:03Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2022-05-25T09:34:03Z"
    },
    "message": "Merge pull request #886 from ix5/client-bugfixes\n\n[client] Minor client bugfixes",
    "tree": {
      "sha": "822b730a1dd6cb81e5971348017a3d840ad233dc",
      "url": "https://api.github.com/repos/posativ/isso/git/trees/822b730a1dd6cb81e5971348017a3d840ad233dc"
    },
    "url": "https://api.github.com/repos/posativ/isso/git/commits/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJijfgLCRBK7hj4Ov3rIwAAhWEIAEskCOSF7lJObn9CCyZoa5mP\n9iE+8FjsLzsIiVRsIu+WRpmw1mu9ybNa+CAlUbTNstB5mGsL3w6Kd1WEKnyZgUZ8\nIWTvjMbDZ/4VzMX5G5BmCJFy2Tcw+cIlvDCjQXpLNgrN19Gs1aCWPU3UmLf90z75\nmuTpkJir8KQwnKrS10Qb4oJ6BSwc4yyMaBQyjrnC8fELjk7xAmG4ruDLS1WP8DXE\nobN6Gv6S02jqoetxUBsrl7YRl7Y1g39pHMHv4YGrScZKtGBQ2wPsasEe9u3Dm+P8\nVMiF0VUdOXgyZxX/avvsdsPXW+YNvD+SGA8s9NteJ/k24Y0DrLI1T0xZCwQ6SBk=\n=T2wj\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 822b730a1dd6cb81e5971348017a3d840ad233dc\nparent 9e6ec82838195425be087e05beb065cde879712f\nparent 8408426c72982e07f5bc0489db4181a0c79056b7\nauthor ix5 <ix5@users.noreply.github.com> 1653471243 +0200\ncommitter GitHub <noreply@github.com> 1653471243 +0200\n\nMerge pull request #886 from ix5/client-bugfixes\n\n[client] Minor client bugfixes"
    }
  },
  "url": "https://api.github.com/repos/posativ/isso/commits/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7",
  "html_url": "https://github.com/posativ/isso/commit/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7",
  "comments_url": "https://api.github.com/repos/posativ/isso/commits/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7/comments",
  "author": {
    "login": "ix5",
    "id": 10212877,
    "node_id": "MDQ6VXNlcjEwMjEyODc3",
    "avatar_url": "https://avatars.githubusercontent.com/u/10212877?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ix5",
    "html_url": "https://github.com/ix5",
    "followers_url": "https://api.github.com/users/ix5/followers",
    "following_url": "https://api.github.com/users/ix5/following{/other_user}",
    "gists_url": "https://api.github.com/users/ix5/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ix5/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ix5/subscriptions",
    "organizations_url": "https://api.github.com/users/ix5/orgs",
    "repos_url": "https://api.github.com/users/ix5/repos",
    "events_url": "https://api.github.com/users/ix5/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ix5/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9e6ec82838195425be087e05beb065cde879712f",
      "url": "https://api.github.com/repos/posativ/isso/commits/9e6ec82838195425be087e05beb065cde879712f",
      "html_url": "https://github.com/posativ/isso/commit/9e6ec82838195425be087e05beb065cde879712f"
    },
    {
      "sha": "8408426c72982e07f5bc0489db4181a0c79056b7",
      "url": "https://api.github.com/repos/posativ/isso/commits/8408426c72982e07f5bc0489db4181a0c79056b7",
      "html_url": "https://github.com/posativ/isso/commit/8408426c72982e07f5bc0489db4181a0c79056b7"
    }
  ],
  "stats": {
    "total": 37,
    "additions": 27,
    "deletions": 10
  },
  "files": [
    {
      "sha": "b40626a077a59d5cbfdb0fd8ed724146f7a1b9e0",
      "filename": "isso/js/app/api.js",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/posativ/isso/blob/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7/isso%2Fjs%2Fapp%2Fapi.js",
      "raw_url": "https://github.com/posativ/isso/raw/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7/isso%2Fjs%2Fapp%2Fapi.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Fapp%2Fapi.js?ref=06dff17c255bea55f0f71f1ebecfe5be4d32e2b7",
      "patch": "@@ -157,8 +157,6 @@ var fetch = function(tid, limit, nested_limit, parent, lastcreated) {\n         qs(query_dict), null, function(rv) {\n             if (rv.status === 200) {\n                 deferred.resolve(JSON.parse(rv.body));\n-            } else if (rv.status === 404) {\n-                deferred.resolve({total_replies: 0});\n             } else {\n                 deferred.reject(rv.body);\n             }"
    },
    {
      "sha": "bb63d1270f8641f6f15b3066acdec8013bdb5290",
      "filename": "isso/js/embed.js",
      "status": "modified",
      "additions": 18,
      "deletions": 8,
      "changes": 26,
      "blob_url": "https://github.com/posativ/isso/blob/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7/isso%2Fjs%2Fembed.js",
      "raw_url": "https://github.com/posativ/isso/raw/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7/isso%2Fjs%2Fembed.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Fjs%2Fembed.js?ref=06dff17c255bea55f0f71f1ebecfe5be4d32e2b7",
      "patch": "@@ -65,7 +65,11 @@ function init() {\n             existingTarget.classList.remove(\"isso-target\");\n         }\n \n-        $(window.location.hash + \" > .isso-text-wrapper\").classList.add(\"isso-target\");\n+        try {\n+            $(window.location.hash + \" > .isso-text-wrapper\").classList.add(\"isso-target\");\n+        } catch(ex) {\n+            // selector probably doesn't exist as element on page\n+        }\n     });\n }\n \n@@ -93,7 +97,9 @@ function fetchComments() {\n \n             // Note: isso.Postbox relies on the config object populated by elements\n             // fetched from the server, so it cannot be created in init()\n-            isso_root.prepend(new isso.Postbox(null));\n+            // DOM polyfill prepend() will insert the element before the first\n+            // child, not before the element itself!\n+            isso_root.obj.parentElement.insertBefore(new isso.Postbox(null).obj, isso_root.obj);\n \n             if (rv.total_replies === 0) {\n                 heading.textContent = i18n.translate(\"no-comments\");\n@@ -117,12 +123,16 @@ function fetchComments() {\n \n             if (window.location.hash.length > 0 &&\n                 window.location.hash.match(\"^#isso-[0-9]+$\")) {\n-                $(window.location.hash).scrollIntoView();\n-\n-                // We can't just set the id to `#isso-target` because it's already set to `#isso-[number]`\n-                // So a class `.isso-target` has to be used instead, and then we can manually remove the\n-                // class from the old target comment in the `hashchange` listener.\n-                $(window.location.hash + \" > .isso-text-wrapper\").classList.add(\"isso-target\");\n+                try {\n+                    $(window.location.hash).scrollIntoView();\n+\n+                    // We can't just set the id to `#isso-target` because it's already set to `#isso-[number]`\n+                    // So a class `.isso-target` has to be used instead, and then we can manually remove the\n+                    // class from the old target comment in the `hashchange` listener.\n+                    $(window.location.hash + \" > .isso-text-wrapper\").classList.add(\"isso-target\");\n+                } catch(ex) {\n+                    // selector probably doesn't exist as element on page\n+                }\n             }\n         },\n         function(err) {"
    },
    {
      "sha": "969a4260d55887b94d06d7529c54f8c07858ceb9",
      "filename": "isso/tests/test_comments.py",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/posativ/isso/blob/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7/isso%2Ftests%2Ftest_comments.py",
      "raw_url": "https://github.com/posativ/isso/raw/06dff17c255bea55f0f71f1ebecfe5be4d32e2b7/isso%2Ftests%2Ftest_comments.py",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso%2Ftests%2Ftest_comments.py?ref=06dff17c255bea55f0f71f1ebecfe5be4d32e2b7",
      "patch": "@@ -166,6 +166,15 @@ def testGetInvalid(self):\n         data = loads(self.get('/?uri=?uri=%foo%2F').data)\n         self.assertEqual(len(data['replies']), 0)\n \n+    def testFetchEmpty(self):\n+\n+        empty = self.get('/?uri=%2Fempty%2F')\n+        # Empty database returns 200, not 404\n+        self.assertEqual(empty.status_code, 200)\n+        data = loads(empty.data)\n+        self.assertEqual(data['total_replies'], 0)\n+        self.assertEqual(data['id'], None)\n+\n     def testGetLimited(self):\n \n         for i in range(20):"
    }
  ]
}
