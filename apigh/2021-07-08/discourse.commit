{
  "sha": "87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODo4N2MxZTk4NTcxNjMxZDgzZTBkOWYwODQ2YmQ5NWEyYzdlOWJjZTg3",
  "commit": {
    "author": {
      "name": "Bianca Nenciu",
      "email": "nbianca@users.noreply.github.com",
      "date": "2021-07-08T07:46:21Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-07-08T07:46:21Z"
    },
    "message": "FEATURE: Let users select flair (#13587)\n\nUser flair was given by user's primary group. This PR separates the\r\ntwo, adds a new field to the user model for flair group ID and users\r\ncan select their flair from user preferences now.",
    "tree": {
      "sha": "3af4207bb30bc51f3720deaa4abe3ac770bbcd35",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/3af4207bb30bc51f3720deaa4abe3ac770bbcd35"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg5q1NCRBK7hj4Ov3rIwAAO2wIABUcImVSokMsjtz9p1JF6v/n\nybdoj6fD4BeAtb/0uyjy5FIH1PspU1I35L5V9P+9uZvzB3zoLpy6Yzmc8QqYJbEn\nwPV8oitJdp2d7TrV0Fu+suwXcx/cBgPMXEo3iIUy2c7yCPSNBF04WhZZ52aGGjEP\n5WvGYKThxuDsKRU/k3Ouk8DxHpcbUf7P+uBLx2llP8ZJCefkKxpeJ6yr9NT8senn\nO3DT+tmj2RB5njtI8flroQZXxUVCJTxh0gD4tVBGb+IPC4uHdBbxowxjpaDAFDAv\nMPEfoqs1RJcqst7jGlyEarQt9sTIriGGzIe/meoR3yj8uKghctlBvmwcxzXBZM4=\n=a1nZ\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 3af4207bb30bc51f3720deaa4abe3ac770bbcd35\nparent c6f2459cc46c705e0ac26188c4b49565d3c1b908\nauthor Bianca Nenciu <nbianca@users.noreply.github.com> 1625730381 +0300\ncommitter GitHub <noreply@github.com> 1625730381 +0300\n\nFEATURE: Let users select flair (#13587)\n\nUser flair was given by user's primary group. This PR separates the\r\ntwo, adds a new field to the user model for flair group ID and users\r\ncan select their flair from user preferences now."
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
  "html_url": "https://github.com/discourse/discourse/commit/87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/comments",
  "author": {
    "login": "nbianca",
    "id": 23153890,
    "node_id": "MDQ6VXNlcjIzMTUzODkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/23153890?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nbianca",
    "html_url": "https://github.com/nbianca",
    "followers_url": "https://api.github.com/users/nbianca/followers",
    "following_url": "https://api.github.com/users/nbianca/following{/other_user}",
    "gists_url": "https://api.github.com/users/nbianca/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nbianca/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nbianca/subscriptions",
    "organizations_url": "https://api.github.com/users/nbianca/orgs",
    "repos_url": "https://api.github.com/users/nbianca/repos",
    "events_url": "https://api.github.com/users/nbianca/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nbianca/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c6f2459cc46c705e0ac26188c4b49565d3c1b908",
      "url": "https://api.github.com/repos/discourse/discourse/commits/c6f2459cc46c705e0ac26188c4b49565d3c1b908",
      "html_url": "https://github.com/discourse/discourse/commit/c6f2459cc46c705e0ac26188c4b49565d3c1b908"
    }
  ],
  "stats": {
    "total": 951,
    "additions": 625,
    "deletions": 326
  },
  "files": [
    {
      "sha": "dbc3020f278c7e91ee72a2f964bc71592b896ae1",
      "filename": "app/assets/javascripts/discourse/app/components/avatar-flair.js",
      "status": "modified",
      "additions": 5,
      "deletions": 5,
      "changes": 10,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/components/avatar-flair.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/components/avatar-flair.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/components/avatar-flair.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -4,17 +4,17 @@ import { observes } from \"discourse-common/utils/decorators\";\n export default MountWidget.extend({\n   widget: \"avatar-flair\",\n \n-  @observes(\"flairURL\", \"flairBgColor\", \"flairColor\")\n+  @observes(\"flairName\", \"flairUrl\", \"flairBgColor\", \"flairColor\")\n   _rerender() {\n     this.queueRerender();\n   },\n \n   buildArgs() {\n     return {\n-      primary_group_flair_url: this.flairURL,\n-      primary_group_flair_bg_color: this.flairBgColor,\n-      primary_group_flair_color: this.flairColor,\n-      primary_group_name: this.groupName,\n+      flair_name: this.flairName,\n+      flair_url: this.flairUrl,\n+      flair_bg_color: this.flairBgColor,\n+      flair_color: this.flairColor,\n     };\n   },\n });"
    },
    {
      "sha": "b6a9cbaec04b21981cd5b35e49ff98f8db652b8a",
      "filename": "app/assets/javascripts/discourse/app/components/group-flair-inputs.js",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/components/group-flair-inputs.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/components/group-flair-inputs.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/components/group-flair-inputs.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -67,8 +67,8 @@ export default Component.extend({\n   },\n \n   @discourseComputed(\"model.flair_url\")\n-  flairImageUrl(flairURL) {\n-    return flairURL && flairURL.match(/\\//) ? flairURL : null;\n+  flairImageUrl(flairUrl) {\n+    return flairUrl && flairUrl.includes(\"/\") ? flairUrl : null;\n   },\n \n   @discourseComputed(\n@@ -78,15 +78,15 @@ export default Component.extend({\n     \"model.flairHexColor\"\n   )\n   flairPreviewStyle(\n-    flairURL,\n+    flairUrl,\n     flairPreviewImage,\n     flairBackgroundHexColor,\n     flairHexColor\n   ) {\n     let style = \"\";\n \n     if (flairPreviewImage) {\n-      style += `background-image: url(${escapeExpression(flairURL)});`;\n+      style += `background-image: url(${escapeExpression(flairUrl)});`;\n     }\n \n     if (flairBackgroundHexColor) {"
    },
    {
      "sha": "079de8821651fdd654914ed86800fcd5dc53d8eb",
      "filename": "app/assets/javascripts/discourse/app/components/user-avatar-flair.js",
      "status": "modified",
      "additions": 9,
      "deletions": 14,
      "changes": 23,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/components/user-avatar-flair.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/components/user-avatar-flair.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/components/user-avatar-flair.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -10,28 +10,23 @@ export default Component.extend({\n     if (!user) {\n       return;\n     }\n-    return this.primaryGroupFlair(user) || this.automaticGroupFlair(user);\n-  },\n \n-  primaryGroupFlair(user) {\n-    if (user.primary_group_flair_url || user.primary_group_flair_bg_color) {\n+    if (user.flair_url || user.flair_bg_color) {\n       return {\n-        flairURL: user.primary_group_flair_url,\n-        flairBgColor: user.primary_group_flair_bg_color,\n-        flairColor: user.primary_group_flair_color,\n-        groupName: user.primary_group_name,\n+        flairName: user.flair_name,\n+        flairUrl: user.flair_url,\n+        flairBgColor: user.flair_bg_color,\n+        flairColor: user.flair_color,\n       };\n     }\n-  },\n \n-  automaticGroupFlair(user) {\n     const autoFlairAttrs = autoGroupFlairForUser(this.site, user);\n     if (autoFlairAttrs) {\n       return {\n-        flairURL: autoFlairAttrs.primary_group_flair_url,\n-        flairBgColor: autoFlairAttrs.primary_group_flair_bg_color,\n-        flairColor: autoFlairAttrs.primary_group_flair_color,\n-        groupName: autoFlairAttrs.primary_group_name,\n+        flairName: autoFlairAttrs.flair_name,\n+        flairUrl: autoFlairAttrs.flair_url,\n+        flairBgColor: autoFlairAttrs.flair_bg_color,\n+        flairColor: autoFlairAttrs.flair_color,\n       };\n     }\n   },"
    },
    {
      "sha": "416bf58a76ab204921a043d82d8a8a26dcadc54b",
      "filename": "app/assets/javascripts/discourse/app/controllers/group.js",
      "status": "modified",
      "additions": 0,
      "deletions": 15,
      "changes": 15,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/controllers/group.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/controllers/group.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/controllers/group.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -101,21 +101,6 @@ export default Controller.extend({\n     return (fullName || displayName).capitalize();\n   },\n \n-  @discourseComputed(\n-    \"model.name\",\n-    \"model.flair_url\",\n-    \"model.flair_bg_color\",\n-    \"model.flair_color\"\n-  )\n-  avatarFlairAttributes(groupName, flairURL, flairBgColor, flairColor) {\n-    return {\n-      primary_group_flair_url: flairURL,\n-      primary_group_flair_bg_color: flairBgColor,\n-      primary_group_flair_color: flairColor,\n-      primary_group_name: groupName,\n-    };\n-  },\n-\n   @discourseComputed(\"model.messageable\")\n   displayGroupMessageButton(messageable) {\n     return this.currentUser && messageable;"
    },
    {
      "sha": "c474ed14429af2747aa4683ee28712ff45f96a45",
      "filename": "app/assets/javascripts/discourse/app/controllers/preferences/account.js",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/controllers/preferences/account.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/controllers/preferences/account.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/controllers/preferences/account.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -15,7 +15,12 @@ export default Controller.extend(CanCheckEmails, {\n   init() {\n     this._super(...arguments);\n \n-    this.saveAttrNames = [\"name\", \"title\", \"primary_group_id\"];\n+    this.saveAttrNames = [\n+      \"name\",\n+      \"title\",\n+      \"primary_group_id\",\n+      \"flair_group_id\",\n+    ];\n     this.set(\"revoking\", {});\n   },\n \n@@ -45,6 +50,7 @@ export default Controller.extend(CanCheckEmails, {\n   },\n \n   canSelectTitle: gt(\"model.availableTitles.length\", 0),\n+  canSelectFlair: gt(\"model.availableFlairs.length\", 0),\n \n   @discourseComputed(\"model.filteredGroups\")\n   canSelectPrimaryGroup(primaryGroupOptions) {\n@@ -132,6 +138,7 @@ export default Controller.extend(CanCheckEmails, {\n         name: this.newNameInput,\n         title: this.newTitleInput,\n         primary_group_id: this.newPrimaryGroupInput,\n+        flair_group_id: this.newFlairGroupId,\n       });\n \n       return this.model"
    },
    {
      "sha": "ead1eafa36529f9dcf282e5623ed9b87c5fcde6c",
      "filename": "app/assets/javascripts/discourse/app/lib/avatar-flair.js",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/lib/avatar-flair.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/lib/avatar-flair.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/lib/avatar-flair.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -56,10 +56,10 @@ function initializeAutoGroupFlair(site) {\n     if (group && group.flair_url) {\n       _noAutoFlair = false;\n       _autoGroupFlair[groupName] = {\n-        primary_group_flair_url: group.flair_url,\n-        primary_group_flair_bg_color: group.flair_bg_color,\n-        primary_group_flair_color: group.flair_color,\n-        primary_group_name: group.name.replace(/_/g, \" \"),\n+        flair_name: group.name.replace(/_/g, \" \"),\n+        flair_url: group.flair_url,\n+        flair_bg_color: group.flair_bg_color,\n+        flair_color: group.flair_color,\n       };\n     }\n   });"
    },
    {
      "sha": "b9695b51fed1beb98dd6862068da1af1a91622d8",
      "filename": "app/assets/javascripts/discourse/app/lib/transform-post.js",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/lib/transform-post.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/lib/transform-post.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/lib/transform-post.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -21,9 +21,10 @@ export function transformBasicPost(post) {\n     deletedByAvatarTemplate: null,\n     deletedByUsername: null,\n     primary_group_name: post.primary_group_name,\n-    primary_group_flair_url: post.primary_group_flair_url,\n-    primary_group_flair_bg_color: post.primary_group_flair_bg_color,\n-    primary_group_flair_color: post.primary_group_flair_color,\n+    flair_name: post.flair_name,\n+    flair_url: post.flair_url,\n+    flair_bg_color: post.flair_bg_color,\n+    flair_color: post.flair_color,\n     wiki: post.wiki,\n     lastWikiEdit: post.last_wiki_edit,\n     firstPost: post.post_number === 1,"
    },
    {
      "sha": "4b2b4e905f691784a059eea6280e35774fab9f98",
      "filename": "app/assets/javascripts/discourse/app/models/user.js",
      "status": "modified",
      "additions": 23,
      "deletions": 1,
      "changes": 24,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/models/user.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/models/user.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/models/user.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -59,6 +59,7 @@ let userFields = [\n   \"watching_first_post_tags\",\n   \"date_of_birth\",\n   \"primary_group_id\",\n+  \"flair_group_id\",\n   \"user_notification_schedule\",\n ];\n \n@@ -863,7 +864,7 @@ const User = RestModel.extend({\n \n   @discourseComputed(\"groups.@each.title\", \"badges.[]\")\n   availableTitles() {\n-    let titles = [];\n+    const titles = [];\n \n     (this.groups || []).forEach((group) => {\n       if (get(group, \"title\")) {\n@@ -888,6 +889,27 @@ const User = RestModel.extend({\n       });\n   },\n \n+  @discourseComputed(\"groups.[]\")\n+  availableFlairs() {\n+    const flairs = [];\n+\n+    if (this.groups) {\n+      this.groups.forEach((group) => {\n+        if (group.flair_url) {\n+          flairs.push({\n+            id: group.id,\n+            name: group.name,\n+            url: group.flair_url,\n+            bgColor: group.flair_bg_color,\n+            color: group.flair_color,\n+          });\n+        }\n+      });\n+    }\n+\n+    return flairs;\n+  },\n+\n   @discourseComputed(\"user_option.text_size_seq\", \"user_option.text_size\")\n   currentTextSize(serverSeq, serverSize) {\n     if (cookie(\"text_size\")) {"
    },
    {
      "sha": "47bcae2b8282ac913252a9538a0130f986414130",
      "filename": "app/assets/javascripts/discourse/app/routes/preferences-account.js",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/routes/preferences-account.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/routes/preferences-account.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/routes/preferences-account.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -29,6 +29,7 @@ export default RestrictedUserRoute.extend({\n       newNameInput: user.get(\"name\"),\n       newTitleInput: user.get(\"title\"),\n       newPrimaryGroupInput: user.get(\"primary_group_id\"),\n+      newFlairGroupId: user.get(\"flair_group_id\"),\n     });\n   },\n "
    },
    {
      "sha": "3527dac61e416d36cbc68f8c8d82ec8733099f0f",
      "filename": "app/assets/javascripts/discourse/app/templates/components/group-card-contents.hbs",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/components/group-card-contents.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/components/group-card-contents.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/components/group-card-contents.hbs?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -4,10 +4,10 @@\n       <div class=\"group-card-avatar\">\n         <a href={{groupPath}} {{action \"showGroup\" group}} class=\"card-huge-avatar\">\n           {{avatar-flair\n-            flairURL=group.flair_url\n+            flairName=group.name\n+            flairUrl=group.flair_url\n             flairBgColor=group.flair_bg_color\n             flairColor=group.flair_color\n-            groupName=group.name\n           }}\n         </a>\n       </div>"
    },
    {
      "sha": "cf88fa5804031e7fd01d52e7e953e1f27c511c2f",
      "filename": "app/assets/javascripts/discourse/app/templates/components/user-avatar-flair.hbs",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/components/user-avatar-flair.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/components/user-avatar-flair.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/components/user-avatar-flair.hbs?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -1,7 +1,8 @@\n {{#if flair}}\n   {{avatar-flair\n-    flairURL=flair.flairURL\n+    flairName=flair.flairName\n+    flairUrl=flair.flairUrl\n     flairBgColor=flair.flairBgColor\n     flairColor=flair.flairColor\n-    groupName=flair.groupName}}\n+  }}\n {{/if}}"
    },
    {
      "sha": "b3a03b7b451dcd290fd3c9ac3e9c1118705d78c0",
      "filename": "app/assets/javascripts/discourse/app/templates/group.hbs",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/group.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/group.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/group.hbs?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -12,10 +12,10 @@\n       {{#if model.flair_url}}\n         <div class=\"group-avatar-flair\">\n           {{avatar-flair\n-            flairURL=model.flair_url\n+            flairName=model.name\n+            flairUrl=model.flair_url\n             flairBgColor=model.flair_bg_color\n             flairColor=model.flair_color\n-            groupName=model.name\n           }}\n         </div>\n       {{/if}}"
    },
    {
      "sha": "6396cf57b1b457d0496d725dd7a731fb66eeeebb",
      "filename": "app/assets/javascripts/discourse/app/templates/groups/index.hbs",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/groups/index.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/groups/index.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/groups/index.hbs?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -44,10 +44,11 @@\n                     {{#if group.flair_url}}\n                       <span class=\"group-avatar-flair\">\n                         {{avatar-flair\n-                            flairURL=group.flair_url\n-                            flairBgColor=group.flair_bg_color\n-                            flairColor=group.flair_color\n-                            groupName=group.name}}\n+                          flairName=group.name\n+                          flairUrl=group.flair_url\n+                          flairBgColor=group.flair_bg_color\n+                          flairColor=group.flair_color\n+                        }}\n                       </span>\n                     {{/if}}\n "
    },
    {
      "sha": "3e203fadcdbc1b57bf7807523d25191404f9e4d2",
      "filename": "app/assets/javascripts/discourse/app/templates/preferences/account.hbs",
      "status": "modified",
      "additions": 20,
      "deletions": 0,
      "changes": 20,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/preferences/account.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/templates/preferences/account.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/templates/preferences/account.hbs?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -158,6 +158,26 @@\n         onChange=(action (mut newTitleInput))\n       }}\n     </div>\n+    <div class=\"instructions\">\n+      {{i18n \"user.title.instructions\"}}\n+    </div>\n+  </div>\n+{{/if}}\n+\n+{{#if canSelectFlair}}\n+  <div class=\"control-group pref-flair\">\n+    <label class=\"control-label\">{{i18n \"user.flair.title\"}}</label>\n+    <div class=\"controls\">\n+      {{flair-chooser\n+        value=newFlairGroupId\n+        content=model.availableFlairs\n+        none=\"user.flair.none\"\n+        onChange=(action (mut newFlairGroupId))\n+      }}\n+    </div>\n+    <div class=\"instructions\">\n+      {{i18n \"user.flair.instructions\"}}\n+    </div>\n   </div>\n {{/if}}\n "
    },
    {
      "sha": "ae1d0d4d101d2dce63399601de40905294d06586",
      "filename": "app/assets/javascripts/discourse/app/widgets/avatar-flair.js",
      "status": "modified",
      "additions": 11,
      "deletions": 19,
      "changes": 30,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/widgets/avatar-flair.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/widgets/avatar-flair.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/widgets/avatar-flair.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -6,19 +6,16 @@ createWidget(\"avatar-flair\", {\n   tagName: \"div.avatar-flair\",\n \n   isIcon(attrs) {\n-    return (\n-      attrs.primary_group_flair_url &&\n-      !attrs.primary_group_flair_url.includes(\"/\")\n-    );\n+    return attrs.flair_url && !attrs.flair_url.includes(\"/\");\n   },\n \n   title(attrs) {\n-    return attrs.primary_group_name;\n+    return attrs.flair_name;\n   },\n \n   buildClasses(attrs) {\n-    let defaultClass = `avatar-flair-${attrs.primary_group_name} ${\n-      attrs.primary_group_flair_bg_color ? \"rounded\" : \"\"\n+    let defaultClass = `avatar-flair-${attrs.flair_name} ${\n+      attrs.flair_bg_color ? \"rounded\" : \"\"\n     }`;\n \n     if (!this.isIcon(attrs)) {\n@@ -32,26 +29,21 @@ createWidget(\"avatar-flair\", {\n     let style = \"\";\n     if (!this.isIcon(attrs)) {\n       style +=\n-        \"background-image: url(\" +\n-        escapeExpression(attrs.primary_group_flair_url) +\n-        \"); \";\n+        \"background-image: url(\" + escapeExpression(attrs.flair_url) + \"); \";\n     }\n-    if (attrs.primary_group_flair_bg_color) {\n+    if (attrs.flair_bg_color) {\n       style +=\n-        \"background-color: #\" +\n-        escapeExpression(attrs.primary_group_flair_bg_color) +\n-        \"; \";\n+        \"background-color: #\" + escapeExpression(attrs.flair_bg_color) + \"; \";\n     }\n-    if (attrs.primary_group_flair_color) {\n-      style +=\n-        \"color: #\" + escapeExpression(attrs.primary_group_flair_color) + \"; \";\n+    if (attrs.flair_color) {\n+      style += \"color: #\" + escapeExpression(attrs.flair_color) + \"; \";\n     }\n-    return { style: style };\n+    return { style };\n   },\n \n   html(attrs) {\n     if (this.isIcon(attrs)) {\n-      const icon = convertIconClass(attrs.primary_group_flair_url);\n+      const icon = convertIconClass(attrs.flair_url);\n       return [iconNode(icon)];\n     } else {\n       return [];"
    },
    {
      "sha": "1021ecf76cd4e4e913c60aee16535a54db5d6c98",
      "filename": "app/assets/javascripts/discourse/app/widgets/post.js",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/widgets/post.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/widgets/post.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/widgets/post.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -187,7 +187,7 @@ createWidget(\"post-avatar\", {\n \n     const result = [body];\n \n-    if (attrs.primary_group_flair_url || attrs.primary_group_flair_bg_color) {\n+    if (attrs.flair_url || attrs.flair_bg_color) {\n       result.push(this.attach(\"avatar-flair\", attrs));\n     } else {\n       const autoFlairAttrs = autoGroupFlairForUser(this.site, attrs);"
    },
    {
      "sha": "3a5885d9479cfac813646c89d3350b42a5988514",
      "filename": "app/assets/javascripts/discourse/app/widgets/search-menu-results.js",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/widgets/search-menu-results.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/widgets/search-menu-results.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/widgets/search-menu-results.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -102,10 +102,10 @@ createSearchResult({\n     let avatarFlair;\n     if (group.flairUrl) {\n       avatarFlair = this.attach(\"avatar-flair\", {\n-        primary_group_flair_url: group.flairUrl,\n-        primary_group_flair_bg_color: group.flairBgColor,\n-        primary_group_flair_color: group.flairColor,\n-        primary_group_name: name,\n+        flair_name: name,\n+        flair_url: group.flairUrl,\n+        flair_bg_color: group.flairBgColor,\n+        flair_color: group.flairColor,\n       });\n     } else {\n       avatarFlair = iconNode(\"users\");"
    },
    {
      "sha": "9ecb167fc23c80c47802ceb919b6efbeb65b4b8a",
      "filename": "app/assets/javascripts/discourse/app/widgets/topic-map.js",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/widgets/topic-map.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/app/widgets/topic-map.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/widgets/topic-map.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -79,7 +79,7 @@ createWidget(\"topic-participant\", {\n       linkContents.push(h(\"span.post-count\", attrs.post_count.toString()));\n     }\n \n-    if (attrs.primary_group_flair_url || attrs.primary_group_flair_bg_color) {\n+    if (attrs.flair_url || attrs.flair_bg_color) {\n       linkContents.push(this.attach(\"avatar-flair\", attrs));\n     } else {\n       const autoFlairAttrs = autoGroupFlairForUser(this.site, attrs);"
    },
    {
      "sha": "e1c33f7a07874db09595a0fcec0658145282370a",
      "filename": "app/assets/javascripts/discourse/tests/fixtures/poll.js",
      "status": "modified",
      "additions": 8,
      "deletions": 6,
      "changes": 14,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/fixtures/poll.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/fixtures/poll.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/tests/fixtures/poll.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -571,9 +571,10 @@ export default {\n           topic_slug: \"14-the-title-must-be-longer-i-guess\",\n           display_username: \"\",\n           primary_group_name: \"Team\",\n-          primary_group_flair_url: null,\n-          primary_group_flair_bg_color: \"\",\n-          primary_group_flair_color: \"\",\n+          flair_name: null,\n+          flair_url: null,\n+          flair_bg_color: \"\",\n+          flair_color: \"\",\n           version: 1,\n           can_edit: false,\n           can_delete: false,\n@@ -711,9 +712,10 @@ export default {\n           avatar_template: \"/user_avatar/localhost/markvanlan/{size}/11_2.png\",\n           post_count: 1,\n           primary_group_name: \"Team\",\n-          primary_group_flair_url: null,\n-          primary_group_flair_color: \"\",\n-          primary_group_flair_bg_color: \"\"\n+          flair_name: null,\n+          flair_url: null,\n+          flair_color: \"\",\n+          flair_bg_color: \"\"\n         }\n       ],\n       created_by: {"
    },
    {
      "sha": "d8252dc786ca7fccc9b0200dea44de50f79b28e5",
      "filename": "app/assets/javascripts/discourse/tests/fixtures/post.js",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/fixtures/post.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/fixtures/post.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/tests/fixtures/post.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -21,9 +21,10 @@ export default {\n     topic_slug: \"test-pm\",\n     display_username: null,\n     primary_group_name: null,\n-    primary_group_flair_url: null,\n-    primary_group_flair_bg_color: null,\n-    primary_group_flair_color: null,\n+    flair_name: null,\n+    flair_url: null,\n+    flair_bg_color: null,\n+    flair_color: null,\n     version: 1,\n     can_edit: true,\n     can_delete: false,"
    },
    {
      "sha": "cf9740bba8675c921f1bc68ec6d40e0f631089ad",
      "filename": "app/assets/javascripts/discourse/tests/fixtures/topic.js",
      "status": "modified",
      "additions": 57,
      "deletions": 42,
      "changes": 99,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/fixtures/topic.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/fixtures/topic.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/tests/fixtures/topic.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -27,9 +27,10 @@ export default {\n           topic_slug: \"lorem-ipsum-dolor-sit-amet\",\n           display_username: null,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_bg_color: null,\n-          primary_group_flair_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_bg_color: null,\n+          flair_color: null,\n           version: 1,\n           can_edit: true,\n           can_delete: false,\n@@ -167,9 +168,10 @@ export default {\n           avatar_template: \"/letter_avatar_proxy/v4/letter/b/3be4f8/{size}.png\",\n           post_count: 1,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_color: null,\n-          primary_group_flair_bg_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_color: null,\n+          flair_bg_color: null,\n         },\n       ],\n       allowed_users: [\n@@ -207,6 +209,7 @@ export default {\n           grant_trust_level: null,\n           incoming_email: null,\n           has_messages: true,\n+          flair_name: null,\n           flair_url: null,\n           flair_bg_color: \"\",\n           flair_color: \"\",\n@@ -4217,9 +4220,10 @@ export default {\n           topic_slug: \"pm-for-testing\",\n           display_username: null,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_bg_color: null,\n-          primary_group_flair_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_bg_color: null,\n+          flair_color: null,\n           version: 1,\n           can_edit: true,\n           can_delete: false,\n@@ -4269,9 +4273,10 @@ export default {\n           topic_slug: \"pm-for-testing\",\n           display_username: null,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_bg_color: null,\n-          primary_group_flair_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_bg_color: null,\n+          flair_color: null,\n           version: 1,\n           can_edit: true,\n           can_delete: true,\n@@ -4363,6 +4368,7 @@ export default {\n           grant_trust_level: null,\n           incoming_email: null,\n           has_messages: false,\n+          flair_name: null,\n           flair_url: null,\n           flair_bg_color: null,\n           flair_color: null,\n@@ -4384,9 +4390,10 @@ export default {\n           avatar_template: \"/images/avatar.png\",\n           post_count: 2,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_color: null,\n-          primary_group_flair_bg_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_color: null,\n+          flair_bg_color: null,\n         },\n       ],\n       suggested_topics: [\n@@ -5064,9 +5071,10 @@ export default {\n           topic_slug: \"test-pm\",\n           display_username: null,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_bg_color: null,\n-          primary_group_flair_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_bg_color: null,\n+          flair_color: null,\n           version: 1,\n           can_edit: true,\n           can_delete: false,\n@@ -5126,9 +5134,10 @@ export default {\n           topic_slug: \"test-pm\",\n           display_username: \"Tim Lange\",\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_bg_color: null,\n-          primary_group_flair_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_bg_color: null,\n+          flair_color: null,\n           version: 1,\n           can_edit: true,\n           can_delete: true,\n@@ -5237,9 +5246,10 @@ export default {\n           avatar_template: \"/images/avatar.png\",\n           post_count: 2,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_color: null,\n-          primary_group_flair_bg_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_color: null,\n+          flair_bg_color: null,\n         },\n         {\n           id: 2,\n@@ -5248,9 +5258,10 @@ export default {\n           avatar_template: \"/images/avatar.png\",\n           post_count: 1,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_color: null,\n-          primary_group_flair_bg_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_color: null,\n+          flair_bg_color: null,\n         },\n       ],\n       notification_level: 3,\n@@ -5317,9 +5328,10 @@ export default {\n           topic_slug: \"a-topic-with-group-category-moderators\",\n           display_username: \"\",\n           primary_group_name: \"group_moderators\",\n-          primary_group_flair_url: \"cheese\",\n-          primary_group_flair_bg_color: \"ff0\",\n-          primary_group_flair_color: \"\",\n+          flair_name: \"group_moderators\",\n+          flair_url: \"cheese\",\n+          flair_bg_color: \"ff0\",\n+          flair_color: \"\",\n           version: 1,\n           can_edit: true,\n           can_delete: false,\n@@ -5385,9 +5397,10 @@ export default {\n           topic_slug: \"a-topic-with-group-category-moderators\",\n           display_username: \"\",\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_bg_color: null,\n-          primary_group_flair_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_bg_color: null,\n+          flair_color: null,\n           version: 1,\n           can_edit: false,\n           can_delete: false,\n@@ -5459,9 +5472,9 @@ export default {\n           topic_slug: \"a-topic-with-group-category-moderators\",\n           display_username: \"\",\n           primary_group_name: \"group_moderators\",\n-          primary_group_flair_url: \"cheese\",\n-          primary_group_flair_bg_color: \"ff0\",\n-          primary_group_flair_color: \"\",\n+          flair_url: \"cheese\",\n+          flair_bg_color: \"ff0\",\n+          flair_color: \"\",\n           version: 1,\n           can_edit: true,\n           can_delete: true,\n@@ -5596,9 +5609,10 @@ export default {\n           avatar_template: \"/images/avatar.png\",\n           post_count: 2,\n           primary_group_name: \"group_moderators\",\n-          primary_group_flair_url: \"cheese\",\n-          primary_group_flair_color: \"\",\n-          primary_group_flair_bg_color: \"ff0\",\n+          flar_name: \"group_moderators\",\n+          flair_url: \"cheese\",\n+          flair_color: \"\",\n+          flair_bg_color: \"ff0\",\n         },\n         {\n           id: 2,\n@@ -5607,9 +5621,10 @@ export default {\n           avatar_template: \"/images/avatar.png\",\n           post_count: 1,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_color: null,\n-          primary_group_flair_bg_color: null,\n+          flair_name: null,\n+          flair_url: null,\n+          flair_color: null,\n+          flair_bg_color: null,\n         },\n       ],\n       created_by: {"
    },
    {
      "sha": "e1b428f0db87ab98f6b0e433d87352b77bc754f8",
      "filename": "app/assets/javascripts/discourse/tests/fixtures/user-fixtures.js",
      "status": "modified",
      "additions": 12,
      "deletions": 9,
      "changes": 21,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/fixtures/user-fixtures.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/fixtures/user-fixtures.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/tests/fixtures/user-fixtures.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -2508,9 +2508,10 @@ export default {\n       time_read: 0,\n       recent_time_read: 0,\n       primary_group_name: null,\n-      primary_group_flair_url: null,\n-      primary_group_flair_bg_color: null,\n-      primary_group_flair_color: null,\n+      flair_name: null,\n+      flair_url: null,\n+      flair_bg_color: null,\n+      flair_color: null,\n       staged: false,\n       second_factor_enabled: false,\n       post_count: 0,\n@@ -2755,9 +2756,10 @@ export default {\n       time_read: 0,\n       recent_time_read: 0,\n       primary_group_name: null,\n-      primary_group_flair_url: null,\n-      primary_group_flair_bg_color: null,\n-      primary_group_flair_color: null,\n+      flair_name: null,\n+      flair_url: null,\n+      flair_bg_color: null,\n+      flair_color: null,\n       staged: false,\n       featured_user_badge_ids: [17],\n     },\n@@ -2870,9 +2872,10 @@ export default {\n       time_read: 0,\n       recent_time_read: 0,\n       primary_group_name: null,\n-      primary_group_flair_url: null,\n-      primary_group_flair_bg_color: null,\n-      primary_group_flair_color: null,\n+      flair_name: null,\n+      flair_url: null,\n+      flair_bg_color: null,\n+      flair_color: null,\n       second_factor_enabled: false,\n       second_factor_backup_enabled: false,\n       associated_accounts: [],"
    },
    {
      "sha": "d9ecf2f03973f8bea03fecf0d1744f53919c47ee",
      "filename": "app/assets/javascripts/discourse/tests/integration/components/user-avatar-flair-test.js",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/integration/components/user-avatar-flair-test.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/integration/components/user-avatar-flair-test.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/tests/integration/components/user-avatar-flair-test.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -175,9 +175,10 @@ discourseModule(\n           admin: false,\n           moderator: false,\n           trust_level: 3,\n-          primary_group_flair_url: \"fa-times\",\n-          primary_group_flair_bg_color: \"123456\",\n-          primary_group_flair_color: \"B0B0B0\",\n+          flair_name: \"Band Geeks\",\n+          flair_url: \"fa-times\",\n+          flair_bg_color: \"123456\",\n+          flair_color: \"B0B0B0\",\n           primary_group_name: \"Band Geeks\",\n         });\n         setupSiteGroups(this);"
    },
    {
      "sha": "022b1e9f2e367315f930ffc94ba0b7b24aa0f01e",
      "filename": "app/assets/javascripts/discourse/tests/integration/widgets/avatar-flair-test.js",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/integration/widgets/avatar-flair-test.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/integration/widgets/avatar-flair-test.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/tests/integration/widgets/avatar-flair-test.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -17,9 +17,9 @@ discourseModule(\n       template: hbs`{{mount-widget widget=\"avatar-flair\" args=args}}`,\n       beforeEach() {\n         this.set(\"args\", {\n-          primary_group_flair_url: \"fa-bars\",\n-          primary_group_flair_bg_color: \"CC0000\",\n-          primary_group_flair_color: \"FFFFFF\",\n+          flair_url: \"fa-bars\",\n+          flair_bg_color: \"CC0000\",\n+          flair_color: \"FFFFFF\",\n         });\n       },\n       test(assert) {\n@@ -37,7 +37,7 @@ discourseModule(\n       template: hbs`{{mount-widget widget=\"avatar-flair\" args=args}}`,\n       beforeEach() {\n         this.set(\"args\", {\n-          primary_group_flair_url: \"/images/avatar.png\",\n+          flair_url: \"/images/avatar.png\",\n         });\n       },\n       test(assert) {"
    },
    {
      "sha": "1c81bed4973b25f609344eab7d51ecc3d19df842",
      "filename": "app/assets/javascripts/discourse/tests/integration/widgets/topic-participant-test.js",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/integration/widgets/topic-participant-test.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/discourse/tests/integration/widgets/topic-participant-test.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/tests/integration/widgets/topic-participant-test.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -39,8 +39,9 @@ discourseModule(\n           avatar_template: \"/images/avatar.png\",\n           post_count: 5,\n           primary_group_name: \"devs\",\n-          primary_group_flair_url: \"/images/d-logo-sketch-small.png\",\n-          primary_group_flair_bg_color: \"222\",\n+          flair_name: \"devs\",\n+          flair_url: \"/images/d-logo-sketch-small.png\",\n+          flair_bg_color: \"222\",\n         });\n       },\n "
    },
    {
      "sha": "96e912e0959791f6c3b9635dc86ecf13d9c70185",
      "filename": "app/assets/javascripts/select-kit/addon/components/flair-chooser.js",
      "status": "added",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/select-kit/addon/components/flair-chooser.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/select-kit/addon/components/flair-chooser.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/select-kit/addon/components/flair-chooser.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -0,0 +1,14 @@\n+import ComboBoxComponent from \"select-kit/components/combo-box\";\n+\n+export default ComboBoxComponent.extend({\n+  pluginApiIdentifiers: [\"flair-chooser\"],\n+  classNames: [\"flair-chooser\"],\n+\n+  selectKitOptions: {\n+    selectedNameComponent: \"selected-flair\",\n+  },\n+\n+  modifyComponentForRow() {\n+    return \"flair-row\";\n+  },\n+});"
    },
    {
      "sha": "6edbf8cab2b0678f0b87a5eaf54ad4e329313492",
      "filename": "app/assets/javascripts/select-kit/addon/components/flair-row.js",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/select-kit/addon/components/flair-row.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/select-kit/addon/components/flair-row.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/select-kit/addon/components/flair-row.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -0,0 +1,7 @@\n+import SelectKitRowComponent from \"select-kit/components/select-kit/select-kit-row\";\n+import layout from \"select-kit/templates/components/flair-row\";\n+\n+export default SelectKitRowComponent.extend({\n+  layout,\n+  classNames: [\"flair-row\"],\n+});"
    },
    {
      "sha": "b4ddf9ac3a4b0e1904ec6b11b6ebf6cfb8b03efc",
      "filename": "app/assets/javascripts/select-kit/addon/components/selected-flair.js",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/select-kit/addon/components/selected-flair.js",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/select-kit/addon/components/selected-flair.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/select-kit/addon/components/selected-flair.js?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -0,0 +1,7 @@\n+import SelectedNameComponent from \"select-kit/components/selected-name\";\n+import layout from \"select-kit/templates/components/flair-row\";\n+\n+export default SelectedNameComponent.extend({\n+  layout,\n+  tagName: \"\",\n+});"
    },
    {
      "sha": "f4bdb2aa30bd4839da2f108f41b739315b0ff10f",
      "filename": "app/assets/javascripts/select-kit/addon/templates/components/flair-row.hbs",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/select-kit/addon/templates/components/flair-row.hbs",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/javascripts/select-kit/addon/templates/components/flair-row.hbs",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/select-kit/addon/templates/components/flair-row.hbs?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -0,0 +1,10 @@\n+{{#if item.url}}\n+  {{avatar-flair\n+    flairName=item.name\n+    flairUrl=item.url\n+    flairBgColor=item.bgColor\n+    flairColor=item.color\n+  }}\n+{{/if}}\n+\n+<span>{{label}}</span>"
    },
    {
      "sha": "2aabed537465ed1f7a1ecccd205d6ea47c8adbd5",
      "filename": "app/assets/stylesheets/common/select-kit/_index.scss",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/stylesheets/common/select-kit/_index.scss",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/stylesheets/common/select-kit/_index.scss",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/stylesheets/common/select-kit/_index.scss?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -8,6 +8,7 @@\n @import \"composer-actions\";\n @import \"dropdown-select-box\";\n @import \"email-group-user-chooser\";\n+@import \"flair-row\";\n @import \"future-date-input-selector\";\n @import \"icon-picker\";\n @import \"list-setting\";"
    },
    {
      "sha": "d6ecec579c2767aa8c71ffa88b63eeff448df2dd",
      "filename": "app/assets/stylesheets/common/select-kit/flair-row.scss",
      "status": "added",
      "additions": 29,
      "deletions": 0,
      "changes": 29,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/stylesheets/common/select-kit/flair-row.scss",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/assets/stylesheets/common/select-kit/flair-row.scss",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/stylesheets/common/select-kit/flair-row.scss?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -0,0 +1,29 @@\n+.flair-chooser .select-kit-header,\n+.select-kit .flair-row {\n+  .avatar-flair {\n+    align-items: center;\n+    background-position: center;\n+    background-repeat: no-repeat;\n+    background-size: 30px 30px;\n+    display: flex;\n+    justify-content: center;\n+    margin-right: 5px;\n+    height: 30px;\n+    width: 30px;\n+\n+    &.rounded {\n+      background-size: (30px / 1.4) (30px / 1.4);\n+      border-radius: 50%;\n+    }\n+\n+    .d-icon {\n+      display: block;\n+      height: (30px / 1.8);\n+      width: (30px / 1.8);\n+    }\n+  }\n+}\n+\n+.select-kit.flair-chooser .select-kit-header {\n+  padding: 2px 4px;\n+}"
    },
    {
      "sha": "0003cca8539ec3cbf6e540a368f7806ba06920d7",
      "filename": "app/controllers/posts_controller.rb",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/controllers/posts_controller.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/controllers/posts_controller.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/controllers/posts_controller.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -61,7 +61,7 @@ def latest\n         .where('posts.id <= ?', last_post_id)\n         .where('posts.id > ?', last_post_id - 50)\n         .includes(topic: :category)\n-        .includes(user: :primary_group)\n+        .includes(user: [:primary_group, :flair_group])\n         .includes(:reply_to_user)\n         .limit(50)\n       rss_description = I18n.t(\"rss_description.private_posts\")\n@@ -71,7 +71,7 @@ def latest\n         .where('posts.id <= ?', last_post_id)\n         .where('posts.id > ?', last_post_id - 50)\n         .includes(topic: :category)\n-        .includes(user: :primary_group)\n+        .includes(user: [:primary_group, :flair_group])\n         .includes(:reply_to_user)\n         .limit(50)\n       rss_description = I18n.t(\"rss_description.posts\")"
    },
    {
      "sha": "ae67a4cb42d1916fa02505718b1ad2f58276766d",
      "filename": "app/controllers/user_badges_controller.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/controllers/user_badges_controller.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/controllers/user_badges_controller.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/controllers/user_badges_controller.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -10,7 +10,7 @@ def index\n \n     badge = fetch_badge_from_params\n     user_badges = badge.user_badges.order('granted_at DESC, id DESC').limit(MAX_BADGES)\n-    user_badges = user_badges.includes(:user, :granted_by, badge: :badge_type, post: :topic, user: :primary_group)\n+    user_badges = user_badges.includes(:user, :granted_by, badge: :badge_type, post: :topic, user: [:primary_group, :flair_group])\n \n     grant_count = nil\n "
    },
    {
      "sha": "8e77c4909056223ffa46dd2cd3009de2e3850629",
      "filename": "app/controllers/users_controller.rb",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/controllers/users_controller.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/controllers/users_controller.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/controllers/users_controller.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -112,6 +112,7 @@ def cards\n                                               :user_profile,\n                                               :card_background_upload,\n                                               :primary_group,\n+                                              :flair_group,\n                                               :primary_email\n                                             )\n \n@@ -1632,6 +1633,7 @@ def user_params\n       :profile_background_upload_url,\n       :card_background_upload_url,\n       :primary_group_id,\n+      :flair_group_id,\n       :featured_topic_id\n     ]\n "
    },
    {
      "sha": "e21dd42fbeefd22e4d8383ba418485376df3095d",
      "filename": "app/models/topic_posters_summary.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/models/topic_posters_summary.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/models/topic_posters_summary.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/models/topic_posters_summary.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -33,6 +33,7 @@ def new_topic_poster_for(user)\n     topic_poster.user = user\n     topic_poster.description = descriptions_for(user)\n     topic_poster.primary_group = user_lookup.primary_groups[user.id]\n+    topic_poster.flair_group = user_lookup.flair_groups[user.id]\n     if topic.last_post_user_id == user.id\n       topic_poster.extras = +'latest'\n       topic_poster.extras << ' single' if user_ids.uniq.size == 1"
    },
    {
      "sha": "da4dbeda2adcff097d6853d03345aaf17451dc59",
      "filename": "app/models/user.rb",
      "status": "modified",
      "additions": 8,
      "deletions": 2,
      "changes": 10,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/models/user.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/models/user.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/models/user.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -95,6 +95,7 @@ class User < ActiveRecord::Base\n   has_one :card_background_upload, through: :user_profile\n   belongs_to :approved_by, class_name: 'User'\n   belongs_to :primary_group, class_name: 'Group'\n+  belongs_to :flair_group, class_name: 'Group'\n \n   has_many :muted_users, through: :muted_user_records\n   has_many :ignored_users, through: :ignored_user_records\n@@ -133,7 +134,7 @@ class User < ActiveRecord::Base\n \n   before_save :update_usernames\n   before_save :ensure_password_is_hashed\n-  before_save :match_title_to_primary_group_changes\n+  before_save :match_primary_group_changes\n   before_save :check_if_title_is_badged_granted\n \n   after_save :expire_tokens_if_password_changed\n@@ -1619,12 +1620,16 @@ def self.purge_unactivated\n     end\n   end\n \n-  def match_title_to_primary_group_changes\n+  def match_primary_group_changes\n     return unless primary_group_id_changed?\n \n     if title == Group.where(id: primary_group_id_was).pluck_first(:title)\n       self.title = primary_group&.title\n     end\n+\n+    if flair_group_id == primary_group_id_was\n+      self.flair_group_id = primary_group&.id\n+    end\n   end\n \n   private\n@@ -1745,6 +1750,7 @@ def self.ensure_consistency!\n #  group_locked_trust_level  :integer\n #  manual_locked_trust_level :integer\n #  secure_identifier         :string\n+#  flair_group_id            :integer\n #\n # Indexes\n #"
    },
    {
      "sha": "1cd0b0206843f8c98486ff3c10a6490bbd3f2d35",
      "filename": "app/models/user_summary.rb",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/models/user_summary.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/models/user_summary.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/models/user_summary.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -198,9 +198,14 @@ def user_counts(user_hash)\n \n       if lookup_hash.present?\n         primary_group = lookup.primary_groups[user_id]\n+        flair_group = lookup.flair_groups[user_id]\n \n         UserWithCount.new(\n-          lookup_hash.attributes.merge(count: user_hash[user_id], primary_group: primary_group)\n+          lookup_hash.attributes.merge(\n+            count: user_hash[user_id],\n+            primary_group: primary_group,\n+            flair_group: flair_group\n+          )\n         )\n       end\n     end.compact.sort_by { |u| -u[:count] }"
    },
    {
      "sha": "65441ebba476e556d0526bb92358ff24613c7388",
      "filename": "app/serializers/concerns/user_primary_group_mixin.rb",
      "status": "modified",
      "additions": 24,
      "deletions": 15,
      "changes": 39,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/concerns/user_primary_group_mixin.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/concerns/user_primary_group_mixin.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/concerns/user_primary_group_mixin.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -4,9 +4,10 @@ module UserPrimaryGroupMixin\n \n   def self.included(klass)\n     klass.attributes :primary_group_name,\n-                     :primary_group_flair_url,\n-                     :primary_group_flair_bg_color,\n-                     :primary_group_flair_color,\n+                     :flair_name,\n+                     :flair_url,\n+                     :flair_bg_color,\n+                     :flair_color,\n                      :admin,\n                      :moderator,\n                      :trust_level\n@@ -20,28 +21,36 @@ def include_primary_group_name?\n     object&.primary_group.present?\n   end\n \n-  def primary_group_flair_url\n-    object&.primary_group&.flair_url\n+  def flair_name\n+    object&.flair_group&.name\n   end\n \n-  def include_primary_group_flair_url?\n-    object&.primary_group&.flair_url.present?\n+  def include_flair_group_name?\n+    object&.flair_group.present?\n   end\n \n-  def primary_group_flair_bg_color\n-    object&.primary_group&.flair_bg_color\n+  def flair_url\n+    object&.flair_group&.flair_url\n   end\n \n-  def include_primary_group_flair_bg_color?\n-    object&.primary_group&.flair_bg_color.present?\n+  def include_flair_url?\n+    object&.flair_group&.flair_url.present?\n   end\n \n-  def primary_group_flair_color\n-    object&.primary_group&.flair_color\n+  def flair_bg_color\n+    object&.flair_group&.flair_bg_color\n   end\n \n-  def include_primary_group_flair_color?\n-    object&.primary_group&.flair_color.present?\n+  def include_flair_bg_color?\n+    object&.flair_group&.flair_bg_color.present?\n+  end\n+\n+  def flair_color\n+    object&.flair_group&.flair_color\n+  end\n+\n+  def include_flair_color?\n+    object&.flair_group&.flair_color.present?\n   end\n \n   def include_admin?"
    },
    {
      "sha": "dc0637fe236f0ea008e1ff6880df9dbce4ebb1f5",
      "filename": "app/serializers/current_user_serializer.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/current_user_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/current_user_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/current_user_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -48,6 +48,7 @@ class CurrentUserSerializer < BasicUserSerializer\n              :previous_visit_at,\n              :seen_notification_id,\n              :primary_group_id,\n+             :flair_group_id,\n              :can_create_topic,\n              :can_create_group,\n              :link_posting_access,"
    },
    {
      "sha": "45b217ea5d10f9bcfabb7f1f76d4efa33403cc8c",
      "filename": "app/serializers/flair_group_serializer.rb",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/flair_group_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/flair_group_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/flair_group_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -0,0 +1,5 @@\n+# frozen_string_literal: true\n+\n+class FlairGroupSerializer < ApplicationSerializer\n+  attributes :id, :name, :flair_url, :flair_bg_color, :flair_color\n+end"
    },
    {
      "sha": "d585090beda7fab22c2bb7656f6313cb8a6b1a95",
      "filename": "app/serializers/post_serializer.rb",
      "status": "modified",
      "additions": 14,
      "deletions": 9,
      "changes": 23,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/post_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/post_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/post_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -36,9 +36,10 @@ class PostSerializer < BasicPostSerializer\n              :category_id,\n              :display_username,\n              :primary_group_name,\n-             :primary_group_flair_url,\n-             :primary_group_flair_bg_color,\n-             :primary_group_flair_color,\n+             :flair_name,\n+             :flair_url,\n+             :flair_bg_color,\n+             :flair_color,\n              :version,\n              :can_edit,\n              :can_delete,\n@@ -188,16 +189,20 @@ def primary_group_name\n     end\n   end\n \n-  def primary_group_flair_url\n-    object.user&.primary_group&.flair_url\n+  def flair_name\n+    object.user&.flair_group&.name\n   end\n \n-  def primary_group_flair_bg_color\n-    object.user&.primary_group&.flair_bg_color\n+  def flair_url\n+    object.user&.flair_group&.flair_url\n   end\n \n-  def primary_group_flair_color\n-    object.user&.primary_group&.flair_color\n+  def flair_bg_color\n+    object.user&.flair_group&.flair_bg_color\n+  end\n+\n+  def flair_color\n+    object.user&.flair_group&.flair_color\n   end\n \n   def link_counts"
    },
    {
      "sha": "3250056d40c787eb2947ca671893c18c3305d840",
      "filename": "app/serializers/primary_group_serializer.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/primary_group_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/primary_group_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/primary_group_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -1,5 +1,5 @@\n # frozen_string_literal: true\n \n class PrimaryGroupSerializer < ApplicationSerializer\n-  attributes :id, :name, :flair_url, :flair_bg_color, :flair_color\n+  attributes :id, :name\n end"
    },
    {
      "sha": "90f5a89fa49dacdc81b47a12368511d2943d9b9f",
      "filename": "app/serializers/topic_post_count_serializer.rb",
      "status": "modified",
      "additions": 11,
      "deletions": 7,
      "changes": 18,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/topic_post_count_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/topic_post_count_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/topic_post_count_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -3,7 +3,7 @@\n class TopicPostCountSerializer < BasicUserSerializer\n \n   attributes :post_count, :primary_group_name,\n-             :primary_group_flair_url, :primary_group_flair_color, :primary_group_flair_bg_color,\n+             :flair_name, :flair_url, :flair_color, :flair_bg_color,\n              :admin, :moderator, :trust_level,\n \n   def id\n@@ -23,16 +23,20 @@ def primary_group_name\n     object[:user]&.primary_group&.name\n   end\n \n-  def primary_group_flair_url\n-    object[:user]&.primary_group&.flair_url\n+  def flair_name\n+    object[:user]&.flair_group&.name\n   end\n \n-  def primary_group_flair_bg_color\n-    object[:user]&.primary_group&.flair_bg_color\n+  def flair_url\n+    object[:user]&.flair_group&.flair_url\n   end\n \n-  def primary_group_flair_color\n-    object[:user]&.primary_group&.flair_color\n+  def flair_bg_color\n+    object[:user]&.flair_group&.flair_bg_color\n+  end\n+\n+  def flair_color\n+    object[:user]&.flair_group&.flair_color\n   end\n \n   def include_admin?"
    },
    {
      "sha": "3dadd18a4c5fdeb45f397032951eb6ecda83a877",
      "filename": "app/serializers/topic_poster_serializer.rb",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/topic_poster_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/topic_poster_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/topic_poster_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -5,4 +5,5 @@ class TopicPosterSerializer < ApplicationSerializer\n \n   has_one :user, serializer: PosterSerializer\n   has_one :primary_group, serializer: PrimaryGroupSerializer\n+  has_one :flair_group, serializer: FlairGroupSerializer\n end"
    },
    {
      "sha": "617db6a7265d9bc644b017366959c00bb3ebe3b3",
      "filename": "app/serializers/user_card_serializer.rb",
      "status": "modified",
      "additions": 15,
      "deletions": 10,
      "changes": 25,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/user_card_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/user_card_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/user_card_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -59,9 +59,10 @@ def self.untrusted_attributes(*attrs)\n              :recent_time_read,\n              :primary_group_id,\n              :primary_group_name,\n-             :primary_group_flair_url,\n-             :primary_group_flair_bg_color,\n-             :primary_group_flair_color,\n+             :flair_name,\n+             :flair_url,\n+             :flair_bg_color,\n+             :flair_color,\n              :featured_topic,\n              :timezone\n \n@@ -181,19 +182,23 @@ def recent_time_read\n   end\n \n   def primary_group_name\n-    object.primary_group.try(:name)\n+    object.primary_group&.name\n   end\n \n-  def primary_group_flair_url\n-    object.try(:primary_group).try(:flair_url)\n+  def flair_name\n+    object.flair_group&.name\n   end\n \n-  def primary_group_flair_bg_color\n-    object.try(:primary_group).try(:flair_bg_color)\n+  def flair_url\n+    object.flair_group&.flair_url\n   end\n \n-  def primary_group_flair_color\n-    object.try(:primary_group).try(:flair_color)\n+  def flair_bg_color\n+    object.flair_group&.flair_bg_color\n+  end\n+\n+  def flair_color\n+    object.flair_group&.flair_color\n   end\n \n   def featured_topic"
    },
    {
      "sha": "f6e87bb05594901f83a380151b0dff890f8254ed",
      "filename": "app/serializers/user_summary_serializer.rb",
      "status": "modified",
      "additions": 14,
      "deletions": 9,
      "changes": 23,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/user_summary_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/user_summary_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/user_summary_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -29,9 +29,10 @@ class UserWithCountSerializer < ApplicationSerializer\n                :admin,\n                :moderator,\n                :trust_level,\n-               :primary_group_flair_url,\n-               :primary_group_flair_bg_color,\n-               :primary_group_flair_color,\n+               :flair_name,\n+               :flair_url,\n+               :flair_bg_color,\n+               :flair_color,\n                :primary_group_name\n \n     def include_name?\n@@ -42,16 +43,20 @@ def avatar_template\n       User.avatar_template(object[:username], object[:uploaded_avatar_id])\n     end\n \n-    def primary_group_flair_url\n-      object.primary_group&.flair_url\n+    def flair_name\n+      object.flair_group&.name\n     end\n \n-    def primary_group_flair_bg_color\n-      object.primary_group&.flair_bg_color\n+    def flair_url\n+      object.flair_group&.flair_url\n     end\n \n-    def primary_group_flair_color\n-      object.primary_group&.flair_color\n+    def flair_bg_color\n+      object.flair_group&.flair_bg_color\n+    end\n+\n+    def flair_color\n+      object.flair_group&.flair_color\n     end\n \n     def primary_group_name"
    },
    {
      "sha": "da7dd3bbd0a2afdb5d239d5d0eb9a1395a419286",
      "filename": "app/serializers/web_hook_post_serializer.rb",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/web_hook_post_serializer.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/serializers/web_hook_post_serializer.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/serializers/web_hook_post_serializer.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -28,9 +28,9 @@ def include_category_id?\n     actions_summary\n     can_view_edit_history\n     yours\n-    primary_group_flair_url\n-    primary_group_flair_bg_color\n-    primary_group_flair_color\n+    flair_url\n+    flair_bg_color\n+    flair_color\n     notice\n   }.each do |attr|\n     define_method(\"include_#{attr}?\") do"
    },
    {
      "sha": "7635b90fcc84a7a0e36c8a23fc2a3a4aadf5f6cf",
      "filename": "app/services/user_updater.rb",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/services/user_updater.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/app/services/user_updater.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/services/user_updater.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -121,6 +121,13 @@ def update(attributes = {})\n       user.primary_group_id = nil\n     end\n \n+    if attributes[:flair_group_id] &&\n+      attributes[:flair_group_id] != user.flair_group_id &&\n+      guardian.can_use_primary_group?(user, attributes[:flair_group_id])\n+\n+      user.flair_group_id = attributes[:flair_group_id]\n+    end\n+\n     CATEGORY_IDS.each do |attribute, level|\n       if ids = attributes[attribute]\n         CategoryUser.batch_set(user, level, ids)"
    },
    {
      "sha": "f1247f14b00199188b8430d30a37627973f54f63",
      "filename": "config/locales/client.en.yml",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/config/locales/client.en.yml",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/config/locales/client.en.yml",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/config/locales/client.en.yml?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -1646,6 +1646,11 @@ en:\n       title:\n         title: \"Title\"\n         none: \"(none)\"\n+        instructions: \"appears after your username\"\n+      flair:\n+        title: \"Flair\"\n+        none: \"(none)\"\n+        instructions: \"icon displayed next to your profile picture\"\n       primary_group:\n         title: \"Primary Group\"\n         none: \"(none)\""
    },
    {
      "sha": "1261b1d5974f52c423b3bb9139d2aa40b94d24bf",
      "filename": "db/migrate/20210625203049_add_flair_group_id_to_users.rb",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/db/migrate/20210625203049_add_flair_group_id_to_users.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/db/migrate/20210625203049_add_flair_group_id_to_users.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/db/migrate/20210625203049_add_flair_group_id_to_users.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddFlairGroupIdToUsers < ActiveRecord::Migration[6.1]\n+  def change\n+    add_column :users, :flair_group_id, :integer, null: true\n+  end\n+end"
    },
    {
      "sha": "8ea880b4dd2f93613029a6a6748f867834b78d33",
      "filename": "lib/user_lookup.rb",
      "status": "modified",
      "additions": 34,
      "deletions": 16,
      "changes": 50,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/lib/user_lookup.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/lib/user_lookup.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/lib/user_lookup.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -12,13 +12,33 @@ def [](user_id)\n   end\n \n   def primary_groups\n-    @groups ||= group_lookup_hash\n+    @primary_groups ||= begin\n+      hash = {}\n+      users.values.each do |u|\n+        if u.primary_group_id\n+          hash[u.id] = groups[u.primary_group_id]\n+        end\n+      end\n+      hash\n+    end\n+  end\n+\n+  def flair_groups\n+    @flair_groups ||= begin\n+      hash = {}\n+      users.values.each do |u|\n+        if u.flair_group_id\n+          hash[u.id] = groups[u.flair_group_id]\n+        end\n+      end\n+      hash\n+    end\n   end\n \n   private\n \n   def self.lookup_columns\n-    @user_lookup_columns ||= %i{id username name uploaded_avatar_id primary_group_id admin moderator trust_level}\n+    @user_lookup_columns ||= %i{id username name uploaded_avatar_id primary_group_id flair_group_id admin moderator trust_level}\n   end\n \n   def self.group_lookup_columns\n@@ -37,23 +57,21 @@ def user_lookup_hash\n     hash\n   end\n \n-  def group_lookup_hash\n-    users_with_primary_group = users.values.reject { |u| u.primary_group_id.nil? }\n+  def groups\n+    @group_lookup = begin\n+      group_ids = users.values.map { |u| [u.primary_group_id, u.flair_group_id] }\n+      group_ids.flatten!\n+      group_ids.uniq!\n+      group_ids.compact!\n \n-    group_lookup = {}\n-    group_ids = users_with_primary_group.map { |u| u.primary_group_id }\n-    group_ids.uniq!\n+      hash = {}\n \n-    Group.includes(:flair_upload)\n-      .where(id: group_ids)\n-      .select(self.class.group_lookup_columns)\n-      .each { |g| group_lookup[g.id] = g }\n+      Group.includes(:flair_upload)\n+        .where(id: group_ids)\n+        .select(self.class.group_lookup_columns)\n+        .each { |g| hash[g.id] = g }\n \n-    hash = {}\n-    users_with_primary_group.each do |u|\n-      hash[u.id] = group_lookup[u.primary_group_id]\n+      hash\n     end\n-    hash\n   end\n-\n end"
    },
    {
      "sha": "412fdbbe3144207ce7e1b453b5aa252d9bb4c148",
      "filename": "plugins/poll/test/javascripts/acceptance/poll-in-reply-history-test.js.es6",
      "status": "modified",
      "additions": 9,
      "deletions": 9,
      "changes": 18,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/plugins/poll/test/javascripts/acceptance/poll-in-reply-history-test.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/plugins/poll/test/javascripts/acceptance/poll-in-reply-history-test.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/plugins/poll/test/javascripts/acceptance/poll-in-reply-history-test.js.es6?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -38,9 +38,9 @@ acceptance(\"Poll in a post reply history\", function (needs) {\n               topic_slug: \"topic-with-a-poll-in-a-post-reply-history\",\n               display_username: null,\n               primary_group_name: null,\n-              primary_group_flair_url: null,\n-              primary_group_flair_bg_color: null,\n-              primary_group_flair_color: null,\n+              flair_url: null,\n+              flair_bg_color: null,\n+              flair_color: null,\n               version: 1,\n               can_edit: true,\n               can_delete: true,\n@@ -337,9 +337,9 @@ acceptance(\"Poll in a post reply history\", function (needs) {\n                 \"/letter_avatar_proxy/v4/letter/a/bbce88/{size}.png\",\n               post_count: 4,\n               primary_group_name: null,\n-              primary_group_flair_url: null,\n-              primary_group_flair_color: null,\n-              primary_group_flair_bg_color: null,\n+              flair_url: null,\n+              flair_color: null,\n+              flair_bg_color: null,\n             },\n           ],\n           created_by: {\n@@ -385,9 +385,9 @@ acceptance(\"Poll in a post reply history\", function (needs) {\n           topic_slug: \"topic-with-a-poll-in-a-post-reply-history\",\n           display_username: null,\n           primary_group_name: null,\n-          primary_group_flair_url: null,\n-          primary_group_flair_bg_color: null,\n-          primary_group_flair_color: null,\n+          flair_url: null,\n+          flair_bg_color: null,\n+          flair_color: null,\n           version: 1,\n           can_edit: false,\n           can_delete: false,"
    },
    {
      "sha": "8d7e075a5315a529eb45bc1dead10c7539ad91e2",
      "filename": "plugins/poll/test/javascripts/acceptance/poll-quote-test.js.es6",
      "status": "modified",
      "additions": 9,
      "deletions": 9,
      "changes": 18,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/plugins/poll/test/javascripts/acceptance/poll-quote-test.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/plugins/poll/test/javascripts/acceptance/poll-quote-test.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/plugins/poll/test/javascripts/acceptance/poll-quote-test.js.es6?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -35,9 +35,9 @@ acceptance(\"Poll quote\", function (needs) {\n         topic_slug: \"topic-with-two-polls\",\n         display_username: null,\n         primary_group_name: null,\n-        primary_group_flair_url: null,\n-        primary_group_flair_bg_color: null,\n-        primary_group_flair_color: null,\n+        flair_url: null,\n+        flair_bg_color: null,\n+        flair_color: null,\n         version: 1,\n         can_edit: true,\n         can_delete: false,\n@@ -154,9 +154,9 @@ acceptance(\"Poll quote\", function (needs) {\n               topic_slug: \"topic-with-two-quoted-polls\",\n               display_username: null,\n               primary_group_name: null,\n-              primary_group_flair_url: null,\n-              primary_group_flair_bg_color: null,\n-              primary_group_flair_color: null,\n+              flair_url: null,\n+              flair_bg_color: null,\n+              flair_color: null,\n               version: 1,\n               can_edit: true,\n               can_delete: false,\n@@ -399,9 +399,9 @@ acceptance(\"Poll quote\", function (needs) {\n                 \"/letter_avatar_proxy/v4/letter/b/3be4f8/{size}.png\",\n               post_count: 1,\n               primary_group_name: null,\n-              primary_group_flair_url: null,\n-              primary_group_flair_color: null,\n-              primary_group_flair_bg_color: null,\n+              flair_url: null,\n+              flair_color: null,\n+              flair_bg_color: null,\n             },\n           ],\n           created_by: {"
    },
    {
      "sha": "6adb069b3d70c8d70243d6a97a29c3c48b8268d2",
      "filename": "plugins/poll/test/javascripts/acceptance/poll-results-test.js.es6",
      "status": "modified",
      "additions": 9,
      "deletions": 9,
      "changes": 18,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/plugins/poll/test/javascripts/acceptance/poll-results-test.js.es6",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/plugins/poll/test/javascripts/acceptance/poll-results-test.js.es6",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/plugins/poll/test/javascripts/acceptance/poll-results-test.js.es6?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -38,9 +38,9 @@ acceptance(\"Poll results\", function (needs) {\n         topic_slug: \"load-more-poll-voters\",\n         display_username: null,\n         primary_group_name: null,\n-        primary_group_flair_url: null,\n-        primary_group_flair_bg_color: null,\n-        primary_group_flair_color: null,\n+        flair_url: null,\n+        flair_bg_color: null,\n+        flair_color: null,\n         version: 1,\n         can_edit: true,\n         can_delete: false,\n@@ -143,9 +143,9 @@ acceptance(\"Poll results\", function (needs) {\n               topic_slug: \"load-more-poll-voters\",\n               display_username: null,\n               primary_group_name: null,\n-              primary_group_flair_url: null,\n-              primary_group_flair_bg_color: null,\n-              primary_group_flair_color: null,\n+              flair_url: null,\n+              flair_bg_color: null,\n+              flair_color: null,\n               version: 1,\n               can_edit: true,\n               can_delete: false,\n@@ -499,9 +499,9 @@ acceptance(\"Poll results\", function (needs) {\n                 \"/letter_avatar_proxy/v4/letter/b/3be4f8/{size}.png\",\n               post_count: 1,\n               primary_group_name: null,\n-              primary_group_flair_url: null,\n-              primary_group_flair_color: null,\n-              primary_group_flair_bg_color: null,\n+              flair_url: null,\n+              flair_color: null,\n+              flair_bg_color: null,\n               admin: true,\n               trust_level: 0,\n             },"
    },
    {
      "sha": "8c078f316445dca814919054dea4c73a6216d665",
      "filename": "spec/fixtures/onebox/discourse_topic.response",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/fixtures/onebox/discourse_topic.response",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/fixtures/onebox/discourse_topic.response",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/fixtures/onebox/discourse_topic.response?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87"
    },
    {
      "sha": "2412540fbec0898540ab9117772d5b7bb1270700",
      "filename": "spec/fixtures/onebox/discourse_topic_reply.response",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/fixtures/onebox/discourse_topic_reply.response",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/fixtures/onebox/discourse_topic_reply.response",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/fixtures/onebox/discourse_topic_reply.response?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87"
    },
    {
      "sha": "e59efade5afa8cef86bdffa37fa6f4ba2e8552cc",
      "filename": "spec/models/user_spec.rb",
      "status": "modified",
      "additions": 14,
      "deletions": 6,
      "changes": 20,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/models/user_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/models/user_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/models/user_spec.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -2142,16 +2142,24 @@ def filter_by(method)\n \n   end\n \n-  describe '#match_title_to_primary_group_changes' do\n-    let(:primary_group_a) { Fabricate(:group, title: 'A', users: [user]) }\n-    let(:primary_group_b) { Fabricate(:group, title: 'B', users: [user]) }\n+  describe '#match_primary_group_changes' do\n+    let(:group_a) { Fabricate(:group, title: 'A', users: [user]) }\n+    let(:group_b) { Fabricate(:group, title: 'B', users: [user]) }\n \n     it \"updates user's title only when it is blank or matches the previous primary group\" do\n-      expect { user.update(primary_group: primary_group_a) }.to change { user.reload.title }.from(nil).to('A')\n-      expect { user.update(primary_group: primary_group_b) }.to change { user.reload.title }.from('A').to('B')\n+      expect { user.update(primary_group: group_a) }.to change { user.reload.title }.from(nil).to('A')\n+      expect { user.update(primary_group: group_b) }.to change { user.reload.title }.from('A').to('B')\n \n       user.update(title: 'Different')\n-      expect { user.update(primary_group: primary_group_a) }.to_not change { user.reload.title }\n+      expect { user.update(primary_group: group_a) }.to_not change { user.reload.title }\n+    end\n+\n+    it \"updates user's title only when it is blank or matches the previous primary group\" do\n+      expect { user.update(primary_group: group_a) }.to change { user.reload.flair_group }.from(nil).to(group_a)\n+      expect { user.update(primary_group: group_b) }.to change { user.reload.flair_group }.from(group_a).to(group_b)\n+\n+      user.update(flair_group: group_a)\n+      expect { user.update(primary_group: group_a) }.to_not change { user.reload.flair_group }\n     end\n   end\n "
    },
    {
      "sha": "3aab14602018283c141d5ac8811b26b2b97c5cdd",
      "filename": "spec/requests/api/posts_spec.rb",
      "status": "modified",
      "additions": 15,
      "deletions": 12,
      "changes": 27,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/requests/api/posts_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/requests/api/posts_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/requests/api/posts_spec.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -51,9 +51,10 @@\n                 category_id: { type: :integer },\n                 display_username: { type: :string },\n                 primary_group_name: { type: :string, nullable: true },\n-                primary_group_flair_url: { type: :string, nullable: true },\n-                primary_group_flair_bg_color: { type: :string, nullable: true },\n-                primary_group_flair_color: { type: :string, nullable: true },\n+                flair_name: { type: :string, nullable: true },\n+                flair_url: { type: :string, nullable: true },\n+                flair_bg_color: { type: :string, nullable: true },\n+                flair_color: { type: :string, nullable: true },\n                 version: { type: :integer },\n                 can_edit: { type: :boolean },\n                 can_delete: { type: :boolean },\n@@ -149,9 +150,10 @@\n           topic_slug: { type: :string },\n           display_username: { type: :string, nullable: true },\n           primary_group_name: { type: :string, nullable: true },\n-          primary_group_flair_url: { type: :string, nullable: true },\n-          primary_group_flair_bg_color: { type: :string, nullable: true },\n-          primary_group_flair_color: { type: :string, nullable: true },\n+          flair_name: { type: :string, nullable: true },\n+          flair_url: { type: :string, nullable: true },\n+          flair_bg_color: { type: :string, nullable: true },\n+          flair_color: { type: :string, nullable: true },\n           version: { type: :integer },\n           can_edit: { type: :boolean },\n           can_delete: { type: :boolean },\n@@ -237,9 +239,9 @@\n               topic_slug: { type: :string },\n               display_username: { type: :string, nullable: true },\n               primary_group_name: { type: :string, nullable: true },\n-              primary_group_flair_url: { type: :string, nullable: true },\n-              primary_group_flair_bg_color: { type: :string, nullable: true },\n-              primary_group_flair_color: { type: :string, nullable: true },\n+              flair_url: { type: :string, nullable: true },\n+              flair_bg_color: { type: :string, nullable: true },\n+              flair_color: { type: :string, nullable: true },\n               version: { type: :integer },\n               can_edit: { type: :boolean },\n               can_delete: { type: :boolean },\n@@ -359,9 +361,10 @@\n           topic_slug: { type: :string },\n           display_username: { type: :string },\n           primary_group_name: { type: :string, nullable: true },\n-          primary_group_flair_url: { type: :string, nullable: true },\n-          primary_group_flair_bg_color: { type: :string, nullable: true },\n-          primary_group_flair_color: { type: :string, nullable: true },\n+          flair_name: { type: :string, nullable: true },\n+          flair_url: { type: :string, nullable: true },\n+          flair_bg_color: { type: :string, nullable: true },\n+          flair_color: { type: :string, nullable: true },\n           version: { type: :integer },\n           can_edit: { type: :boolean },\n           can_delete: { type: :boolean },"
    },
    {
      "sha": "5c1c21c3e45f8a8f8b8c542904cd52553c904a1c",
      "filename": "spec/requests/api/schemas/json/topic_create_response.json",
      "status": "modified",
      "additions": 13,
      "deletions": 6,
      "changes": 19,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/requests/api/schemas/json/topic_create_response.json",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/requests/api/schemas/json/topic_create_response.json",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/requests/api/schemas/json/topic_create_response.json?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -79,19 +79,25 @@\n         \"null\"\n       ]\n     },\n-    \"primary_group_flair_url\": {\n+    \"flair_name\": {\n       \"type\": [\n         \"string\",\n         \"null\"\n       ]\n     },\n-    \"primary_group_flair_bg_color\": {\n+    \"flair_url\": {\n       \"type\": [\n         \"string\",\n         \"null\"\n       ]\n     },\n-    \"primary_group_flair_color\": {\n+    \"flair_bg_color\": {\n+      \"type\": [\n+        \"string\",\n+        \"null\"\n+      ]\n+    },\n+    \"flair_color\": {\n       \"type\": [\n         \"string\",\n         \"null\"\n@@ -219,9 +225,10 @@\n     \"topic_slug\",\n     \"display_username\",\n     \"primary_group_name\",\n-    \"primary_group_flair_url\",\n-    \"primary_group_flair_bg_color\",\n-    \"primary_group_flair_color\",\n+    \"flair_name\",\n+    \"flair_url\",\n+    \"flair_bg_color\",\n+    \"flair_color\",\n     \"version\",\n     \"can_edit\",\n     \"can_delete\","
    },
    {
      "sha": "e7e0e18300eef3b3cb7c905858a717911e3f6f26",
      "filename": "spec/requests/api/topics_spec.rb",
      "status": "modified",
      "additions": 12,
      "deletions": 9,
      "changes": 21,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/requests/api/topics_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/requests/api/topics_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/requests/api/topics_spec.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -53,9 +53,10 @@\n                     topic_slug: { type: :string },\n                     display_username: { type: :string, nullable: true },\n                     primary_group_name: { type: :string, nullable: true },\n-                    primary_group_flair_url: { type: :string, nullable: true },\n-                    primary_group_flair_bg_color: { type: :string, nullable: true },\n-                    primary_group_flair_color: { type: :string, nullable: true },\n+                    flair_name: { type: :string, nullable: true },\n+                    flair_url: { type: :string, nullable: true },\n+                    flair_bg_color: { type: :string, nullable: true },\n+                    flair_color: { type: :string, nullable: true },\n                     version: { type: :integer },\n                     can_edit: { type: :boolean },\n                     can_delete: { type: :boolean },\n@@ -144,9 +145,10 @@\n                     topic_slug: { type: :string },\n                     display_username: { type: :string },\n                     primary_group_name: { type: :string, nullable: true },\n-                    primary_group_flair_url: { type: :string, nullable: true },\n-                    primary_group_flair_bg_color: { type: :string, nullable: true },\n-                    primary_group_flair_color: { type: :string, nullable: true },\n+                    flair_name: { type: :string, nullable: true },\n+                    flair_url: { type: :string, nullable: true },\n+                    flair_bg_color: { type: :string, nullable: true },\n+                    flair_color: { type: :string, nullable: true },\n                     version: { type: :integer },\n                     can_edit: { type: :boolean },\n                     can_delete: { type: :boolean },\n@@ -337,9 +339,10 @@\n                     avatar_template: { type: :string },\n                     post_count: { type: :integer },\n                     primary_group_name: { type: :string, nullable: true },\n-                    primary_group_flair_url: { type: :string, nullable: true },\n-                    primary_group_flair_color: { type: :string, nullable: true },\n-                    primary_group_flair_bg_color: { type: :string, nullable: true },\n+                    flair_name: { type: :string, nullable: true },\n+                    flair_url: { type: :string, nullable: true },\n+                    flair_color: { type: :string, nullable: true },\n+                    flair_bg_color: { type: :string, nullable: true },\n                   }\n                 },\n               },"
    },
    {
      "sha": "57c414ec28bbb31ee6e85344288b718e25e3adad",
      "filename": "spec/requests/users_controller_spec.rb",
      "status": "modified",
      "additions": 11,
      "deletions": 11,
      "changes": 22,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/requests/users_controller_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/requests/users_controller_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/requests/users_controller_spec.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -3098,32 +3098,32 @@ def post_user(extra_params = {})\n         expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"trust_level\"]).to eq(1)\n       end\n \n-      it \"returns data for primary group flair when an icon is used for flair\" do\n+      it \"returns data for flair when an icon is used\" do\n         group = Fabricate(:group, name: \"Groupie\", flair_bg_color: \"#111111\", flair_color: \"#999999\", flair_icon: \"icon\")\n-        liker = Fabricate(:user, primary_group: group)\n+        liker = Fabricate(:user, flair_group: group)\n         create_and_like_post(user, liker)\n \n         get \"/u/#{user.username_lower}/summary.json\"\n         json = response.parsed_body\n \n-        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"primary_group_flair_url\"]).to eq(\"icon\")\n-        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"primary_group_name\"]).to eq(\"Groupie\")\n-        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"primary_group_flair_bg_color\"]).to eq(\"#111111\")\n-        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"primary_group_flair_color\"]).to eq(\"#999999\")\n+        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"flair_name\"]).to eq(\"Groupie\")\n+        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"flair_url\"]).to eq(\"icon\")\n+        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"flair_bg_color\"]).to eq(\"#111111\")\n+        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"flair_color\"]).to eq(\"#999999\")\n       end\n \n-      it \"returns data for primary group flair when an image is used for flair\" do\n+      it \"returns data for flair when an image is used\" do\n         upload = Fabricate(:upload)\n         group = Fabricate(:group, name: \"Groupie\", flair_bg_color: \"#111111\", flair_upload: upload)\n-        liker = Fabricate(:user, primary_group: group)\n+        liker = Fabricate(:user, flair_group: group)\n         create_and_like_post(user, liker)\n \n         get \"/u/#{user.username_lower}/summary.json\"\n         json = response.parsed_body\n \n-        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"primary_group_flair_url\"]).to eq(upload.url)\n-        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"primary_group_name\"]).to eq(\"Groupie\")\n-        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"primary_group_flair_bg_color\"]).to eq(\"#111111\")\n+        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"flair_name\"]).to eq(\"Groupie\")\n+        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"flair_url\"]).to eq(upload.url)\n+        expect(json[\"user_summary\"][\"most_liked_by_users\"][0][\"flair_bg_color\"]).to eq(\"#111111\")\n       end\n \n       def create_and_like_post(likee, liker)"
    },
    {
      "sha": "4d1265e70333fd007d3b26c133bcb2a7ec73dcd8",
      "filename": "spec/serializers/web_hook_post_serializer_spec.rb",
      "status": "modified",
      "additions": 45,
      "deletions": 14,
      "changes": 59,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/serializers/web_hook_post_serializer_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/serializers/web_hook_post_serializer_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/serializers/web_hook_post_serializer_spec.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -11,20 +11,51 @@ def serialized_for_user(u)\n   end\n \n   it 'should only include the required keys' do\n-    count = serialized_for_user(admin).keys.count\n-    difference = count - 42\n-\n-    expect(difference).to eq(0), lambda {\n-      message = +\"\"\n-\n-      if difference < 0\n-        message << \"#{difference * -1} key(s) have been removed from this serializer.\"\n-      else\n-        message << \"#{difference} key(s) have been added to this serializer.\"\n-      end\n-\n-      message << \"\\nPlease verify if those key(s) are required as part of the web hook's payload.\"\n-    }\n+    expect(serialized_for_user(admin).keys).to contain_exactly(\n+      :id,\n+      :name,\n+      :username,\n+      :avatar_template,\n+      :created_at,\n+      :cooked,\n+      :post_number,\n+      :post_type,\n+      :updated_at,\n+      :reply_count,\n+      :reply_to_post_number,\n+      :quote_count,\n+      :incoming_link_count,\n+      :reads,\n+      :score,\n+      :topic_id,\n+      :topic_slug,\n+      :topic_title,\n+      :category_id,\n+      :display_username,\n+      :primary_group_name,\n+      :flair_name,\n+      :version,\n+      :user_title,\n+      :bookmarked,\n+      :raw,\n+      :moderator,\n+      :admin,\n+      :staff,\n+      :user_id,\n+      :hidden,\n+      :trust_level,\n+      :deleted_at,\n+      :user_deleted,\n+      :edit_reason,\n+      :wiki,\n+      :reviewable_id,\n+      :reviewable_score_count,\n+      :reviewable_score_pending_count,\n+      :topic_posts_count,\n+      :topic_filtered_posts_count,\n+      :topic_archetype,\n+      :category_slug\n+    )\n   end\n \n   it \"includes category_id\" do"
    },
    {
      "sha": "68bc42fdc63814eeb6141a6527f0eb5008693dfe",
      "filename": "spec/serializers/web_hook_user_serializer_spec.rb",
      "status": "modified",
      "additions": 54,
      "deletions": 9,
      "changes": 63,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/serializers/web_hook_user_serializer_spec.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/serializers/web_hook_user_serializer_spec.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/serializers/web_hook_user_serializer_spec.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -22,14 +22,59 @@\n   end\n \n   it 'should only include the required keys' do\n-    count = serializer.as_json.keys.count\n-    difference = count - 51\n-\n-    expect(difference).to eq(0), lambda {\n-      message = (difference < 0 ?\n-                \"#{difference * -1} key(s) have been removed from this serializer.\" :\n-                \"#{difference} key(s) have been added to this serializer.\") +\n-                \"\\nPlease verify if those key(s) are required as part of the web hook's payload.\"\n-    }\n+    expect(serializer.as_json.keys).to contain_exactly(\n+      :id,\n+      :username,\n+      :name,\n+      :avatar_template,\n+      :email,\n+      :secondary_emails,\n+      :last_posted_at,\n+      :last_seen_at,\n+      :created_at,\n+      :muted,\n+      :trust_level,\n+      :moderator,\n+      :admin,\n+      :title,\n+      :badge_count,\n+      :time_read,\n+      :recent_time_read,\n+      :primary_group_id,\n+      :primary_group_name,\n+      :flair_name,\n+      :flair_url,\n+      :flair_bg_color,\n+      :flair_color,\n+      :featured_topic,\n+      :staged,\n+      :pending_count,\n+      :profile_view_count,\n+      :second_factor_enabled,\n+      :can_upload_profile_header,\n+      :can_upload_user_card_background,\n+      :post_count,\n+      :locale,\n+      :muted_category_ids,\n+      :regular_category_ids,\n+      :watched_tags,\n+      :watching_first_post_tags,\n+      :tracked_tags,\n+      :muted_tags,\n+      :tracked_category_ids,\n+      :watched_category_ids,\n+      :watched_first_post_category_ids,\n+      :system_avatar_template,\n+      :muted_usernames,\n+      :ignored_usernames,\n+      :allowed_pm_usernames,\n+      :mailing_list_posts_per_day,\n+      :user_notification_schedule,\n+      :external_id,\n+      :featured_user_badge_ids,\n+      :invited_by,\n+      :groups,\n+      :user_option\n+    )\n   end\n end"
    },
    {
      "sha": "2e03f53ccaece1b89a5946d3f77feaf30e17568f",
      "filename": "spec/swagger_helper.rb",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/swagger_helper.rb",
      "raw_url": "https://github.com/discourse/discourse/raw/87c1e98571631d83e0d9f0846bd95a2c7e9bce87/spec/swagger_helper.rb",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/spec/swagger_helper.rb?ref=87c1e98571631d83e0d9f0846bd95a2c7e9bce87",
      "patch": "@@ -153,9 +153,9 @@ def api_docs_description\n                   recent_time_read: { type: :integer },\n                   primary_group_id: { type: :string, nullable: true },\n                   primary_group_name: { type: :string, nullable: true },\n-                  primary_group_flair_url: { type: :string, nullable: true },\n-                  primary_group_flair_bg_color: { type: :string, nullable: true },\n-                  primary_group_flair_color: { type: :string, nullable: true },\n+                  flair_url: { type: :string, nullable: true },\n+                  flair_bg_color: { type: :string, nullable: true },\n+                  flair_color: { type: :string, nullable: true },\n                   featured_topic: { type: :string, nullable: true },\n                   staged: { type: :boolean },\n                   can_edit: { type: :boolean },"
    }
  ]
}
