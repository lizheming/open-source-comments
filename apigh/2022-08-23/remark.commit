{
  "sha": "dc048ef0476d8ab4490bc42702f3cfed245a031d",
  "node_id": "C_kwDOBtgov9oAKGRjMDQ4ZWYwNDc2ZDhhYjQ0OTBiYzQyNzAyZjNjZmVkMjQ1YTAzMWQ",
  "commit": {
    "author": {
      "name": "Pavel Mineev",
      "email": "pavel@mineev.me",
      "date": "2022-08-22T03:53:48Z"
    },
    "committer": {
      "name": "Paul Mineev",
      "email": "paul@mineev.me",
      "date": "2022-08-22T18:42:15Z"
    },
    "message": "fix: anon cannot request data removal",
    "tree": {
      "sha": "9649d396ee0c796a9330b0783278709169cc0de4",
      "url": "https://api.github.com/repos/umputun/remark42/git/trees/9649d396ee0c796a9330b0783278709169cc0de4"
    },
    "url": "https://api.github.com/repos/umputun/remark42/git/commits/dc048ef0476d8ab4490bc42702f3cfed245a031d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/umputun/remark42/commits/dc048ef0476d8ab4490bc42702f3cfed245a031d",
  "html_url": "https://github.com/umputun/remark42/commit/dc048ef0476d8ab4490bc42702f3cfed245a031d",
  "comments_url": "https://api.github.com/repos/umputun/remark42/commits/dc048ef0476d8ab4490bc42702f3cfed245a031d/comments",
  "author": {
    "login": "akellbl4",
    "id": 2330682,
    "node_id": "MDQ6VXNlcjIzMzA2ODI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2330682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/akellbl4",
    "html_url": "https://github.com/akellbl4",
    "followers_url": "https://api.github.com/users/akellbl4/followers",
    "following_url": "https://api.github.com/users/akellbl4/following{/other_user}",
    "gists_url": "https://api.github.com/users/akellbl4/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/akellbl4/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/akellbl4/subscriptions",
    "organizations_url": "https://api.github.com/users/akellbl4/orgs",
    "repos_url": "https://api.github.com/users/akellbl4/repos",
    "events_url": "https://api.github.com/users/akellbl4/events{/privacy}",
    "received_events_url": "https://api.github.com/users/akellbl4/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "akellbl4",
    "id": 2330682,
    "node_id": "MDQ6VXNlcjIzMzA2ODI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2330682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/akellbl4",
    "html_url": "https://github.com/akellbl4",
    "followers_url": "https://api.github.com/users/akellbl4/followers",
    "following_url": "https://api.github.com/users/akellbl4/following{/other_user}",
    "gists_url": "https://api.github.com/users/akellbl4/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/akellbl4/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/akellbl4/subscriptions",
    "organizations_url": "https://api.github.com/users/akellbl4/orgs",
    "repos_url": "https://api.github.com/users/akellbl4/repos",
    "events_url": "https://api.github.com/users/akellbl4/events{/privacy}",
    "received_events_url": "https://api.github.com/users/akellbl4/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d6b2960a4ae1b87a80ce8bc28a5a836a62803f9f",
      "url": "https://api.github.com/repos/umputun/remark42/commits/d6b2960a4ae1b87a80ce8bc28a5a836a62803f9f",
      "html_url": "https://github.com/umputun/remark42/commit/d6b2960a4ae1b87a80ce8bc28a5a836a62803f9f"
    }
  ],
  "stats": {
    "total": 21,
    "additions": 18,
    "deletions": 3
  },
  "files": [
    {
      "sha": "0cb3a1b5a16e2b39f8afa5ae9453b2387b27175c",
      "filename": "frontend/apps/remark42/app/components/profile/profile.spec.tsx",
      "status": "modified",
      "additions": 12,
      "deletions": 1,
      "changes": 13,
      "blob_url": "https://github.com/umputun/remark42/blob/dc048ef0476d8ab4490bc42702f3cfed245a031d/frontend%2Fapps%2Fremark42%2Fapp%2Fcomponents%2Fprofile%2Fprofile.spec.tsx",
      "raw_url": "https://github.com/umputun/remark42/raw/dc048ef0476d8ab4490bc42702f3cfed245a031d/frontend%2Fapps%2Fremark42%2Fapp%2Fcomponents%2Fprofile%2Fprofile.spec.tsx",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend%2Fapps%2Fremark42%2Fapp%2Fcomponents%2Fprofile%2Fprofile.spec.tsx?ref=dc048ef0476d8ab4490bc42702f3cfed245a031d",
      "patch": "@@ -1,5 +1,5 @@\n import '@testing-library/jest-dom';\n-import { waitFor, fireEvent } from '@testing-library/preact';\n+import { waitFor, fireEvent, screen } from '@testing-library/preact';\n \n import { render } from 'tests/utils';\n import * as api from 'common/api';\n@@ -190,4 +190,15 @@ describe('<Profile />', () => {\n     fireEvent.click(await findByRole('button', { name: /load more/i }));\n     expect(queryByTestId('preloader')).not.toBeInTheDocument();\n   });\n+\n+  it('should not render removal button for anonymous user', async () => {\n+    jest\n+      .spyOn(api, 'getUserComments')\n+      .mockImplementation(async () => ({ comments: new Array(10).fill(commentStub), count: 15 }));\n+    jest.spyOn(pq, 'parseQuery').mockImplementation(() => ({ ...userParamsStub, name: 'anonymous_1' }));\n+\n+    render(<Profile />);\n+\n+    expect(screen.queryByText(/request my data removal/i)).not.toBeInTheDocument();\n+  });\n });"
    },
    {
      "sha": "5b4fead254c80937dbbeef444948d2c0e4af4492",
      "filename": "frontend/apps/remark42/app/components/profile/profile.tsx",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/umputun/remark42/blob/dc048ef0476d8ab4490bc42702f3cfed245a031d/frontend%2Fapps%2Fremark42%2Fapp%2Fcomponents%2Fprofile%2Fprofile.tsx",
      "raw_url": "https://github.com/umputun/remark42/raw/dc048ef0476d8ab4490bc42702f3cfed245a031d/frontend%2Fapps%2Fremark42%2Fapp%2Fcomponents%2Fprofile%2Fprofile.tsx",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend%2Fapps%2Fremark42%2Fapp%2Fcomponents%2Fprofile%2Fprofile.tsx?ref=dc048ef0476d8ab4490bc42702f3cfed245a031d",
      "patch": "@@ -8,6 +8,7 @@ import { parseQuery } from 'utils/parse-query';\n import { requestDeletion } from 'utils/email';\n import { setStyles } from 'utils/set-dom-props';\n import { Avatar } from 'components/avatar';\n+import { isUserAnonymous } from 'utils/isUserAnonymous';\n import { postMessageToParent } from 'utils/post-message';\n import { Comment } from 'components/comment';\n import { Preloader } from 'components/preloader';\n@@ -18,7 +19,7 @@ import { CrossIcon } from 'components/icons/cross';\n import { IconButton } from 'components/icon-button/icon-button';\n import { Button } from 'components/auth/components/button';\n import { messages as authMessages } from 'components/auth/auth.messsages';\n-import type { Comment as CommentType, Theme } from 'common/types';\n+import type { Comment as CommentType, Theme, User } from 'common/types';\n \n import styles from './profile.module.css';\n import { Counter } from './components/counter';\n@@ -219,7 +220,7 @@ export function Profile() {\n           {comments === null && isCommentsLoading && <Preloader className={styles.preloader} />}\n           {comments !== null && commentsJSX}\n         </section>\n-        {isCurrent ? (\n+        {isCurrent && !isUserAnonymous(user as unknown as User) ? (\n           <footer className={clsx('profile-footer', styles.footer)}>\n             <Button kind=\"hollow\" size=\"sm\" onClick={handleClickRequestRemoveData}>\n               <FormattedMessage id=\"profile.request-to-delete-data\" defaultMessage=\"Request my data removal\" />"
    },
    {
      "sha": "25e2a20877caf4716781dfbac0384adeb64e08c2",
      "filename": "frontend/apps/remark42/package.json",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/umputun/remark42/blob/dc048ef0476d8ab4490bc42702f3cfed245a031d/frontend%2Fapps%2Fremark42%2Fpackage.json",
      "raw_url": "https://github.com/umputun/remark42/raw/dc048ef0476d8ab4490bc42702f3cfed245a031d/frontend%2Fapps%2Fremark42%2Fpackage.json",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend%2Fapps%2Fremark42%2Fpackage.json?ref=dc048ef0476d8ab4490bc42702f3cfed245a031d",
      "patch": "@@ -51,6 +51,7 @@\n     \"@formatjs/cli\": \"^5.0.2\",\n     \"@mavrin/stylelint-declaration-use-css-custom-properties\": \"^2.0.0\",\n     \"@prefresh/babel-plugin\": \"^0.4.3\",\n+    \"@prefresh/core\": \"^1.3.4\",\n     \"@prefresh/webpack\": \"^3.3.4\",\n     \"@size-limit/file\": \"^7.0.8\",\n     \"@swc/core\": \"1.2.205\","
    },
    {
      "sha": "34fbacc33ceab07e21c6316418ed7185d237fe8e",
      "filename": "frontend/pnpm-lock.yaml",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/umputun/remark42/blob/dc048ef0476d8ab4490bc42702f3cfed245a031d/frontend%2Fpnpm-lock.yaml",
      "raw_url": "https://github.com/umputun/remark42/raw/dc048ef0476d8ab4490bc42702f3cfed245a031d/frontend%2Fpnpm-lock.yaml",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/frontend%2Fpnpm-lock.yaml?ref=dc048ef0476d8ab4490bc42702f3cfed245a031d",
      "patch": "@@ -24,6 +24,7 @@ importers:\n       '@github/text-expander-element': ^2.2.2\n       '@mavrin/stylelint-declaration-use-css-custom-properties': ^2.0.0\n       '@prefresh/babel-plugin': ^0.4.3\n+      '@prefresh/core': ^1.3.4\n       '@prefresh/webpack': ^3.3.4\n       '@size-limit/file': ^7.0.8\n       '@swc/core': 1.2.205\n@@ -137,6 +138,7 @@ importers:\n       '@formatjs/cli': 5.0.2\n       '@mavrin/stylelint-declaration-use-css-custom-properties': 2.0.0_stylelint@14.9.1\n       '@prefresh/babel-plugin': 0.4.3\n+      '@prefresh/core': 1.3.4_preact@10.6.2\n       '@prefresh/webpack': 3.3.4_aygq4fhb36ivjwsmiykvhlqsje\n       '@size-limit/file': 7.0.8_size-limit@7.0.8\n       '@swc/core': 1.2.205"
    }
  ]
}
