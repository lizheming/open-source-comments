{
  "sha": "d1b289daaacb716d32ba4f13322434644293b5b7",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpkMWIyODlkYWFhY2I3MTZkMzJiYTRmMTMzMjI0MzQ2NDQyOTNiNWI3",
  "commit": {
    "author": {
      "name": "David Taylor",
      "email": "david@taylorhq.com",
      "date": "2021-02-05T09:16:18Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-02-05T09:16:18Z"
    },
    "message": "DEV: Cleanup detection of user summary route for header collapsing (#11985)\n\nPreviously it was using various willTransition and didTransition hooks\r\nwhich can be quite fragile, especially when removing the\r\nintermediate loading state.",
    "tree": {
      "sha": "a8b3e5ad7a38aa3f55cd4b26a0d819e2d2102c14",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/a8b3e5ad7a38aa3f55cd4b26a0d819e2d2102c14"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/d1b289daaacb716d32ba4f13322434644293b5b7",
    "comment_count": 1,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgHQziCRBK7hj4Ov3rIwAAdHIIAAK+zP2tz9/67LAA/yxItgNf\no61ooGrVkbWKWh1yv+H3QFXtF0QS6TMxPYB/RqwzlLcwrdhbjtBtW6Ga40PXd2Vw\nzjnBEqQPO0k9wOItn+RXX7WxGfCEbRjO9YuOFhgvsxSJ9Gz5s9Zr9HSSESqlcevs\nk7mdMfgz/N4aTNSW1pMosY79/pHk3/kQ+amiUPeXI4kmUcWFQawyH56lnE0lvvoq\nxsIJInes+pmR+l37s9vikioCeLSwo1uDrRihuOtSip8q+I+8IP02SddSfPSZcx5l\nDFhd/qz25aE1UfRbHeQqAXtn7coyParAMaRAd8Q8hMG17NCoWhBNeEUVvFtYLLw=\n=HLh+\n-----END PGP SIGNATURE-----\n",
      "payload": "tree a8b3e5ad7a38aa3f55cd4b26a0d819e2d2102c14\nparent f6e6ae5e249ab5797461c8399663ab62d56c37b1\nauthor David Taylor <david@taylorhq.com> 1612516578 +0000\ncommitter GitHub <noreply@github.com> 1612516578 +0000\n\nDEV: Cleanup detection of user summary route for header collapsing (#11985)\n\nPreviously it was using various willTransition and didTransition hooks\r\nwhich can be quite fragile, especially when removing the\r\nintermediate loading state."
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/d1b289daaacb716d32ba4f13322434644293b5b7",
  "html_url": "https://github.com/discourse/discourse/commit/d1b289daaacb716d32ba4f13322434644293b5b7",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/d1b289daaacb716d32ba4f13322434644293b5b7/comments",
  "author": {
    "login": "davidtaylorhq",
    "id": 6270921,
    "node_id": "MDQ6VXNlcjYyNzA5MjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6270921?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidtaylorhq",
    "html_url": "https://github.com/davidtaylorhq",
    "followers_url": "https://api.github.com/users/davidtaylorhq/followers",
    "following_url": "https://api.github.com/users/davidtaylorhq/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidtaylorhq/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidtaylorhq/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidtaylorhq/subscriptions",
    "organizations_url": "https://api.github.com/users/davidtaylorhq/orgs",
    "repos_url": "https://api.github.com/users/davidtaylorhq/repos",
    "events_url": "https://api.github.com/users/davidtaylorhq/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidtaylorhq/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f6e6ae5e249ab5797461c8399663ab62d56c37b1",
      "url": "https://api.github.com/repos/discourse/discourse/commits/f6e6ae5e249ab5797461c8399663ab62d56c37b1",
      "html_url": "https://github.com/discourse/discourse/commit/f6e6ae5e249ab5797461c8399663ab62d56c37b1"
    }
  ],
  "stats": {
    "total": 26,
    "additions": 6,
    "deletions": 20
  },
  "files": [
    {
      "sha": "cfa79ddfb695c94e368309fc8d521c3d8b5ee0e0",
      "filename": "app/assets/javascripts/discourse/app/controllers/user.js",
      "status": "modified",
      "additions": 6,
      "deletions": 5,
      "changes": 11,
      "blob_url": "https://github.com/discourse/discourse/blob/d1b289daaacb716d32ba4f13322434644293b5b7/app/assets/javascripts/discourse/app/controllers/user.js",
      "raw_url": "https://github.com/discourse/discourse/raw/d1b289daaacb716d32ba4f13322434644293b5b7/app/assets/javascripts/discourse/app/controllers/user.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/controllers/user.js?ref=d1b289daaacb716d32ba4f13322434644293b5b7",
      "patch": "@@ -1,6 +1,6 @@\n import Controller, { inject } from \"@ember/controller\";\n import EmberObject, { computed, set } from \"@ember/object\";\n-import { alias, and, gt, not, or } from \"@ember/object/computed\";\n+import { alias, and, equal, gt, not, or } from \"@ember/object/computed\";\n import CanCheckEmails from \"discourse/mixins/can-check-emails\";\n import User from \"discourse/models/user\";\n import I18n from \"I18n\";\n@@ -14,7 +14,6 @@ import { prioritizeNameInUx } from \"discourse/lib/settings\";\n import { inject as service } from \"@ember/service\";\n \n export default Controller.extend(CanCheckEmails, {\n-  indexStream: false,\n   router: service(),\n   userNotifications: inject(\"user-notifications\"),\n   currentPath: alias(\"router._router.currentPath\"),\n@@ -36,17 +35,19 @@ export default Controller.extend(CanCheckEmails, {\n     return !isEmpty(background.toString());\n   },\n \n+  isSummaryRoute: equal(\"router.currentRouteName\", \"user.summary\"),\n+\n   @discourseComputed(\n     \"model.profile_hidden\",\n-    \"indexStream\",\n+    \"isSummaryRoute\",\n     \"viewingSelf\",\n     \"forceExpand\"\n   )\n-  collapsedInfo(profileHidden, indexStream, viewingSelf, forceExpand) {\n+  collapsedInfo(profileHidden, isSummaryRoute, viewingSelf, forceExpand) {\n     if (profileHidden) {\n       return true;\n     }\n-    return (!indexStream || viewingSelf) && !forceExpand;\n+    return (!isSummaryRoute || viewingSelf) && !forceExpand;\n   },\n   canMuteOrIgnoreUser: or(\"model.can_ignore_user\", \"model.can_mute_user\"),\n   hasGivenFlags: gt(\"model.number_of_flags_given\", 0),"
    },
    {
      "sha": "b56971fdae5a2eacad344ee42dcc0b101bf4717b",
      "filename": "app/assets/javascripts/discourse/app/routes/build-admin-user-posts-route.js",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/d1b289daaacb716d32ba4f13322434644293b5b7/app/assets/javascripts/discourse/app/routes/build-admin-user-posts-route.js",
      "raw_url": "https://github.com/discourse/discourse/raw/d1b289daaacb716d32ba4f13322434644293b5b7/app/assets/javascripts/discourse/app/routes/build-admin-user-posts-route.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/routes/build-admin-user-posts-route.js?ref=d1b289daaacb716d32ba4f13322434644293b5b7",
      "patch": "@@ -6,7 +6,6 @@ export default function (filter) {\n   return DiscourseRoute.extend({\n     actions: {\n       didTransition() {\n-        this.controllerFor(\"user\").set(\"indexStream\", true);\n         this.controllerFor(\"user-posts\")._showFooter();\n         return true;\n       },"
    },
    {
      "sha": "d7fefead28448bccd4e10f7da4102c82cec2e271",
      "filename": "app/assets/javascripts/discourse/app/routes/user-summary.js",
      "status": "modified",
      "additions": 0,
      "deletions": 6,
      "changes": 6,
      "blob_url": "https://github.com/discourse/discourse/blob/d1b289daaacb716d32ba4f13322434644293b5b7/app/assets/javascripts/discourse/app/routes/user-summary.js",
      "raw_url": "https://github.com/discourse/discourse/raw/d1b289daaacb716d32ba4f13322434644293b5b7/app/assets/javascripts/discourse/app/routes/user-summary.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/routes/user-summary.js?ref=d1b289daaacb716d32ba4f13322434644293b5b7",
      "patch": "@@ -11,10 +11,4 @@ export default DiscourseRoute.extend({\n \n     return user.summary();\n   },\n-\n-  actions: {\n-    didTransition() {\n-      this.controllerFor(\"user\").set(\"indexStream\", true);\n-    },\n-  },\n });"
    },
    {
      "sha": "5a3435eb72c0beaaf017c1c360e0098c6efc50e9",
      "filename": "app/assets/javascripts/discourse/app/routes/user.js",
      "status": "modified",
      "additions": 0,
      "deletions": 8,
      "changes": 8,
      "blob_url": "https://github.com/discourse/discourse/blob/d1b289daaacb716d32ba4f13322434644293b5b7/app/assets/javascripts/discourse/app/routes/user.js",
      "raw_url": "https://github.com/discourse/discourse/raw/d1b289daaacb716d32ba4f13322434644293b5b7/app/assets/javascripts/discourse/app/routes/user.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/routes/user.js?ref=d1b289daaacb716d32ba4f13322434644293b5b7",
      "patch": "@@ -11,14 +11,6 @@ export default DiscourseRoute.extend({\n   },\n \n   actions: {\n-    willTransition(transition) {\n-      // will reset the indexStream when transitioning to routes that aren't \"indexStream\"\n-      // otherwise the \"header\" will jump\n-      const isIndexStream = transition.targetName === \"user.summary\";\n-      this.controllerFor(\"user\").set(\"indexStream\", isIndexStream);\n-      return true;\n-    },\n-\n     undoRevokeApiKey(key) {\n       key.undoRevoke();\n     },"
    }
  ]
}
