{
  "sha": "1cff4eb847d7472ce8c35c2b30b8c126fc61d388",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOjFjZmY0ZWI4NDdkNzQ3MmNlOGMzNWMyYjMwYjhjMTI2ZmM2MWQzODg=",
  "commit": {
    "author": {
      "name": "Dmitry Verkhoturov",
      "email": "paskal.07@gmail.com",
      "date": "2021-05-25T15:33:51Z"
    },
    "committer": {
      "name": "Umputun",
      "email": "umputun@gmail.com",
      "date": "2021-05-25T19:42:29Z"
    },
    "message": "clarify deprecation messages\n\nTurned out we don't really want to break\nusers configurations, so deprecated values\nstay with us at least before 2.0 is released.",
    "tree": {
      "sha": "3578a6386aba60a014369cd6f7aba5194141fc73",
      "url": "https://api.github.com/repos/umputun/remark42/git/trees/3578a6386aba60a014369cd6f7aba5194141fc73"
    },
    "url": "https://api.github.com/repos/umputun/remark42/git/commits/1cff4eb847d7472ce8c35c2b30b8c126fc61d388",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/umputun/remark42/commits/1cff4eb847d7472ce8c35c2b30b8c126fc61d388",
  "html_url": "https://github.com/umputun/remark42/commit/1cff4eb847d7472ce8c35c2b30b8c126fc61d388",
  "comments_url": "https://api.github.com/repos/umputun/remark42/commits/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/comments",
  "author": {
    "login": "paskal",
    "id": 712534,
    "node_id": "MDQ6VXNlcjcxMjUzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/712534?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paskal",
    "html_url": "https://github.com/paskal",
    "followers_url": "https://api.github.com/users/paskal/followers",
    "following_url": "https://api.github.com/users/paskal/following{/other_user}",
    "gists_url": "https://api.github.com/users/paskal/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paskal/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paskal/subscriptions",
    "organizations_url": "https://api.github.com/users/paskal/orgs",
    "repos_url": "https://api.github.com/users/paskal/repos",
    "events_url": "https://api.github.com/users/paskal/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paskal/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "umputun",
    "id": 535880,
    "node_id": "MDQ6VXNlcjUzNTg4MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/535880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/umputun",
    "html_url": "https://github.com/umputun",
    "followers_url": "https://api.github.com/users/umputun/followers",
    "following_url": "https://api.github.com/users/umputun/following{/other_user}",
    "gists_url": "https://api.github.com/users/umputun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/umputun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/umputun/subscriptions",
    "organizations_url": "https://api.github.com/users/umputun/orgs",
    "repos_url": "https://api.github.com/users/umputun/repos",
    "events_url": "https://api.github.com/users/umputun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/umputun/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b13fa228b618f1e176173b802aa3c85f03efbdf7",
      "url": "https://api.github.com/repos/umputun/remark42/commits/b13fa228b618f1e176173b802aa3c85f03efbdf7",
      "html_url": "https://github.com/umputun/remark42/commit/b13fa228b618f1e176173b802aa3c85f03efbdf7"
    }
  ],
  "stats": {
    "total": 46,
    "additions": 23,
    "deletions": 23
  },
  "files": [
    {
      "sha": "8419b7e452b74964b42fd0cd023675de3463c940",
      "filename": "backend/app/cmd/cmd.go",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/umputun/remark42/blob/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/backend/app/cmd/cmd.go",
      "raw_url": "https://github.com/umputun/remark42/raw/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/backend/app/cmd/cmd.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend/app/cmd/cmd.go?ref=1cff4eb847d7472ce8c35c2b30b8c126fc61d388",
      "patch": "@@ -33,9 +33,9 @@ type CommonOpts struct {\n \n // DeprecatedFlag contains information about deprecated option\n type DeprecatedFlag struct {\n-\tOld           string\n-\tNew           string\n-\tRemoveVersion string\n+\tOld     string\n+\tNew     string\n+\tVersion string\n }\n \n // SetCommon satisfies CommonOptionsCommander interface and sets common option fields"
    },
    {
      "sha": "692e11188c102b77949daa39d1006b56eb3d5600",
      "filename": "backend/app/cmd/server.go",
      "status": "modified",
      "additions": 11,
      "deletions": 11,
      "changes": 22,
      "blob_url": "https://github.com/umputun/remark42/blob/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/backend/app/cmd/server.go",
      "raw_url": "https://github.com/umputun/remark42/raw/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/backend/app/cmd/server.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend/app/cmd/server.go?ref=1cff4eb847d7472ce8c35c2b30b8c126fc61d388",
      "patch": "@@ -109,7 +109,7 @@ type ServerCommand struct {\n \t\t\tSMTPUserName string        `long:\"user\" env:\"USER\" description:\"[deprecated, use --smtp.username] enable TLS\"`\n \t\t\tTLS          bool          `long:\"tls\" env:\"TLS\" description:\"[deprecated, use --smtp.tls] SMTP TCP connection timeout\"`\n \t\t\tTimeOut      time.Duration `long:\"timeout\" env:\"TIMEOUT\" default:\"10s\" description:\"[deprecated, use --smtp.timeout] SMTP TCP connection timeout\"`\n-\t\t\tMsgTemplate  string        `long:\"template\" env:\"TEMPLATE\" description:\"[deprecated, message template file]\" default:\"email_confirmation_login.html.tmpl\"`\n+\t\t\tMsgTemplate  string        `long:\"template\" env:\"TEMPLATE\" description:\"[deprecated] message template file\" default:\"email_confirmation_login.html.tmpl\"`\n \t\t} `group:\"email\" namespace:\"email\" env-namespace:\"EMAIL\"`\n \t} `group:\"auth\" namespace:\"auth\" env-namespace:\"AUTH\"`\n \n@@ -310,43 +310,43 @@ func (s *ServerCommand) Execute(_ []string) error {\n func (s *ServerCommand) HandleDeprecatedFlags() (result []DeprecatedFlag) {\n \tif s.Auth.Email.Host != \"\" && s.SMTP.Host == \"\" {\n \t\ts.SMTP.Host = s.Auth.Email.Host\n-\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.host\", New: \"smtp.host\", RemoveVersion: \"1.7.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.host\", New: \"smtp.host\", Version: \"1.5\"})\n \t}\n \tif s.Auth.Email.Port != 0 && s.SMTP.Port == 0 {\n \t\ts.SMTP.Port = s.Auth.Email.Port\n-\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.port\", New: \"smtp.port\", RemoveVersion: \"1.7.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.port\", New: \"smtp.port\", Version: \"1.5\"})\n \t}\n \tif s.Auth.Email.TLS && !s.SMTP.TLS {\n \t\ts.SMTP.TLS = s.Auth.Email.TLS\n-\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.tls\", New: \"smtp.tls\", RemoveVersion: \"1.7.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.tls\", New: \"smtp.tls\", Version: \"1.5\"})\n \t}\n \tif s.Auth.Email.SMTPUserName != \"\" && s.SMTP.Username == \"\" {\n \t\ts.SMTP.Username = s.Auth.Email.SMTPUserName\n-\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.user\", New: \"smtp.username\", RemoveVersion: \"1.7.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.user\", New: \"smtp.username\", Version: \"1.5\"})\n \t}\n \tif s.Auth.Email.SMTPPassword != \"\" && s.SMTP.Password == \"\" {\n \t\ts.SMTP.Password = s.Auth.Email.SMTPPassword\n-\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.passwd\", New: \"smtp.password\", RemoveVersion: \"1.7.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.passwd\", New: \"smtp.password\", Version: \"1.5\"})\n \t}\n \tif s.Auth.Email.TimeOut != 10*time.Second && s.SMTP.TimeOut == 10*time.Second {\n \t\ts.SMTP.TimeOut = s.Auth.Email.TimeOut\n-\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.timeout\", New: \"smtp.timeout\", RemoveVersion: \"1.7.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.timeout\", New: \"smtp.timeout\", Version: \"1.5\"})\n \t}\n \tif s.Auth.Email.MsgTemplate != \"email_confirmation_login.html.tmpl\" {\n-\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.template\", RemoveVersion: \"1.9.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"auth.email.template\", Version: \"1.5\"})\n \t}\n \tif s.LegacyImageProxy && !s.ImageProxy.HTTP2HTTPS {\n \t\ts.ImageProxy.HTTP2HTTPS = s.LegacyImageProxy\n-\t\tresult = append(result, DeprecatedFlag{Old: \"img-proxy\", New: \"image-proxy.http2https\", RemoveVersion: \"1.7.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"img-proxy\", New: \"image-proxy.http2https\", Version: \"1.5\"})\n \t}\n \tif s.Notify.Telegram.Token != \"\" && s.Telegram.Token == \"\" {\n \t\ts.Telegram.Token = s.Notify.Telegram.Token\n-\t\tresult = append(result, DeprecatedFlag{Old: \"notify.telegram.token\", New: \"telegram.token\", RemoveVersion: \"1.10.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"notify.telegram.token\", New: \"telegram.token\", Version: \"1.9\"})\n \t}\n \tconst telegramDefaultDuration = time.Second * 5\n \tif s.Notify.Telegram.Timeout != telegramDefaultDuration && s.Telegram.Timeout == telegramDefaultDuration {\n \t\ts.Telegram.Token = s.Notify.Telegram.Token\n-\t\tresult = append(result, DeprecatedFlag{Old: \"notify.telegram.timeout\", New: \"telegram.timeout\", RemoveVersion: \"1.10.0\"})\n+\t\tresult = append(result, DeprecatedFlag{Old: \"notify.telegram.timeout\", New: \"telegram.timeout\", Version: \"1.9\"})\n \t}\n \treturn result\n }"
    },
    {
      "sha": "b8de4328b583b0a5f899ae70049ffcf220600e0d",
      "filename": "backend/app/cmd/server_test.go",
      "status": "modified",
      "additions": 7,
      "deletions": 7,
      "changes": 14,
      "blob_url": "https://github.com/umputun/remark42/blob/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/backend/app/cmd/server_test.go",
      "raw_url": "https://github.com/umputun/remark42/raw/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/backend/app/cmd/server_test.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend/app/cmd/server_test.go?ref=1cff4eb847d7472ce8c35c2b30b8c126fc61d388",
      "patch": "@@ -429,13 +429,13 @@ func TestServerApp_DeprecatedArgs(t *testing.T) {\n \tdeprecatedFlags := s.HandleDeprecatedFlags()\n \tassert.ElementsMatch(t,\n \t\t[]DeprecatedFlag{\n-\t\t\t{Old: \"auth.email.host\", New: \"smtp.host\", RemoveVersion: \"1.7.0\"},\n-\t\t\t{Old: \"auth.email.port\", New: \"smtp.port\", RemoveVersion: \"1.7.0\"},\n-\t\t\t{Old: \"auth.email.tls\", New: \"smtp.tls\", RemoveVersion: \"1.7.0\"},\n-\t\t\t{Old: \"auth.email.user\", New: \"smtp.username\", RemoveVersion: \"1.7.0\"},\n-\t\t\t{Old: \"auth.email.passwd\", New: \"smtp.password\", RemoveVersion: \"1.7.0\"},\n-\t\t\t{Old: \"auth.email.timeout\", New: \"smtp.timeout\", RemoveVersion: \"1.7.0\"},\n-\t\t\t{Old: \"auth.email.template\", RemoveVersion: \"1.9.0\"},\n+\t\t\t{Old: \"auth.email.host\", New: \"smtp.host\", Version: \"1.5\"},\n+\t\t\t{Old: \"auth.email.port\", New: \"smtp.port\", Version: \"1.5\"},\n+\t\t\t{Old: \"auth.email.tls\", New: \"smtp.tls\", Version: \"1.5\"},\n+\t\t\t{Old: \"auth.email.user\", New: \"smtp.username\", Version: \"1.5\"},\n+\t\t\t{Old: \"auth.email.passwd\", New: \"smtp.password\", Version: \"1.5\"},\n+\t\t\t{Old: \"auth.email.timeout\", New: \"smtp.timeout\", Version: \"1.5\"},\n+\t\t\t{Old: \"auth.email.template\", Version: \"1.5\"},\n \t\t},\n \t\tdeprecatedFlags)\n \tassert.Equal(t, \"smtp.example.org\", s.SMTP.Host)"
    },
    {
      "sha": "60a8f0533870d3ec9a9b2258459300a4b4769f19",
      "filename": "backend/app/main.go",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/umputun/remark42/blob/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/backend/app/main.go",
      "raw_url": "https://github.com/umputun/remark42/raw/1cff4eb847d7472ce8c35c2b30b8c126fc61d388/backend/app/main.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend/app/main.go?ref=1cff4eb847d7472ce8c35c2b30b8c126fc61d388",
      "patch": "@@ -46,8 +46,8 @@ func main() {\n \t\t\tRevision:     revision,\n \t\t})\n \t\tfor _, entry := range c.HandleDeprecatedFlags() {\n-\t\t\tlog.Printf(\"[WARN] --%s is deprecated and will be removed in v%s, please use --%s instead\",\n-\t\t\t\tentry.Old, entry.RemoveVersion, entry.New)\n+\t\t\tlog.Printf(\"[WARN] --%s is deprecated since v%s and will be removed in the future, please use --%s instead\",\n+\t\t\t\tentry.Old, entry.Version, entry.New)\n \t\t}\n \t\terr := c.Execute(args)\n \t\tif err != nil {"
    }
  ]
}
