{
  "sha": "bfd0c009444d1e1dddf297badd988163ff110ffa",
  "node_id": "MDY6Q29tbWl0NzU2OTU3ODpiZmQwYzAwOTQ0NGQxZTFkZGRmMjk3YmFkZDk4ODE2M2ZmMTEwZmZh",
  "commit": {
    "author": {
      "name": "Dan Ungureanu",
      "email": "dan@ungureanu.me",
      "date": "2021-04-02T08:19:30Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-04-02T08:19:30Z"
    },
    "message": "FEATURE: Copying invite link triggers a save (#12581)\n\nChanging the invite type from link to email and then copying it was\r\nconfusing because it gave user the impression that the invite was\r\nupdated and the invite link will reflect the latest changes, but it\r\ndid not.",
    "tree": {
      "sha": "4e4f9595c398bf61dba7dc3a3394749b7e8850b2",
      "url": "https://api.github.com/repos/discourse/discourse/git/trees/4e4f9595c398bf61dba7dc3a3394749b7e8850b2"
    },
    "url": "https://api.github.com/repos/discourse/discourse/git/commits/bfd0c009444d1e1dddf297badd988163ff110ffa",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgZtOSCRBK7hj4Ov3rIwAAdHIIAIT8Z8VtuY/74T8gWuOw2cRo\nprsW8s7QiF4GoWadStJULOGAvd2Vvy59Gj2cnkvtMM+yahTY9ICJE44EhKcd3ax+\ncrxKPmiv6GxkidMqCjUvCJB7XJulSYvdP1YqlohM8+vGMf6Qql2yu/w8xI7OAojQ\nVUlfdri+Z2fGJ4uDN5Gl6+Al0UJ2levbFaoEK947CLmkcxafd0aAnrj1XKjEnK9b\nDtQx+IvXwUB00sIJK6WBQ6MCzup/dck2UqiKdmn7BTT6aiJR2XudbWnJMQxgqLCi\njPrQtCJKkBh8S87ilgl4tAbTBR1kCXBwjRq9GRZICFs00MJJgzckvd4ZT0PfPx4=\n=gfx/\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 4e4f9595c398bf61dba7dc3a3394749b7e8850b2\nparent 81e5352e013f34a86806248f57c61cec1f51a7b9\nauthor Dan Ungureanu <dan@ungureanu.me> 1617351570 +0300\ncommitter GitHub <noreply@github.com> 1617351570 +0300\n\nFEATURE: Copying invite link triggers a save (#12581)\n\nChanging the invite type from link to email and then copying it was\r\nconfusing because it gave user the impression that the invite was\r\nupdated and the invite link will reflect the latest changes, but it\r\ndid not."
    }
  },
  "url": "https://api.github.com/repos/discourse/discourse/commits/bfd0c009444d1e1dddf297badd988163ff110ffa",
  "html_url": "https://github.com/discourse/discourse/commit/bfd0c009444d1e1dddf297badd988163ff110ffa",
  "comments_url": "https://api.github.com/repos/discourse/discourse/commits/bfd0c009444d1e1dddf297badd988163ff110ffa/comments",
  "author": {
    "login": "udan11",
    "id": 4147664,
    "node_id": "MDQ6VXNlcjQxNDc2NjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4147664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/udan11",
    "html_url": "https://github.com/udan11",
    "followers_url": "https://api.github.com/users/udan11/followers",
    "following_url": "https://api.github.com/users/udan11/following{/other_user}",
    "gists_url": "https://api.github.com/users/udan11/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/udan11/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/udan11/subscriptions",
    "organizations_url": "https://api.github.com/users/udan11/orgs",
    "repos_url": "https://api.github.com/users/udan11/repos",
    "events_url": "https://api.github.com/users/udan11/events{/privacy}",
    "received_events_url": "https://api.github.com/users/udan11/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "81e5352e013f34a86806248f57c61cec1f51a7b9",
      "url": "https://api.github.com/repos/discourse/discourse/commits/81e5352e013f34a86806248f57c61cec1f51a7b9",
      "html_url": "https://github.com/discourse/discourse/commit/81e5352e013f34a86806248f57c61cec1f51a7b9"
    }
  ],
  "stats": {
    "total": 30,
    "additions": 24,
    "deletions": 6
  },
  "files": [
    {
      "sha": "04310faeaa4ad85ec8975f8330126a4d741d0ace",
      "filename": "app/assets/javascripts/discourse/app/controllers/create-invite.js",
      "status": "modified",
      "additions": 10,
      "deletions": 6,
      "changes": 16,
      "blob_url": "https://github.com/discourse/discourse/blob/bfd0c009444d1e1dddf297badd988163ff110ffa/app/assets/javascripts/discourse/app/controllers/create-invite.js",
      "raw_url": "https://github.com/discourse/discourse/raw/bfd0c009444d1e1dddf297badd988163ff110ffa/app/assets/javascripts/discourse/app/controllers/create-invite.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/app/controllers/create-invite.js?ref=bfd0c009444d1e1dddf297badd988163ff110ffa",
      "patch": "@@ -101,7 +101,9 @@ export default Controller.extend(\n               this.send(\"closeModal\");\n             } else {\n               this.appEvents.trigger(\"modal-body:flash\", {\n-                text: I18n.t(\"user.invited.invite.invite_saved\"),\n+                text: opts.copy\n+                  ? I18n.t(\"user.invited.invite.invite_copied\")\n+                  : I18n.t(\"user.invited.invite.invite_saved\"),\n                 messageClass: \"success\",\n               });\n             }\n@@ -156,12 +158,14 @@ export default Controller.extend(\n \n     @action\n     copied() {\n-      this.appEvents.trigger(\"modal-body:flash\", {\n-        text: I18n.t(\"user.invited.invite.invite_copied\"),\n-        messageClass: \"success\",\n-      });\n+      if (this.type === \"email\" && !this.buffered.get(\"email\")) {\n+        return this.appEvents.trigger(\"modal-body:flash\", {\n+          text: I18n.t(\"user.invited.invite.blank_email\"),\n+          messageClass: \"error\",\n+        });\n+      }\n \n-      this.setAutogenerated(false);\n+      this.save({ sendEmail: false, copy: true });\n     },\n \n     @action"
    },
    {
      "sha": "fd27c389b47af5672082c2368420a1ba02413210",
      "filename": "app/assets/javascripts/discourse/tests/acceptance/create-invite-modal-test.js",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/discourse/discourse/blob/bfd0c009444d1e1dddf297badd988163ff110ffa/app/assets/javascripts/discourse/tests/acceptance/create-invite-modal-test.js",
      "raw_url": "https://github.com/discourse/discourse/raw/bfd0c009444d1e1dddf297badd988163ff110ffa/app/assets/javascripts/discourse/tests/acceptance/create-invite-modal-test.js",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/app/assets/javascripts/discourse/tests/acceptance/create-invite-modal-test.js?ref=bfd0c009444d1e1dddf297badd988163ff110ffa",
      "patch": "@@ -1,6 +1,7 @@\n import { click, fillIn, visit } from \"@ember/test-helpers\";\n import { acceptance } from \"discourse/tests/helpers/qunit-helpers\";\n import { test } from \"qunit\";\n+import I18n from \"I18n\";\n \n acceptance(\"Invites - Create & Edit Invite Modal\", function (needs) {\n   let deleted;\n@@ -89,6 +90,18 @@ acceptance(\"Invites - Create & Edit Invite Modal\", function (needs) {\n     await click(\".modal-footer .btn:last-child\");\n     assert.notOk(deleted, \"does not delete invite on close\");\n   });\n+\n+  test(\"copying an email invite without an email shows error message\", async function (assert) {\n+    await visit(\"/u/eviltrout/invited/pending\");\n+    await click(\".invite-controls .btn:first-child\");\n+\n+    await click(\"#invite-type-email\");\n+    await click(\".invite-link-field .btn\");\n+    assert.equal(\n+      find(\"#modal-alert\").text(),\n+      I18n.t(\"user.invited.invite.blank_email\")\n+    );\n+  });\n });\n \n acceptance(\"Invites - Link Invites\", function (needs) {"
    },
    {
      "sha": "877060422799c5568d3e8e39404e1a58ff24d491",
      "filename": "config/locales/client.en.yml",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/discourse/discourse/blob/bfd0c009444d1e1dddf297badd988163ff110ffa/config/locales/client.en.yml",
      "raw_url": "https://github.com/discourse/discourse/raw/bfd0c009444d1e1dddf297badd988163ff110ffa/config/locales/client.en.yml",
      "contents_url": "https://api.github.com/repos/discourse/discourse/contents/config/locales/client.en.yml?ref=bfd0c009444d1e1dddf297badd988163ff110ffa",
      "patch": "@@ -1526,6 +1526,7 @@ en:\n \n           invite_saved: \"Invite was saved.\"\n           invite_copied: \"Invite link was copied.\"\n+          blank_email: \"The email field cannot be empty.\"\n \n         bulk_invite:\n           none: \"No invitations to display on this page.\""
    }
  ]
}
