{
  "sha": "a38fd1fdc3e299e23a8ea7be27fe9dec2a161137",
  "node_id": "MDY6Q29tbWl0MTE0ODI5NTAzOmEzOGZkMWZkYzNlMjk5ZTIzYThlYTdiZTI3ZmU5ZGVjMmExNjExMzc=",
  "commit": {
    "author": {
      "name": "Aleksandr Veselov",
      "email": "veselov143@gmail.com",
      "date": "2021-02-18T22:23:53Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-02-18T22:23:53Z"
    },
    "message": "Encode e-mail subject to support non-ASCII chars (#888)\n\n* Encode e-mail subject to support non-ASCII chars\r\n\r\n* Add test for email subject with unicode\r\n\r\n* Fix wrong test argument\r\n\r\n* Cleanup test function",
    "tree": {
      "sha": "70b9f920f2c59bb45f854c2fffb6330524b36c1b",
      "url": "https://api.github.com/repos/umputun/remark42/git/trees/70b9f920f2c59bb45f854c2fffb6330524b36c1b"
    },
    "url": "https://api.github.com/repos/umputun/remark42/git/commits/a38fd1fdc3e299e23a8ea7be27fe9dec2a161137",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgLuj5CRBK7hj4Ov3rIwAAdHIIAFTnz7f4Atc841fwGRQkHKAy\nznXCSe5x3VTVd8jzaMQiE/Jn7LvMtas2TKQ2WwuPUnY8Yrepz66PRuAGybjof+VU\nmS3xV+ZAVbcdp063RhPKR84vOjQ3wqJ8mUm+dLOaLtEvd4S2qxKWYxGi79Xw/a7E\n5gNz2e6p/HjqTLwlEZ7Sv+y386lVqZIUbHi2LycEj24MshYDTG3pIP5HsIlNRX7+\n1DxBItak5L6qPXXSqxRWv39EcCVwwA+AUqlEliPlI+Ph1TJnBT8UJ7/ANiqUUTdA\nHxlnJ1NiJH1g/AELxCx7A7LbLXb+RH3rKXCVGb+8UauOjAKjijiW8I75FUMn+0o=\n=AMYH\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 70b9f920f2c59bb45f854c2fffb6330524b36c1b\nparent 807160dcf6303b7d85bca9c78dcd6f989dd8d4d5\nauthor Aleksandr Veselov <veselov143@gmail.com> 1613687033 +0300\ncommitter GitHub <noreply@github.com> 1613687033 -0600\n\nEncode e-mail subject to support non-ASCII chars (#888)\n\n* Encode e-mail subject to support non-ASCII chars\r\n\r\n* Add test for email subject with unicode\r\n\r\n* Fix wrong test argument\r\n\r\n* Cleanup test function"
    }
  },
  "url": "https://api.github.com/repos/umputun/remark42/commits/a38fd1fdc3e299e23a8ea7be27fe9dec2a161137",
  "html_url": "https://github.com/umputun/remark42/commit/a38fd1fdc3e299e23a8ea7be27fe9dec2a161137",
  "comments_url": "https://api.github.com/repos/umputun/remark42/commits/a38fd1fdc3e299e23a8ea7be27fe9dec2a161137/comments",
  "author": {
    "login": "VeselovAlex",
    "id": 3617329,
    "node_id": "MDQ6VXNlcjM2MTczMjk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3617329?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/VeselovAlex",
    "html_url": "https://github.com/VeselovAlex",
    "followers_url": "https://api.github.com/users/VeselovAlex/followers",
    "following_url": "https://api.github.com/users/VeselovAlex/following{/other_user}",
    "gists_url": "https://api.github.com/users/VeselovAlex/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/VeselovAlex/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/VeselovAlex/subscriptions",
    "organizations_url": "https://api.github.com/users/VeselovAlex/orgs",
    "repos_url": "https://api.github.com/users/VeselovAlex/repos",
    "events_url": "https://api.github.com/users/VeselovAlex/events{/privacy}",
    "received_events_url": "https://api.github.com/users/VeselovAlex/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "807160dcf6303b7d85bca9c78dcd6f989dd8d4d5",
      "url": "https://api.github.com/repos/umputun/remark42/commits/807160dcf6303b7d85bca9c78dcd6f989dd8d4d5",
      "html_url": "https://github.com/umputun/remark42/commit/807160dcf6303b7d85bca9c78dcd6f989dd8d4d5"
    }
  ],
  "stats": {
    "total": 35,
    "additions": 34,
    "deletions": 1
  },
  "files": [
    {
      "sha": "eca91dd708c0cdf2bdf3b20a24b865f264162513",
      "filename": "backend/app/notify/email.go",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/umputun/remark42/blob/a38fd1fdc3e299e23a8ea7be27fe9dec2a161137/backend/app/notify/email.go",
      "raw_url": "https://github.com/umputun/remark42/raw/a38fd1fdc3e299e23a8ea7be27fe9dec2a161137/backend/app/notify/email.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend/app/notify/email.go?ref=a38fd1fdc3e299e23a8ea7be27fe9dec2a161137",
      "patch": "@@ -6,6 +6,7 @@ import (\n \t\"crypto/tls\"\n \t\"fmt\"\n \t\"io\"\n+\t\"mime\"\n \t\"mime/quotedprintable\"\n \t\"net\"\n \t\"net/smtp\"\n@@ -303,7 +304,7 @@ func (e *Email) buildMessage(subject, body, to, contentType, unsubscribeLink str\n \t}\n \tmessage = addHeader(message, \"From\", e.From)\n \tmessage = addHeader(message, \"To\", to)\n-\tmessage = addHeader(message, \"Subject\", subject)\n+\tmessage = addHeader(message, \"Subject\", mime.BEncoding.Encode(\"utf-8\", subject))\n \tmessage = addHeader(message, \"Content-Transfer-Encoding\", \"quoted-printable\")\n \n \tif contentType != \"\" {"
    },
    {
      "sha": "e7b983776e7fa18b7bbff64810fa110008f03baa",
      "filename": "backend/app/notify/email_test.go",
      "status": "modified",
      "additions": 32,
      "deletions": 0,
      "changes": 32,
      "blob_url": "https://github.com/umputun/remark42/blob/a38fd1fdc3e299e23a8ea7be27fe9dec2a161137/backend/app/notify/email_test.go",
      "raw_url": "https://github.com/umputun/remark42/raw/a38fd1fdc3e299e23a8ea7be27fe9dec2a161137/backend/app/notify/email_test.go",
      "contents_url": "https://api.github.com/repos/umputun/remark42/contents/backend/app/notify/email_test.go?ref=a38fd1fdc3e299e23a8ea7be27fe9dec2a161137",
      "patch": "@@ -249,6 +249,38 @@ Content-Type: text/html; charset=\"UTF-8\"\n Date: `)\n }\n \n+func TestEmail_SendWithUnicodeInSubject(t *testing.T) {\n+\temail, err := NewEmail(EmailParams{\n+\t\tFrom:                     \"from@example.org\",\n+\t\tVerificationTemplatePath: \"testdata/verification.html.tmpl\",\n+\t\tMsgTemplatePath:          \"testdata/msg.html.tmpl\",\n+\t}, SMTPParams{})\n+\tassert.NoError(t, err)\n+\tassert.NotNil(t, email)\n+\tfakeSMTP := fakeTestSMTP{}\n+\temail.smtp = &fakeSMTP\n+\temail.TokenGenFn = TokenGenFn\n+\temail.UnsubscribeURL = \"https://remark42.com/api/v1/email/unsubscribe\"\n+\treq := Request{\n+\t\tComment: store.Comment{ID: \"999\", User: store.User{ID: \"1\", Name: \"test_user\"}, ParentID: \"1\", PostTitle: \"Привет\"},\n+\t\tparent:  store.Comment{ID: \"1\", User: store.User{ID: \"999\", Name: \"parent_user\"}},\n+\t\tEmails:  []string{\"test@example.org\"},\n+\t}\n+\t// test buildMessageFromRequest separately for message text\n+\tres, err := email.buildMessageFromRequest(req, req.Emails[0], false)\n+\tassert.NoError(t, err)\n+\t// `=?utf-8?b?TmV3IHJlcGx5IHRvIHlvdXIgY29tbWVudCBmb3IgItCf0YDQuNCy0LXRgiI=?=` -> `New reply to your comment for \"Привет\"` in base64 + required prefix and suffix\n+\tassert.Contains(t, res, `From: from@example.org\n+To: test@example.org\n+Subject: =?utf-8?b?TmV3IHJlcGx5IHRvIHlvdXIgY29tbWVudCBmb3IgItCf0YDQuNCy0LXRgiI=?=\n+Content-Transfer-Encoding: quoted-printable\n+MIME-version: 1.0\n+Content-Type: text/html; charset=\"UTF-8\"\n+List-Unsubscribe-Post: List-Unsubscribe=One-Click\n+List-Unsubscribe: <https://remark42.com/api/v1/email/unsubscribe?site=&tkn=token>\n+Date: `)\n+}\n+\n func TestEmail_SendVerification(t *testing.T) {\n \temail, err := NewEmail(EmailParams{\n \t\tFrom:                     \"from@example.org\","
    }
  ]
}
