{
  "sha": "fb6f731f6bcbb871f5b3632843a09d2ed501a596",
  "node_id": "C_kwDOAF-mA9oAKGZiNmY3MzFmNmJjYmI4NzFmNWIzNjMyODQzYTA5ZDJlZDUwMWE1OTY",
  "commit": {
    "author": {
      "name": "Benoit Latinier",
      "email": "benoit@latinier.fr",
      "date": "2021-12-23T10:26:50Z"
    },
    "committer": {
      "name": "GitHub",
      "email": "noreply@github.com",
      "date": "2021-12-23T10:26:50Z"
    },
    "message": "Merge pull request #470 from Rocket1184/feature/admin-restore-after-cancel-edit\n\nadmin: restore comment content after cancel edit",
    "tree": {
      "sha": "2064792edba665473ae56968d1281ec2ace5dce3",
      "url": "https://api.github.com/repos/posativ/isso/git/trees/2064792edba665473ae56968d1281ec2ace5dce3"
    },
    "url": "https://api.github.com/repos/posativ/isso/git/commits/fb6f731f6bcbb871f5b3632843a09d2ed501a596",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhxE7qCRBK7hj4Ov3rIwAAFvYIAGLkFxSe04zBVB76Ht4+JRhl\n82KZt6xqf0cxyDJwS8UPxdBfduIez6Ug+C1Fwlxbno/VstJT1j+nTfLN9rwzb5h7\nlpSoy1A2qgyEg74ymMKAoRV6mm5KdAPThUrCpCKmrUfqh7JCobT9lwvGsfz6FYTT\nYGz8wfDsuwVmiaQWeRtodpSG/4MGtR1GTiU8nL0PDfn3rQogcUuX3VmqM/tWoe5T\nH+Ocgt5UIW4SlOdsMhGVRXPrbVV21CwZ7V9tCXeJ8eQi8i3RHgYNwRz9bA3QdE8Q\ne2jZw7NWpVH1qKAS42HaSk9ddV22ikT8IQnXVSVC1M5a/yNV+aj9N8R7HIvT5g8=\n=+ww3\n-----END PGP SIGNATURE-----\n",
      "payload": "tree 2064792edba665473ae56968d1281ec2ace5dce3\nparent 5f3bf4fb8e481e09259e8fdf53995fca3461ad59\nparent 2391e8e7a90a1c9d859910ff7b343f33ae6999fb\nauthor Benoit Latinier <benoit@latinier.fr> 1640255210 +0100\ncommitter GitHub <noreply@github.com> 1640255210 +0100\n\nMerge pull request #470 from Rocket1184/feature/admin-restore-after-cancel-edit\n\nadmin: restore comment content after cancel edit"
    }
  },
  "url": "https://api.github.com/repos/posativ/isso/commits/fb6f731f6bcbb871f5b3632843a09d2ed501a596",
  "html_url": "https://github.com/posativ/isso/commit/fb6f731f6bcbb871f5b3632843a09d2ed501a596",
  "comments_url": "https://api.github.com/repos/posativ/isso/commits/fb6f731f6bcbb871f5b3632843a09d2ed501a596/comments",
  "author": {
    "login": "blatinier",
    "id": 1086629,
    "node_id": "MDQ6VXNlcjEwODY2Mjk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1086629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/blatinier",
    "html_url": "https://github.com/blatinier",
    "followers_url": "https://api.github.com/users/blatinier/followers",
    "following_url": "https://api.github.com/users/blatinier/following{/other_user}",
    "gists_url": "https://api.github.com/users/blatinier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/blatinier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/blatinier/subscriptions",
    "organizations_url": "https://api.github.com/users/blatinier/orgs",
    "repos_url": "https://api.github.com/users/blatinier/repos",
    "events_url": "https://api.github.com/users/blatinier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/blatinier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "web-flow",
    "id": 19864447,
    "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/web-flow",
    "html_url": "https://github.com/web-flow",
    "followers_url": "https://api.github.com/users/web-flow/followers",
    "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
    "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
    "organizations_url": "https://api.github.com/users/web-flow/orgs",
    "repos_url": "https://api.github.com/users/web-flow/repos",
    "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/web-flow/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "5f3bf4fb8e481e09259e8fdf53995fca3461ad59",
      "url": "https://api.github.com/repos/posativ/isso/commits/5f3bf4fb8e481e09259e8fdf53995fca3461ad59",
      "html_url": "https://github.com/posativ/isso/commit/5f3bf4fb8e481e09259e8fdf53995fca3461ad59"
    },
    {
      "sha": "2391e8e7a90a1c9d859910ff7b343f33ae6999fb",
      "url": "https://api.github.com/repos/posativ/isso/commits/2391e8e7a90a1c9d859910ff7b343f33ae6999fb",
      "html_url": "https://github.com/posativ/isso/commit/2391e8e7a90a1c9d859910ff7b343f33ae6999fb"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 8,
    "deletions": 4
  },
  "files": [
    {
      "sha": "495a1c8b7791eed598440d080e2a1e341f2361ef",
      "filename": "isso/js/admin.js",
      "status": "modified",
      "additions": 8,
      "deletions": 4,
      "changes": 12,
      "blob_url": "https://github.com/posativ/isso/blob/fb6f731f6bcbb871f5b3632843a09d2ed501a596/isso/js/admin.js",
      "raw_url": "https://github.com/posativ/isso/raw/fb6f731f6bcbb871f5b3632843a09d2ed501a596/isso/js/admin.js",
      "contents_url": "https://api.github.com/repos/posativ/isso/contents/isso/js/admin.js?ref=fb6f731f6bcbb871f5b3632843a09d2ed501a596",
      "patch": "@@ -51,16 +51,20 @@ function validate_com(com_id, hash, isso_host_script) {\n function delete_com(com_id, hash, isso_host_script) {\n     moderate(com_id, hash, \"delete\", isso_host_script);\n }\n-function unset_editable(elt_id) {\n+function unset_editable(elt_id, save_changes) {\n     var elt = document.getElementById(elt_id);\n     if (elt) {\n+      elt.innerHTML = save_changes ? elt.textContent : elt.dataset['originContent'];\n+      delete elt.dataset['originContent'];\n       elt.contentEditable = false;\n       elt.classList.remove(\"editable\");\n     }\n }\n function set_editable(elt_id) {\n     var elt = document.getElementById(elt_id);\n     if (elt) {\n+      elt.dataset['originContent'] = elt.innerHTML;\n+      elt.textContent = elt.innerHTML;\n       elt.contentEditable = true;\n       elt.classList.add(\"editable\");\n     }\n@@ -77,13 +81,13 @@ function start_edit(com_id) {\n     document.getElementById('stop-edit-btn-' + com_id).classList.toggle('hidden');\n     document.getElementById('send-edit-btn-' + com_id).classList.toggle('hidden');\n }\n-function stop_edit(com_id) {\n+function stop_edit(com_id, save_changes) {\n     var editable_elements = ['isso-author-' + com_id,\n                              'isso-email-' + com_id,\n                              'isso-website-' + com_id,\n                              'isso-text-' + com_id];\n     for (var idx=0; idx <= editable_elements.length; idx++) {\n-        unset_editable(editable_elements[idx]);\n+      unset_editable(editable_elements[idx], save_changes);\n     }\n     document.getElementById('edit-btn-' + com_id).classList.toggle('hidden');\n     document.getElementById('stop-edit-btn-' + com_id).classList.toggle('hidden');\n@@ -95,6 +99,6 @@ function send_edit(com_id, hash, isso_host_script) {\n     var website = document.getElementById('isso-website-' + com_id).textContent;\n     var comment = document.getElementById('isso-text-' + com_id).textContent;\n     edit(com_id, hash, author, email, website, comment, isso_host_script);\n-    stop_edit(com_id);\n+    stop_edit(com_id, true);\n }\n "
    }
  ]
}
